# 🔧 GamePlay場景重製操作手冊

> 全新腳本系統的物件配置與腳本對應指南

---

## 📋 操作手冊目的

本手冊用於指導GamePlay場景的重製工程，記錄了：
- 現有物件結構分析
- 新系統腳本配置方案
- 物件層級組織規劃
- Canvas分層實作指南

---

## 🔍 當前場景物件結構分析

根據提供的Hierarchy截圖，當前GamePlayScene包含以下主要物件：

### 📷 **攝影機系統**
```
📹 Main Camera
└── 負責場景渲染和UI顯示
```

### 🎨 **Canvas主體結構**
```
📱 Canvas
├── 🗺️ MapChose          - 地圖選擇系統
├── 💬 TalkObject         - 對話物件系統
│   └── 📝 Text
├── 🔲 OutingObj         - 外出物件系統  
├── ℹ️ InformationUI     - 資訊UI系統
├── 🎮 GameObject        - 通用遊戲物件
├── 🔲 OutUI             - 外出UI
├── ⚙️ ConfigureSystem   - 設定系統
├── 🎭 DirtyTricks       - 特效系統
├── 📡 EventSystem       - 事件系統
├── 🎪 PlayerActor       - 玩家演員
├── 🎮 GameManager       - 遊戲管理器
├── 🎨 GameUICtrlManager - UI控制管理器
├── ⏰ TimeManager       - 時間管理器
├── 📊 NumericalRecords  - 數值記錄
├── 📊 NumericalRecords_PlayerSetting - 玩家設定數值
├── 🎭 ActorManager      - 演員管理器
└── 📝 TextBoxManager    - 文字框管理器
```

### 🏗️ **場景物件系統**
```
🏠 SceneObject
├── 📍 0                 - 場景物件索引0
├── 🍺 Tavern           - 酒吧場景
│   └── 🍺 Interactive_Tavern
├── 🏠 Dormitories      - 宿舍場景
│   └── 🏠 Interactive_Dormitories  
├── 🏠 Interactive_Room - 房間互動
└── 💬 Talk             - 對話系統
    └── 🔲 Other
```

### 🖼️ **背景系統**
```
🎨 BackGround
├── 🖼️ BackGroundObject
├── 🖼️ Image
└── 🧪 JosnTest
```

---

## 🆕 新系統重製配置方案

### 🎨 **完整場景結構總預覽圖**

以下是重製後的完整GamePlayScene Hierarchy結構：

```
🎮 GamePlayScene (重製版完整結構)
│
├── 📹 Main Camera
│   ├── 🎵 AudioListener
│   └── 📷 CameraController.cs (可選)
│
├── 🌍 WorldSpace (世界空間物件區域)
│   ├── 🏗️ Environment (環境物件)
│   │   ├── 🏠 TavernBuilding (酒吧建築)
│   │   ├── 🏠 DormitoryBuilding (宿舍建築)
│   │   ├── 🪑 Furniture (家具物件)
│   │   └── 💡 Lighting (光照系統)
│   │
│   ├── 🎭 Characters (角色物件)
│   │   ├── 👩 Yuka (Spine角色)
│   │   │   ├── 🦴 SkeletonAnimation
│   │   │   ├── 🎭 ActorManagerTest.cs
│   │   │   └── 🚶‍♀️ CharacterMovement.cs
│   │   │
│   │   └── 🐱 Cat (貓咪物件)
│   │       ├── 🖼️ SpriteRenderer
│   │       └── 🐾 CatBehavior.cs
│   │
│   └── 🎨 BackgroundObjects (背景物件)
│       ├── 🖼️ TavernBackground
│       ├── 🖼️ DormitoryBackground
│       └── 🌅 EnvironmentalEffects
│
├── 🎮 CoreManagers (核心管理器區域)
│   ├── 🎯 NewGameManager 🆕
│   │   ├── NewGameManager.cs
│   │   ├── SceneStateManager.cs
│   │   └── GameDataManager.cs
│   │
│   ├── 🎪 InteractionManager 🆕
│   │   ├── InteractionManager.cs
│   │   ├── InteractionConditionChecker.cs
│   │   └── InteractionResultProcessor.cs
│   │
│   ├── ⏰ TimeManager (保留)
│   │   └── TimeManagerTest.cs
│   │
│   ├── 📊 NumericalRecords (保留)
│   │   └── NumericalRecords.cs
│   │
│   ├── 📊 NumericalRecords_PlayerSetting (保留)
│   │   └── NumericalRecords_PlayerSetting.cs
│   │
│   └── 📡 EventSystem (保留)
│       └── EventSystem (Unity預設)
│
└── 🎨 UISystem (UI系統區域 - Canvas層級)
    │
    ├── 🖼️ BackgroundCanvas (Order: 0)
    │   ├── 🎨 NewUIManager 🆕
    │   │   ├── NewUIManager.cs
    │   │   ├── CanvasLayerManager.cs
    │   │   └── UIAnimationController.cs
    │   │
    │   ├── 🖼️ BackGroundObject (從原BackGround移動)
    │   ├── 🖼️ SceneBackground (新增)
    │   └── 🎭 EnvironmentEffects (新增)
    │
    ├── 🏠 StaticInteractionCanvas (Order: 40) 🆕
    │   ├── 🎯 SceneBtnManager (統一按鈕管理器) 🆕
    │   │   └── SceneBtnManager.cs
    │   │
    │   ├── === 餐廳場景按鈕組 ===
    │   │   ├── 🍺 TavernWorkBtn (協助由香工作)
    │   │   │   └── Button → SceneBtnManager.OnTavernWorkClick
    │   │   ├── 🐱 CatInteractionBtn (和貓咪互動)
    │   │   │   └── Button → SceneBtnManager.OnCatInteractionClick
    │   │   └── 🚪 ExitBtn (外出系統)
    │   │       └── Button → SceneBtnManager.OnExitClick
    │   │
    │   └── === 宿舍場景按鈕組 ===
    │       ├── 🍷 DrinkingInviteBtn (邀請喝酒)
    │       │   └── Button → SceneBtnManager.OnDrinkingInviteClick
    │       ├── 🏠 YukaRoomBtn (點擊由香房間)
    │       │   └── Button → SceneBtnManager.OnYukaRoomClick
    │       └── 🏡 PlayerRoomBtn (回自己房間提早結束)
    │           └── Button → SceneBtnManager.OnPlayerRoomClick
    │
    ├── 🎪 DynamicCharacterCanvas (Order: 50) 🆕
    │   ├── 🎯 DynamicCharacterInteraction (主控制器)
    │   │   ├── DynamicCharacterInteraction.cs
    │   │   ├── CharacterFollowButton.cs
    │   │   ├── YukaInteractionController.cs
    │   │   └── CharacterInteractionFeedback.cs
    │   │
    │   ├── 👩 YukaInteractionButton (透明跟隨Button)
    │   │   ├── Button (UI Component)
    │   │   ├── RectTransform (位置跟隨)
    │   │   └── Image (透明背景)
    │   │
    │   ├── ✨ CharacterHoverEffect (角色Hover效果)
    │   │   ├── Image (UI Component)
    │   │   └── HoverEffectController.cs
    │   │
    │   └── 🎯 InteractionIndicator (互動指示器)
    │       ├── Image (UI Component)
    │       └── IndicatorAnimationController.cs
    │
    ├── 🎮 GameUICanvas (Order: 60)<待更改>
    │   ├── ⏰ TimeDisplay (時間顯示)
    │   │   ├── Text (UI Component)
    │   │   └── TimeDisplayController.cs
    │   │
    │   ├── 💰 StatusDisplay (狀態顯示)
    │   │   ├── Text/Image (UI Components)
    │   │   └── StatusDisplayController.cs
    │   │
    │   ├── ⚙️ SettingsButton (設定按鈕)
    │   │   ├── Button (UI Component)
    │   │   └── SettingsButtonHandler.cs
    │   │
    │   └── ℹ️ InformationUI (資訊UI，從原Canvas移動)
    │       ├── InformationUI_ClickObject.cs (保留)
    │       └── Related UI Components
    │
    ├── 💬 DialogCanvas (Order: 70)
    │   ├── 💬 TalkObject (從原Canvas移動)
    │   │   ├── Text (UI Component)
    │   │   └── Related Scripts (保留)
    │   │
    │   ├── 📝 TextBoxManager (從原位置移動)
    │   │   ├── TextBoxTestPlaying.cs (保留)
    │   │   └── Related UI Components
    │   │
    │   ├── 🔲 DialogChoicePanel (新增)
    │   │   ├── DialogChoiceManager.cs
    │   │   └── Choice Buttons
    │   │
    │   └── 🔗 DialogIntegrationBridge (新增)
    │       └── DialogIntegrationBridge.cs
    │
    ├── 📋 MenuCanvas (Order: 80)
    │   ├── ⚙️ ConfigureSystem (從原Canvas移動)
    │   │   ├── ConfigureSystem Scripts (保留)
    │   │   └── Settings UI Panels
    │   │
    │   ├── 🗺️ MapChose (從原Canvas移動)
    │   │   ├── MapChose Scripts (保留)
    │   │   └── Map UI Components
    │   │
    │   ├── 🔲 OutingPanel (重組OutingObj)
    │   │   ├── OutingPanelController.cs
    │   │   └── Outing UI Components
    │   │
    │   └── 🔲 OutUI (從原位置移動)
    │       └── Related Components (保留)
    │
    └── 🚨 PopupCanvas (Order: 90)
        ├── 🎭 DirtyTricks (從原Canvas移動)
        │   ├── DirtyTrickCtrl.cs (保留)
        │   └── Transition Effects
        │
        ├── 💾 SaveLoadPanel (新增)
        │   ├── SaveLoadController.cs
        │   └── Save/Load UI Components
        │
        └── ⚠️ ConfirmationDialog (新增)
            ├── ConfirmationDialogController.cs
            └── Confirmation UI Components
```

### 🎯 **兩大場景 × 兩種模式設計**

根據實際需求分析，遊戲包含:
- **🍺 餐廳場景** + **🏠 宿舍場景** (兩大場景)
- **🌍 Q版全景互動** + **🎭 角色對話模式** (兩種互動)

#### 🌍 **Q版全景互動模式**
```
場景特色:
├── 👩 小Yuka在場景中走動 (簡化動畫: 4種組合)
├── 🎯 可點擊的互動物件 (工作、貓咪、外出等)
├── 🚪 場景切換功能 (餐廳⇄宿舍)
└── 🎭 進入角色對話模式入口

🚨 技術實現 (2025-08-21更新):
├── WorldSpace: 小Yuka Spine角色 + 背景物件 (避免Canvas破圖)
├── StaticInteractionCanvas: 靜態物件互動按鈕
└── BackgroundCanvas: 場景背景和視覺元素
```

#### 🎭 **角色對話互動模式**
```
互動特色:
├── 📋 左側動作選項選單 (對話、外出、特殊互動等)
├── 👩 右側Yuka完整立繪 (四軌道表情 + 多區域點擊)
├── 🔊 語音回饋系統 (點擊部位→對應語音)
└── ↩️ 返回場景總覽功能

🚨 技術實現 (2025-08-21更新):
├── MenuCanvas: 主要互動介面容器
├── DialogCanvas: 對話文字和語音播放
└── PopupCanvas: 特殊互動和成人內容
```

### 🎯 **層級結構說明**

#### 🌍 **WorldSpace區域** (純環境視覺)
- **環境建築物件** - 酒吧、宿舍建築視覺
- **背景裝飾物件** - 家具、燈光、氛圍物件
- **⚠️ 重要**: 角色系統改用Canvas + SkeletonGraphic實現

#### 🎨 **UISystem區域** (Canvas分層)
- **7層Canvas架構** - 清晰的UI層級管理
- **互動檢測分離** - 靜態與動態互動完全分開
- **視覺效果集中** - 所有UI效果統一管理

#### 🎮 **CoreManagers區域** (邏輯管理)
- **新舊系統共存** - 保留穩定組件，新增必要功能
- **統一協調** - 所有管理器在同一層級便於引用
- **事件驅動** - 各系統間通過事件通信

---

## 🎯 腳本配置方案

### 🏗️ **核心管理器架構**

#### 🎮 **新版GameManager**
```csharp
// 新增：NewGameManager.cs
物件位置: GamePlayScene Root
腳本配置:
├── NewGameManager.cs (主控制器) 🆕
├── SceneStateManager.cs (場景狀態管理) 🆕
└── GameDataManager.cs (遊戲數據管理) 🆕

功能說明:
- 替代原有GameManager，使用全新架構
- 管理遊戲狀態、場景切換、數據同步
- 與時間系統、數值系統、演員系統協調
```

#### 🎨 **新版UI管理器**
```csharp
// 新增：NewUIManager.cs  
物件位置: GameUICanvas
腳本配置:
├── NewUIManager.cs (UI總控制器) 🆕
├── CanvasLayerManager.cs (Canvas分層管理) 🆕
└── UIAnimationController.cs (UI動畫控制) 🆕

功能說明:
- 管理7層Canvas的顯示和隱藏
- 控制UI動畫和轉場效果
- 替代原有GameUICtrlManager
```

### 🎪 **互動系統腳本配置**

#### 🎯 **主要互動管理器**
```csharp
// 新增：InteractionManager.cs
物件位置: GamePlayScene Root
腳本配置:
├── InteractionManager.cs (互動統一管理) 🆕
├── InteractionConditionChecker.cs (條件檢查) 🆕
└── InteractionResultProcessor.cs (結果處理) 🆕

功能說明:
- 統一管理所有互動系統
- 檢查互動解鎖條件
- 處理互動結果和數值變化
```

#### 👩 **動態角色互動**
```csharp
// 新增：DynamicCharacterInteraction.cs
物件位置: DynamicCharacterCanvas
腳本配置:
├── DynamicCharacterInteraction.cs (主控制器) 🆕
├── CharacterFollowButton.cs (Button跟隨邏輯) 🆕
├── YukaInteractionController.cs (由香專用控制器) 🆕
└── CharacterInteractionFeedback.cs (視覺反饋) 🆕

目標物件:
├── YukaInteractionButton (Button組件)
├── YukaHoverEffect (視覺效果)
└── InteractionIndicator (互動指示器)

功能說明:
- 透明Button跟隨由香Spine角色移動
- World Space ↔ Screen Space 座標轉換
- Hover和點擊視覺反饋
- 顯示由香對話選單
```

#### 🏠 **場景按鈕統一管理系統**
```csharp
// 新增：SceneBtnManager.cs (統一按鈕管理器)
物件位置: StaticInteractionCanvas
腳本配置:
└── SceneBtnManager.cs (場景按鈕統一管理器) 🆕

目標按鈕配置 (Inspector分組設定):
├── === 餐廳場景按鈕組 ===
│   ├── TavernWorkBtn (協助由香工作)
│   ├── CatInteractionBtn (和貓咪互動) 
│   └── ExitBtn (外出系統)
│
├── === 宿舍場景按鈕組 ===
│   ├── DrinkingInviteBtn (邀請喝酒)
│   ├── YukaRoomBtn (點擊由香房間)
│   └── PlayerRoomBtn (回自己房間提早結束)
│
├── === 按鈕狀態控制 ===
│   ├── enableButtonAnimations = true (啟用按鈕動畫)
│   └── buttonFadeTime = 0.3f (淡入淡出時間)
│
└── === 核心管理器引用 ===
    ├── NewGameManager (遊戲管理器)
    ├── SceneStateManager (場景狀態管理器)
    └── InteractionManager (互動管理器)

功能優勢:
- 🎯 集中管理所有場景按鈕，統一配置
- 🎮 根據場景自動切換顯示對應按鈕組
- ⏰ 智能條件檢查，根據時間/狀態控制按鈕可用性
- ✨ 內建按鈕動畫效果，提供流暢視覺體驗
- 🔧 維護簡單，新增互動只需在一個腳本中添加
```

### 📊 **保留與整合的現有系統**

#### ⏰ **時間系統 (保留)**
```csharp
// 保留：TimeManager
物件位置: GamePlayScene Root (保持原位)
腳本配置: TimeManagerTest.cs (保留不變)

整合說明:
- 保持現有時間管理邏輯
- 新增事件通知給InteractionManager
- 確保與新系統的狀態同步
```

#### 📊 **數值系統 (保留)**
```csharp
// 保留：NumericalRecords
物件位置: GamePlayScene Root (保持原位)
腳本配置:
├── NumericalRecords.cs (保留不變)
└── NumericalRecords_PlayerSetting.cs (保留不變)

整合說明:
- 保持現有數值管理邏輯
- 新增API給InteractionManager調用
- 確保數值變化事件通知新系統
```

#### 🎭 **演員系統 (保留)**
```csharp
// 保留：ActorManager  
物件位置: GamePlayScene Root (保持原位)
腳本配置: ActorManagerTest.cs (保留不變)

整合說明:
- 保持現有演員控制邏輯
- 新增由香位置資訊給DynamicCharacterInteraction
- 確保表情和動畫與新互動系統同步
```

#### 💬 **對話系統 (移動+增強)**
```csharp
// 移動：TextBoxManager
物件位置: DialogCanvas (從原位移動)
腳本配置:
├── TextBoxManager.cs (保留，輕微修改) 
├── DialogChoiceManager.cs (新增) 🆕
└── DialogIntegrationBridge.cs (新增) 🆕

功能說明:
- 移動到DialogCanvas層級
- 新增對話選擇功能
- 整合新互動系統的對話觸發
```

---

## 🔧 物件配置操作步驟

### 📋 **階段一：Canvas分層重構**

#### 🎯 **步驟1：創建新Canvas層級** (Order設定確認)
**📝 重要提醒**: 根據實際操作確認，**Order in Layer** 就是控制Canvas分層的正確欄位
```
操作步驟:
1. 創建BackgroundCanvas (Order: 0)
2. 創建StaticInteractionCanvas (Order: 40)  
3. 創建DynamicCharacterCanvas (Order: 50)
4. 創建GameUICanvas (Order: 60)
5. 創建DialogCanvas (Order: 70)
6. 創建MenuCanvas (Order: 80)
7. 創建PopupCanvas (Order: 90)

Canvas設定:
- Render Mode: Screen Space - Camera ✅ (實際驗證正確)
- Pixel Perfect: True
- Order in Layer: 按上述順序設定 ✅ (0, 40, 50, 60, 70, 80, 90)
- Canvas Scaler: Scale With Screen Size (RWD響應式設計)
- Sorting Layer: Default
```

#### 🎯 **步驟2：分離視覺與互動物件** ⚠️ 關鍵步驟
```
🎯 分離原則 (基於實際場景分析):
1. 視覺物件 → WorldSpace/Environment/
   ├── Tavern 建築視覺 → TavernBuilding/
   ├── Dormitories 建築視覺 → DormitoryBuilding/ 
   └── 家具、裝飾等 → Furniture/

2. 互動UI選單 → 對應Canvas層級
   ├── Interactive_Tavern UI選單 → MenuCanvas/TavernInteractionMenu/
   ├── flirt_Talk → DialogCanvas/TavernDialogPanel/
   ├── 成人內容選項 → PopupCanvas/AdultContentPanel/
   └── 其他互動選單 → 對應Canvas

3. 既有UI系統 → 對應Canvas層級  
   ├── BackGroundObject → BackgroundCanvas
   ├── InformationUI → GameUICanvas
   ├── TalkObject → DialogCanvas
   ├── TextBoxManager → DialogCanvas
   ├── ConfigureSystem → MenuCanvas
   ├── MapChose → MenuCanvas
   └── DirtyTricks → PopupCanvas
```

### 📋 **階段二：創建Canvas角色系統**

#### 🎪 **場景角色系統創建** ✨新設計
```
DynamicCharacterCanvas下創建:

1. SmallYuka (Q版場景角色) 🚨技術修正
   - 物件類型: WorldSpace SkeletonAnimation (Canvas破圖，改回WorldSpace)
   - 腳本配置:
     ├── SceneCharacterController.cs (整合Yuka Manager邏輯)
     ├── UICharacterMovement.cs (修改版CharacterMovement.cs)
     ├── ActorManagerTest.cs (直接移植，無需修改)
     └── Button + EventTrigger (取代Collider + Click/Mouse腳本)
   - 動畫設定: 4種組合 (idle/walk × 正常/開心表情)
   - 互動方式: UI Button.onClick (取代OnMouseDown)
   - 功能: 場景漫遊 + 進入對話模式
   - 移植優勢: 保留85%現有邏輯，僅修改輸入和座標系統

2. CatInteractionArea (貓咪互動區域)
   - 物件類型: Image + Button (UI)
   - 腳本: CatInteractionHandler.cs
   - 位置: 固定在貓咪出現位置
   - 功能: 釣魚→餵食→嚕貓連動系統

3. SceneEffects (場景特效)
   - 物件類型: Image (UI)
   - 腳本: HoverEffectController.cs
   - 功能: 互動指示器和視覺反饋
```

#### 🎭 **對話角色系統創建** ✨核心功能
```
MenuCanvas下創建:

1. FullYuka (完整互動立繪)
   - 物件類型: SkeletonGraphic (四軌道表情系統)
   - 腳本: CharacterInteractionPanel.cs
   - 表情控制: 整合ActorManagerTest.cs邏輯
   - Button組件: MultiAreaButton (多區域點擊檢測)
   - 功能: 語音互動 + 表情變化

2. ActionSelectionMenu (左側動作選單)
   - TalkButton (對話選項)
   - ExitButton (外出選項) 
   - SpecialActionButton (特殊互動)
   - ReturnButton (返回場景)

3. VoicePlaybackSystem (語音播放系統)
   - AudioSource (語音播放)
   - 腳本: VoiceFeedbackController.cs
   - 功能: 點擊部位→對應語音回饋
```

#### 🎯 **場景按鈕統一管理創建**
```
StaticInteractionCanvas下創建:

1. SceneBtnManager (統一按鈕管理器)
   - 物件類型: Empty GameObject
   - 腳本: SceneBtnManager.cs
   - 功能: 統一管理所有場景互動按鈕

2. === 餐廳場景按鈕組 ===
   ├── TavernWorkBtn (協助由香工作)
   │   - 物件類型: Button (UI)
   │   - 位置: 酒吧工作區域
   │   - OnClick事件: SceneBtnManager.OnTavernWorkClick
   │
   ├── CatInteractionBtn (和貓咪互動)
   │   - 物件類型: Button (UI)
   │   - 位置: 貓咪出現區域
   │   - OnClick事件: SceneBtnManager.OnCatInteractionClick
   │
   └── ExitBtn (外出系統)
       - 物件類型: Button (UI)
       - 位置: 場景出口位置
       - OnClick事件: SceneBtnManager.OnExitClick

3. === 宿舍場景按鈕組 ===
   ├── DrinkingInviteBtn (邀請喝酒)
   │   - 物件類型: Button (UI)
   │   - 位置: 宿舍大廳
   │   - OnClick事件: SceneBtnManager.OnDrinkingInviteClick
   │
   ├── YukaRoomBtn (點擊由香房間)
   │   - 物件類型: Button (UI)
   │   - 位置: 由香房間門口
   │   - OnClick事件: SceneBtnManager.OnYukaRoomClick
   │
   └── PlayerRoomBtn (回自己房間提早結束)
       - 物件類型: Button (UI)
       - 位置: 玩家房間門口
       - OnClick事件: SceneBtnManager.OnPlayerRoomClick
```

### 📋 **階段三：腳本配置與綁定**

#### 🎯 **主要管理器配置**
```
GamePlayScene Root下創建:

1. NewGameManager (空物件)
   - 添加腳本: NewGameManager.cs
   - 引用設定: TimeManager, NumericalRecords, ActorManager
   - 引用設定: InteractionManager, NewUIManager

2. InteractionManager (空物件)  
   - 添加腳本: InteractionManager.cs
   - 引用設定: DynamicCharacterInteraction, StaticObjectInteraction
   - Canvas引用: DynamicCharacterCanvas, StaticInteractionCanvas
```

#### 🎯 **UI管理器配置**
```
GameUICanvas下創建:

1. NewUIManager (空物件)
   - 添加腳本: NewUIManager.cs
   - Canvas引用: 所有7層Canvas
   - 組件引用: 各UI面板和控制器
```

### 📋 **階段四：引用綁定檢查清單**

#### ✅ **必要引用綁定**
```
NewGameManager.cs 需要綁定:
├── TimeManagerTest (現有)
├── NumericalRecords (現有)  
├── ActorManagerTest (現有)
├── InteractionManager (新增)
├── NewUIManager (新增)
└── SceneStateManager (新增)

InteractionManager.cs 需要綁定:
├── DynamicCharacterInteraction (新增)
├── SceneBtnManager (新增)
├── DynamicCharacterCanvas (新增)
├── StaticInteractionCanvas (新增)
└── InteractionConditionChecker (新增)

SceneInteractionController.cs 需要綁定:
├── SmallYuka (SkeletonGraphic組件)
├── CatInteractionArea (UI Button)
├── SceneEffects (視覺反饋)
└── SceneModeManager (模式切換控制器)

CharacterInteractionPanel.cs 需要綁定:
├── FullYuka (SkeletonGraphic組件)
├── ActionSelectionMenu (動作選單)
├── VoicePlaybackSystem (語音系統)
└── ActorManagerTest (表情控制整合)

SceneBtnManager.cs 需要綁定:
├── === 餐廳場景按鈕組 ===
│   ├── TavernWorkBtn (協助由香工作)
│   ├── CatInteractionBtn (和貓咪互動)
│   └── ExitBtn (外出系統)
├── === 宿舍場景按鈕組 ===
│   ├── DrinkingInviteBtn (邀請喝酒)
│   ├── YukaRoomBtn (點擊由香房間)
│   └── PlayerRoomBtn (回自己房間提早結束)
└── === 核心管理器引用 ===
    ├── NewGameManager
    ├── SceneStateManager
    └── InteractionManager
```

---

## 🔄 舊系統物件遷移策略

### 📋 **遷移原則說明**

基於實際場景分析，舊系統採用**場景物件 + Collider + OnClick**的互動方式，新系統改用**視覺物件 + Canvas Button**的分離架構。

#### 🎯 **核心分離概念**
```
🔄 舊系統 → 新系統轉換:

舊: SceneObject/Interactive_* (視覺+互動融合)
 ↓
新: WorldSpace/Environment/* (純視覺) + Canvas/Button (純互動)
```

### 🏠 **具體物件遷移對照表**

#### 🍺 **Tavern 酒吧系統**
```
📦 SceneObject/Tavern/
├── 🖼️ 視覺物件 (建築、家具、裝飾)
│   → 移動到: WorldSpace/Environment/TavernBuilding/
│   → 保留: 酒吧背景、酒櫃、桌椅等所有視覺元素
│
├── 🎮 Interactive_Tavern/ (互動選單UI)
│   ├── flirt_Talk → DialogCanvas/TavernDialogPanel/
│   ├── flirt_Chests, flirt_Ass1, flirt_Ass2, flirt_genitals
│   │   → PopupCanvas/AdultContentPanel/
│   ├── "外出" 按鈕 → MenuCanvas/TavernInteractionMenu/
│   ├── "返回" 按鈕 → MenuCanvas/TavernInteractionMenu/
│   └── 隱藏功能按鈕 → MenuCanvas/TavernInteractionMenu/
│
└── 🗑️ 刪除互動組件:
    ├── Collider 組件 → 改用 Canvas Button 檢測
    ├── OnClick 事件腳本 → 改用 UI Button.onClick
    └── Job1, GoOut, Chats 等物件 → 改用對應 Canvas Button
```

#### 🏠 **Dormitories 宿舍系統**
```
📦 SceneObject/Dormitories/
├── 🖼️ 視覺物件 (建築、房間、家具)
│   → 移動到: WorldSpace/Environment/DormitoryBuilding/
│
├── 🎮 Interactive_Dormitories/ (互動功能)
│   → 重新設計為: StaticInteractionCanvas/DormInteractionButton/
│
└── 🗑️ 刪除: Collider + OnClick 互動組件
```

#### 🎭 **角色系統特殊處理**
```
📦 SceneObject/Tavern/Yuka
├── 🎭 Spine 角色動畫
│   → 移動到: WorldSpace/Characters/Yuka/
│   → 保留: SkeletonAnimation + ActorManagerTest.cs
│
└── 🎮 角色互動觸發
    → 改用: DynamicCharacterCanvas/YukaInteractionButton/
    → 功能: 透明Button跟隨角色移動實現互動檢測
```

#### 💬 **對話系統整合**
```
📦 SceneObject/Talk/
├── 📝 對話核心功能
│   → 移動到: DialogCanvas/TalkSystem/
│   → 整合: TextBoxManager + 新對話選擇功能
│
└── 🔗 與互動系統整合
    → 統一由 InteractionManager 觸發對話
```

### ⚠️ **遷移注意事項**

#### 🔒 **安全遷移原則**
```
重要提醒:
1. ✅ 先移動視覺物件，確認顯示正常
2. ✅ 再創建新的 Canvas Button 互動
3. ✅ 測試新互動功能正常後，才刪除舊互動組件
4. ✅ 保持 Interactive_* 物件直到新系統完全驗證
5. ⚠️ 注意: 不要直接刪除整個 SceneObject，先分離視覺和互動部分
```

#### 🎯 **關鍵檢查點**
```
每個物件遷移後檢查:
1. ✅ 視覺物件在 WorldSpace 正常顯示
2. ✅ 對應的 Canvas Button 已創建
3. ✅ 新互動功能可以正常觸發
4. ✅ 舊 Collider + OnClick 已安全移除
5. ✅ 相關腳本引用已更新
```

---

## ⚠️ 注意事項與檢查點
### 🚨 **重要技術限制** (2025-08-21發現)```Canvas破圖問題:1. ⚠️ Yuka動態立繪在Canvas中會破圖，無法正常顯示2. ⚠️ SkeletonGraphic方案不適用於Yuka角色3. ✅ 必須使用WorldSpace + Canvas混合架構4. ✅ 背景和角色物件→WorldSpace，UI互動→Canvas架構調整:1. 🔄 小Yuka：WorldSpace SkeletonAnimation (非Canvas)2. 🔄 背景物件：WorldSpace環境物件 (非Canvas)3. 🔄 互動檢測：透明Canvas Button覆蓋WorldSpace物件4. 🔄 UI介面：純Canvas實現 (設定、選單、對話等)```

### 🔒 **安全措施**
```
重製前準備:
1. ✅ 確認GamePlayScene_old.unity備份存在
2. ✅ 提交當前版本到版本控制
3. ✅ 準備回滾計劃
4. ✅ 測試環境準備就緒
```

### 🎯 **關鍵檢查點**
```
每個階段完成後檢查:
1. ✅ Canvas分層Order設定正確
2. ✅ 物件層級結構清晰
3. ✅ 腳本引用綁定完整
4. ✅ 基礎功能測試通過
5. ✅ 無編譯錯誤
6. ✅ 場景可正常載入
```

### 🎮 **測試驗證**
```
功能測試清單:
1. ✅ 場景正常載入和顯示
2. ✅ 時間系統正常運作
3. ✅ 數值系統正常記錄  
4. ✅ 演員系統正常顯示
5. ✅ UI層級顯示正確
6. ✅ 基礎互動可以觸發
7. ✅ 對話系統正常工作
```

---

## 🎮 SceneBtnManager Unity配置詳細步驟

### 📋 **階段一：創建SceneBtnManager物件**

#### 🎯 **步驟1：創建管理器物件**
```
1. 在StaticInteractionCanvas下創建空物件
   - 右鍵點擊StaticInteractionCanvas → Create Empty
   - 重命名為: SceneBtnManager

2. 添加SceneBtnManager.cs腳本
   - 選中SceneBtnManager物件
   - Inspector → Add Component → SceneBtnManager
```

#### 🎯 **步驟2：創建場景按鈕**
```
餐廳場景按鈕組 (StaticInteractionCanvas下):
├── TavernWorkBtn
│   - 右鍵StaticInteractionCanvas → UI → Button - TextMeshPro
│   - 重命名為: TavernWorkBtn
│   - Text內容: "協助工作"
│
├── CatInteractionBtn  
│   - 右鍵StaticInteractionCanvas → UI → Button - TextMeshPro
│   - 重命名為: CatInteractionBtn
│   - Text內容: "和貓互動"
│
└── ExitBtn
    - 右鍵StaticInteractionCanvas → UI → Button - TextMeshPro
    - 重命名為: ExitBtn
    - Text內容: "外出"

宿舍場景按鈕組 (StaticInteractionCanvas下):
├── DrinkingInviteBtn
│   - 右鍵StaticInteractionCanvas → UI → Button - TextMeshPro
│   - 重命名為: DrinkingInviteBtn
│   - Text內容: "邀請喝酒"
│
├── YukaRoomBtn
│   - 右鍵StaticInteractionCanvas → UI → Button - TextMeshPro
│   - 重命名為: YukaRoomBtn
│   - Text內容: "由香房間"
│
└── PlayerRoomBtn
    - 右鍵StaticInteractionCanvas → UI → Button - TextMeshPro
    - 重命名為: PlayerRoomBtn
    - Text內容: "回房間"
```

### 📋 **階段二：Inspector配置**

#### 🎯 **SceneBtnManager Inspector配置**
```
選中SceneBtnManager物件，在Inspector中配置:

=== 餐廳場景按鈕組 ===
├── Tavern Work Btn: 拖入 TavernWorkBtn
├── Cat Interaction Btn: 拖入 CatInteractionBtn  
└── Exit Btn: 拖入 ExitBtn

=== 宿舍場景按鈕組 ===
├── Drinking Invite Btn: 拖入 DrinkingInviteBtn
├── Yuka Room Btn: 拖入 YukaRoomBtn
└── Player Room Btn: 拖入 PlayerRoomBtn

=== 按鈕狀態控制 ===
├── Enable Button Animations: ✅ (勾選)
└── Button Fade Time: 0.3

=== 核心管理器引用 ===
├── Game Manager: 拖入 NewGameManager (場景中)
├── Scene State Manager: 拖入 SceneStateManager (場景中)
└── Interaction Manager: 拖入 InteractionManager (場景中)
```

#### 🎯 **按鈕OnClick事件設定 (重要！)**
```
每個按鈕的Button組件都需要設定OnClick事件:

1. TavernWorkBtn → Button → OnClick()
   - 點擊 + 號添加事件
   - 拖入 SceneBtnManager 物件
   - 選擇函數: SceneBtnManager.OnTavernWorkClick

2. CatInteractionBtn → Button → OnClick()
   - 點擊 + 號添加事件  
   - 拖入 SceneBtnManager 物件
   - 選擇函數: SceneBtnManager.OnCatInteractionClick

3. ExitBtn → Button → OnClick()
   - 點擊 + 號添加事件
   - 拖入 SceneBtnManager 物件  
   - 選擇函數: SceneBtnManager.OnExitClick

4. DrinkingInviteBtn → Button → OnClick()
   - 點擊 + 號添加事件
   - 拖入 SceneBtnManager 物件
   - 選擇函數: SceneBtnManager.OnDrinkingInviteClick

5. YukaRoomBtn → Button → OnClick()
   - 點擊 + 號添加事件
   - 拖入 SceneBtnManager 物件
   - 選擇函數: SceneBtnManager.OnYukaRoomClick

6. PlayerRoomBtn → Button → OnClick()
   - 點擊 + 號添加事件
   - 拖入 SceneBtnManager 物件
   - 選擇函數: SceneBtnManager.OnPlayerRoomClick
```

### 📋 **階段三：配置驗證**

#### ✅ **配置檢查清單**
```
SceneBtnManager Inspector檢查:
1. ✅ 6個按鈕引用都已設定 (無None或Missing)
2. ✅ 3個管理器引用都已設定
3. ✅ 按鈕動畫設定已啟用
4. ✅ 淡入淡出時間已設定為0.3f

按鈕OnClick事件檢查:
1. ✅ TavernWorkBtn.OnClick → SceneBtnManager.OnTavernWorkClick
2. ✅ CatInteractionBtn.OnClick → SceneBtnManager.OnCatInteractionClick
3. ✅ ExitBtn.OnClick → SceneBtnManager.OnExitClick
4. ✅ DrinkingInviteBtn.OnClick → SceneBtnManager.OnDrinkingInviteClick
5. ✅ YukaRoomBtn.OnClick → SceneBtnManager.OnYukaRoomClick
6. ✅ PlayerRoomBtn.OnClick → SceneBtnManager.OnPlayerRoomClick

Console輸出檢查:
1. ✅ 場景啟動時無錯誤訊息
2. ✅ "[SceneBtnManager] 場景按鈕管理器初始化完成" 訊息出現
3. ✅ "[SceneBtnManager] 按鈕事件綁定完成" 訊息出現
4. ✅ 點擊按鈕時有對應的Debug.Log輸出
```

#### 🎮 **功能測試**
```
基礎功能測試:
1. ✅ 運行場景，SceneBtnManager正常初始化
2. ✅ 餐廳場景時只顯示餐廳按鈕組
3. ✅ 宿舍場景時只顯示宿舍按鈕組  
4. ✅ 按鈕點擊有Console輸出確認
5. ✅ 按鈕動畫效果正常運作
6. ✅ 按鈕在互動時會暫時禁用防止重複點擊

條件檢查測試:
1. ✅ 工作時間內工作按鈕可用
2. ✅ 夜晚時間邀請喝酒按鈕可用
3. ✅ 其他時間段按鈕正確禁用/啟用
```

### 🚨 **常見問題與解決方案**

#### ❌ **常見錯誤**
```
1. "NullReferenceException: Object reference not set"
   → 檢查SceneBtnManager的按鈕引用是否都已設定

2. "找不到管理器引用"
   → 確認NewGameManager等管理器在場景中存在並已設定

3. "按鈕點擊沒有反應"
   → 檢查Button的OnClick事件是否正確設定

4. "按鈕動畫不顯示"
   → 確認按鈕上有CanvasGroup組件，或會自動添加

5. "場景切換時按鈕沒有更新"
   → 檢查SceneStateManager的場景變更事件是否正常觸發
```

#### ✅ **問題排除步驟**
```
1. 檢查Console是否有錯誤訊息
2. 確認所有引用都已在Inspector中設定
3. 確認OnClick事件都已正確設定
4. 確認場景中有必要的管理器物件
5. 重新啟動場景測試初始化流程
```

---

## 📁 相關文檔引用

### 📑 **架構設計文檔**
- `docs/Architecture/NurturingMode/養成遊戲流程.md`
- `docs/Architecture/NurturingMode/養成UI系統.md`
- `docs/Architecture/NurturingMode/互動系統完整設計_重製版.md`

### 📋 **工程記錄**
- `docs/ProjectLogs/2025-08-17_GamePlay場景重製工程啟動日誌.md`
- `docs/project_memory.md`

### 🎯 **實機參考**
- `docs/實機畫面/養成模式*.png`

---

**手冊版本**: 1.4 🎮 **SceneBtnManager統一管理版**  
**創建日期**: 2025-08-17  
**最後更新**: 2025-08-21  
**適用範圍**: GamePlay場景全面重製工程  
**維護者**: 開發團隊 + Claude Code  
**重大更新**: 
- 🎯 **SceneBtnManager統一管理系統**: 替代分散按鈕設計，集中管理所有場景互動
- 🎮 **按鈕組自動切換**: 根據場景狀態自動顯示餐廳/宿舍對應按鈕組
- ⏰ **智能條件檢查**: 根據時間、好感度等條件智能控制按鈕可用性
- ✨ **內建動畫效果**: 按鈕淡入淡出效果，提供流暢視覺體驗
- 🔧 **詳細配置指南**: 完整的Unity Inspector配置步驟和OnClick事件設定
- 📋 **完整測試清單**: 配置驗證、功能測試、錯誤排除完整指南
- 🛠️ **維護優勢**: 新增互動只需在單一腳本中添加，大幅簡化維護工作

> 🔧 **操作手冊核心**: 本手冊提供了從現有物件結構到新系統架構的完整轉換指南，確保重製工程的順利進行和品質控制！