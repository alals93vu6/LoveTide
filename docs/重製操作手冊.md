# 🔧 GamePlay場景重製操作手冊

> 全新腳本系統的物件配置與腳本對應指南

---

## 📋 操作手冊目的

本手冊用於指導GamePlay場景的重製工程，記錄了：
- 現有物件結構分析
- 新系統腳本配置方案
- 物件層級組織規劃
- Canvas分層實作指南

---

## 🔍 當前場景物件結構分析

根據提供的Hierarchy截圖，當前GamePlayScene包含以下主要物件：

### 📷 **攝影機系統**
```
📹 Main Camera
└── 負責場景渲染和UI顯示
```

### 🎨 **Canvas主體結構**
```
📱 Canvas
├── 🗺️ MapChose          - 地圖選擇系統
├── 💬 TalkObject         - 對話物件系統
│   └── 📝 Text
├── 🔲 OutingObj         - 外出物件系統  
├── ℹ️ InformationUI     - 資訊UI系統
├── 🎮 GameObject        - 通用遊戲物件
├── 🔲 OutUI             - 外出UI
├── ⚙️ ConfigureSystem   - 設定系統
├── 🎭 DirtyTricks       - 特效系統
├── 📡 EventSystem       - 事件系統
├── 🎪 PlayerActor       - 玩家演員
├── 🎮 GameManager       - 遊戲管理器
├── 🎨 GameUICtrlManager - UI控制管理器
├── ⏰ TimeManager       - 時間管理器
├── 📊 NumericalRecords  - 數值記錄
├── 📊 NumericalRecords_PlayerSetting - 玩家設定數值
├── 🎭 ActorManager      - 演員管理器
└── 📝 TextBoxManager    - 文字框管理器
```

### 🏗️ **場景物件系統**
```
🏠 SceneObject
├── 📍 0                 - 場景物件索引0
├── 🍺 Tavern           - 酒吧場景
│   └── 🍺 Interactive_Tavern
├── 🏠 Dormitories      - 宿舍場景
│   └── 🏠 Interactive_Dormitories  
├── 🏠 Interactive_Room - 房間互動
└── 💬 Talk             - 對話系統
    └── 🔲 Other
```

### 🖼️ **背景系統**
```
🎨 BackGround
├── 🖼️ BackGroundObject
├── 🖼️ Image
└── 🧪 JosnTest
```

---

## 🆕 新系統重製配置方案

### 🎨 **完整場景結構總預覽圖**

以下是重製後的完整GamePlayScene Hierarchy結構：

```
🎮 GamePlayScene (重製版完整結構)
│
├── 📹 Main Camera
│   ├── 🎵 AudioListener
│   └── 📷 CameraController.cs (可選)
│
├── 🌍 WorldSpace (世界空間物件區域)
│   ├── 🏗️ Environment (環境物件)
│   │   ├── 🏠 TavernBuilding (酒吧建築)
│   │   ├── 🏠 DormitoryBuilding (宿舍建築)
│   │   ├── 🪑 Furniture (家具物件)
│   │   └── 💡 Lighting (光照系統)
│   │
│   ├── 🎭 Characters (角色物件)
│   │   ├── 👩 Yuka (Spine角色)
│   │   │   ├── 🦴 SkeletonAnimation
│   │   │   ├── 🎭 ActorManagerTest.cs
│   │   │   └── 🚶‍♀️ CharacterMovement.cs
│   │   │
│   │   └── 🐱 Cat (貓咪物件)
│   │       ├── 🖼️ SpriteRenderer
│   │       └── 🐾 CatBehavior.cs
│   │
│   └── 🎨 BackgroundObjects (背景物件)
│       ├── 🖼️ TavernBackground
│       ├── 🖼️ DormitoryBackground
│       └── 🌅 EnvironmentalEffects
│
├── 🎮 CoreManagers (核心管理器區域)
│   ├── 🎯 NewGameManager 🆕
│   │   ├── NewGameManager.cs
│   │   ├── SceneStateManager.cs
│   │   └── GameDataManager.cs
│   │
│   ├── 🎪 InteractionManager 🆕
│   │   ├── InteractionManager.cs
│   │   ├── InteractionConditionChecker.cs
│   │   └── InteractionResultProcessor.cs
│   │
│   ├── ⏰ TimeManager (保留)
│   │   └── TimeManagerTest.cs
│   │
│   ├── 📊 NumericalRecords (保留)
│   │   └── NumericalRecords.cs
│   │
│   ├── 📊 NumericalRecords_PlayerSetting (保留)
│   │   └── NumericalRecords_PlayerSetting.cs
│   │
│   └── 📡 EventSystem (保留)
│       └── EventSystem (Unity預設)
│
└── 🎨 UISystem (UI系統區域 - Canvas層級)
    │
    ├── 🖼️ BackgroundCanvas (Order: 0)
    │   ├── 🎨 NewUIManager 🆕
    │   │   ├── NewUIManager.cs
    │   │   ├── CanvasLayerManager.cs
    │   │   └── UIAnimationController.cs
    │   │
    │   ├── 🖼️ BackGroundObject (從原BackGround移動)
    │   ├── 🖼️ SceneBackground (新增)
    │   └── 🎭 EnvironmentEffects (新增)
    │
    ├── 🏠 StaticInteractionCanvas (Order: 40) 🆕
    │   ├── 🎯 StaticObjectInteraction (主控制器)
    │   │   ├── StaticObjectInteraction.cs
    │   │   ├── WorkSceneInteraction.cs
    │   │   ├── DormSceneInteraction.cs
    │   │   └── SceneObjectManager.cs
    │   │
    │   ├── 🍺 TavernInteractionButton (工作場景)
    │   │   ├── Button (UI Component)
    │   │   └── TavernInteractionHandler.cs
    │   │
    │   ├── 🐱 CatInteractionButton (和貓互動)
    │   │   ├── Button (UI Component)
    │   │   └── CatInteractionHandler.cs
    │   │
    │   ├── 🚪 ExitButton (外出系統)
    │   │   ├── Button (UI Component)
    │   │   └── ExitInteractionHandler.cs
    │   │
    │   ├── 🏠 DormInteractionButton (宿舍場景)
    │   │   ├── Button (UI Component)
    │   │   └── DormInteractionHandler.cs
    │   │
    │   └── 🍷 DrinkingInviteButton (邀請喝酒)
    │       ├── Button (UI Component)
    │       └── DrinkingInteractionHandler.cs
    │
    ├── 🎪 DynamicCharacterCanvas (Order: 50) 🆕
    │   ├── 🎯 DynamicCharacterInteraction (主控制器)
    │   │   ├── DynamicCharacterInteraction.cs
    │   │   ├── CharacterFollowButton.cs
    │   │   ├── YukaInteractionController.cs
    │   │   └── CharacterInteractionFeedback.cs
    │   │
    │   ├── 👩 YukaInteractionButton (透明跟隨Button)
    │   │   ├── Button (UI Component)
    │   │   ├── RectTransform (位置跟隨)
    │   │   └── Image (透明背景)
    │   │
    │   ├── ✨ CharacterHoverEffect (角色Hover效果)
    │   │   ├── Image (UI Component)
    │   │   └── HoverEffectController.cs
    │   │
    │   └── 🎯 InteractionIndicator (互動指示器)
    │       ├── Image (UI Component)
    │       └── IndicatorAnimationController.cs
    │
    ├── 🎮 GameUICanvas (Order: 60)
    │   ├── ⏰ TimeDisplay (時間顯示)
    │   │   ├── Text (UI Component)
    │   │   └── TimeDisplayController.cs
    │   │
    │   ├── 💰 StatusDisplay (狀態顯示)
    │   │   ├── Text/Image (UI Components)
    │   │   └── StatusDisplayController.cs
    │   │
    │   ├── ⚙️ SettingsButton (設定按鈕)
    │   │   ├── Button (UI Component)
    │   │   └── SettingsButtonHandler.cs
    │   │
    │   └── ℹ️ InformationUI (資訊UI，從原Canvas移動)
    │       ├── InformationUI_ClickObject.cs (保留)
    │       └── Related UI Components
    │
    ├── 💬 DialogCanvas (Order: 70)
    │   ├── 💬 TalkObject (從原Canvas移動)
    │   │   ├── Text (UI Component)
    │   │   └── Related Scripts (保留)
    │   │
    │   ├── 📝 TextBoxManager (從原位置移動)
    │   │   ├── TextBoxTestPlaying.cs (保留)
    │   │   └── Related UI Components
    │   │
    │   ├── 🔲 DialogChoicePanel (新增)
    │   │   ├── DialogChoiceManager.cs
    │   │   └── Choice Buttons
    │   │
    │   └── 🔗 DialogIntegrationBridge (新增)
    │       └── DialogIntegrationBridge.cs
    │
    ├── 📋 MenuCanvas (Order: 80)
    │   ├── ⚙️ ConfigureSystem (從原Canvas移動)
    │   │   ├── ConfigureSystem Scripts (保留)
    │   │   └── Settings UI Panels
    │   │
    │   ├── 🗺️ MapChose (從原Canvas移動)
    │   │   ├── MapChose Scripts (保留)
    │   │   └── Map UI Components
    │   │
    │   ├── 🔲 OutingPanel (重組OutingObj)
    │   │   ├── OutingPanelController.cs
    │   │   └── Outing UI Components
    │   │
    │   └── 🔲 OutUI (從原位置移動)
    │       └── Related Components (保留)
    │
    └── 🚨 PopupCanvas (Order: 90)
        ├── 🎭 DirtyTricks (從原Canvas移動)
        │   ├── DirtyTrickCtrl.cs (保留)
        │   └── Transition Effects
        │
        ├── 💾 SaveLoadPanel (新增)
        │   ├── SaveLoadController.cs
        │   └── Save/Load UI Components
        │
        └── ⚠️ ConfirmationDialog (新增)
            ├── ConfirmationDialogController.cs
            └── Confirmation UI Components
```

### 🎯 **層級結構說明**

#### 🌍 **WorldSpace區域** (非Canvas)
- **3D物件保持世界空間** - 環境、角色、背景
- **Spine角色動畫** - 由香在世界空間正常運作
- **物理碰撞** - 貓咪等物件的實際3D互動

#### 🎨 **UISystem區域** (Canvas分層)
- **7層Canvas架構** - 清晰的UI層級管理
- **互動檢測分離** - 靜態與動態互動完全分開
- **視覺效果集中** - 所有UI效果統一管理

#### 🎮 **CoreManagers區域** (邏輯管理)
- **新舊系統共存** - 保留穩定組件，新增必要功能
- **統一協調** - 所有管理器在同一層級便於引用
- **事件驅動** - 各系統間通過事件通信

---

## 🎯 腳本配置方案

### 🏗️ **核心管理器架構**

#### 🎮 **新版GameManager**
```csharp
// 新增：NewGameManager.cs
物件位置: GamePlayScene Root
腳本配置:
├── NewGameManager.cs (主控制器) 🆕
├── SceneStateManager.cs (場景狀態管理) 🆕
└── GameDataManager.cs (遊戲數據管理) 🆕

功能說明:
- 替代原有GameManager，使用全新架構
- 管理遊戲狀態、場景切換、數據同步
- 與時間系統、數值系統、演員系統協調
```

#### 🎨 **新版UI管理器**
```csharp
// 新增：NewUIManager.cs  
物件位置: GameUICanvas
腳本配置:
├── NewUIManager.cs (UI總控制器) 🆕
├── CanvasLayerManager.cs (Canvas分層管理) 🆕
└── UIAnimationController.cs (UI動畫控制) 🆕

功能說明:
- 管理7層Canvas的顯示和隱藏
- 控制UI動畫和轉場效果
- 替代原有GameUICtrlManager
```

### 🎪 **互動系統腳本配置**

#### 🎯 **主要互動管理器**
```csharp
// 新增：InteractionManager.cs
物件位置: GamePlayScene Root
腳本配置:
├── InteractionManager.cs (互動統一管理) 🆕
├── InteractionConditionChecker.cs (條件檢查) 🆕
└── InteractionResultProcessor.cs (結果處理) 🆕

功能說明:
- 統一管理所有互動系統
- 檢查互動解鎖條件
- 處理互動結果和數值變化
```

#### 👩 **動態角色互動**
```csharp
// 新增：DynamicCharacterInteraction.cs
物件位置: DynamicCharacterCanvas
腳本配置:
├── DynamicCharacterInteraction.cs (主控制器) 🆕
├── CharacterFollowButton.cs (Button跟隨邏輯) 🆕
├── YukaInteractionController.cs (由香專用控制器) 🆕
└── CharacterInteractionFeedback.cs (視覺反饋) 🆕

目標物件:
├── YukaInteractionButton (Button組件)
├── YukaHoverEffect (視覺效果)
└── InteractionIndicator (互動指示器)

功能說明:
- 透明Button跟隨由香Spine角色移動
- World Space ↔ Screen Space 座標轉換
- Hover和點擊視覺反饋
- 顯示由香對話選單
```

#### 🏠 **靜態物件互動**
```csharp
// 新增：StaticObjectInteraction.cs
物件位置: StaticInteractionCanvas
腳本配置:
├── StaticObjectInteraction.cs (主控制器) 🆕
├── WorkSceneInteraction.cs (工作場景互動) 🆕
├── DormSceneInteraction.cs (宿舍場景互動) 🆕
└── SceneObjectManager.cs (場景物件管理) 🆕

目標物件配置:
├── TavernInteractionButton (幫忙工作) - Button + TavernInteractionHandler.cs
├── CatInteractionButton (和貓互動) - Button + CatInteractionHandler.cs
├── ExitButton (外出系統) - Button + ExitInteractionHandler.cs
├── DormInteractionButton (宿舍互動) - Button + DormInteractionHandler.cs
└── DrinkingInviteButton (邀請喝酒) - Button + DrinkingInteractionHandler.cs

功能說明:
- 管理所有靜態場景物件互動
- 根據時間和場景狀態啟用/禁用按鈕
- 處理工作、貓咪、外出、喝酒等互動
```

### 📊 **保留與整合的現有系統**

#### ⏰ **時間系統 (保留)**
```csharp
// 保留：TimeManager
物件位置: GamePlayScene Root (保持原位)
腳本配置: TimeManagerTest.cs (保留不變)

整合說明:
- 保持現有時間管理邏輯
- 新增事件通知給InteractionManager
- 確保與新系統的狀態同步
```

#### 📊 **數值系統 (保留)**
```csharp
// 保留：NumericalRecords
物件位置: GamePlayScene Root (保持原位)
腳本配置:
├── NumericalRecords.cs (保留不變)
└── NumericalRecords_PlayerSetting.cs (保留不變)

整合說明:
- 保持現有數值管理邏輯
- 新增API給InteractionManager調用
- 確保數值變化事件通知新系統
```

#### 🎭 **演員系統 (保留)**
```csharp
// 保留：ActorManager  
物件位置: GamePlayScene Root (保持原位)
腳本配置: ActorManagerTest.cs (保留不變)

整合說明:
- 保持現有演員控制邏輯
- 新增由香位置資訊給DynamicCharacterInteraction
- 確保表情和動畫與新互動系統同步
```

#### 💬 **對話系統 (移動+增強)**
```csharp
// 移動：TextBoxManager
物件位置: DialogCanvas (從原位移動)
腳本配置:
├── TextBoxManager.cs (保留，輕微修改) 
├── DialogChoiceManager.cs (新增) 🆕
└── DialogIntegrationBridge.cs (新增) 🆕

功能說明:
- 移動到DialogCanvas層級
- 新增對話選擇功能
- 整合新互動系統的對話觸發
```

---

## 🔧 物件配置操作步驟

### 📋 **階段一：Canvas分層重構**

#### 🎯 **步驟1：創建新Canvas層級**
```
操作步驟:
1. 創建BackgroundCanvas (Order: 0)
2. 創建StaticInteractionCanvas (Order: 40)  
3. 創建DynamicCharacterCanvas (Order: 50)
4. 創建GameUICanvas (Order: 60)
5. 創建DialogCanvas (Order: 70)
6. 創建MenuCanvas (Order: 80)
7. 創建PopupCanvas (Order: 90)

Canvas設定:
- Render Mode: Screen Space - Overlay
- Pixel Perfect: True
- Sort Order: 按上述順序設定
- Canvas Scaler: Scale With Screen Size
```

#### 🎯 **步驟2：移動現有物件**
```
移動計劃:
1. BackGroundObject → BackgroundCanvas
2. InformationUI → GameUICanvas
3. TalkObject → DialogCanvas
4. TextBoxManager → DialogCanvas
5. ConfigureSystem → MenuCanvas
6. MapChose → MenuCanvas
7. DirtyTricks → PopupCanvas
8. 其他UI元素 → 對應Canvas層級
```

### 📋 **階段二：新增互動物件**

#### 🎯 **靜態互動按鈕創建**
```
StaticInteractionCanvas下創建:

1. TavernInteractionButton
   - 物件類型: Button (UI)
   - 腳本: TavernInteractionHandler.cs
   - 位置: 酒吧場景對應位置
   - 功能: 幫忙由香工作

2. CatInteractionButton  
   - 物件類型: Button (UI)
   - 腳本: CatInteractionHandler.cs
   - 位置: 貓咪對應位置
   - 功能: 和貓互動

3. ExitButton
   - 物件類型: Button (UI) 
   - 腳本: ExitInteractionHandler.cs
   - 位置: 門口位置
   - 功能: 外出系統

4. DrinkingInviteButton
   - 物件類型: Button (UI)
   - 腳本: DrinkingInteractionHandler.cs
   - 位置: 宿舍酒類位置  
   - 功能: 邀請喝酒
```

#### 🎯 **動態角色互動創建**
```
DynamicCharacterCanvas下創建:

1. YukaInteractionButton
   - 物件類型: Button (UI)
   - 腳本: CharacterFollowButton.cs
   - 設定: 透明背景，跟隨由香移動
   - 尺寸: 100x150 pixels

2. YukaHoverEffect
   - 物件類型: Image (UI)
   - 腳本: HoverEffectController.cs
   - 功能: 滑鼠懸停視覺效果

3. InteractionIndicator
   - 物件類型: Image (UI) 
   - 腳本: IndicatorAnimationController.cs
   - 功能: 可互動指示器動畫
```

### 📋 **階段三：腳本配置與綁定**

#### 🎯 **主要管理器配置**
```
GamePlayScene Root下創建:

1. NewGameManager (空物件)
   - 添加腳本: NewGameManager.cs
   - 引用設定: TimeManager, NumericalRecords, ActorManager
   - 引用設定: InteractionManager, NewUIManager

2. InteractionManager (空物件)  
   - 添加腳本: InteractionManager.cs
   - 引用設定: DynamicCharacterInteraction, StaticObjectInteraction
   - Canvas引用: DynamicCharacterCanvas, StaticInteractionCanvas
```

#### 🎯 **UI管理器配置**
```
GameUICanvas下創建:

1. NewUIManager (空物件)
   - 添加腳本: NewUIManager.cs
   - Canvas引用: 所有7層Canvas
   - 組件引用: 各UI面板和控制器
```

### 📋 **階段四：引用綁定檢查清單**

#### ✅ **必要引用綁定**
```
NewGameManager.cs 需要綁定:
├── TimeManagerTest (現有)
├── NumericalRecords (現有)  
├── ActorManagerTest (現有)
├── InteractionManager (新增)
├── NewUIManager (新增)
└── SceneStateManager (新增)

InteractionManager.cs 需要綁定:
├── DynamicCharacterInteraction (新增)
├── StaticObjectInteraction (新增)
├── DynamicCharacterCanvas (新增)
├── StaticInteractionCanvas (新增)
└── InteractionConditionChecker (新增)

DynamicCharacterInteraction.cs 需要綁定:
├── YukaSpineTransform (ActorManager提供)
├── YukaInteractionButton (新增)
├── YukaHoverEffect (新增)
└── InteractionIndicator (新增)

StaticObjectInteraction.cs 需要綁定:
├── TavernInteractionButton (新增)
├── CatInteractionButton (新增)
├── ExitButton (新增)
└── DrinkingInviteButton (新增)
```

---

## ⚠️ 注意事項與檢查點

### 🔒 **安全措施**
```
重製前準備:
1. ✅ 確認GamePlayScene_old.unity備份存在
2. ✅ 提交當前版本到版本控制
3. ✅ 準備回滾計劃
4. ✅ 測試環境準備就緒
```

### 🎯 **關鍵檢查點**
```
每個階段完成後檢查:
1. ✅ Canvas分層Order設定正確
2. ✅ 物件層級結構清晰
3. ✅ 腳本引用綁定完整
4. ✅ 基礎功能測試通過
5. ✅ 無編譯錯誤
6. ✅ 場景可正常載入
```

### 🎮 **測試驗證**
```
功能測試清單:
1. ✅ 場景正常載入和顯示
2. ✅ 時間系統正常運作
3. ✅ 數值系統正常記錄  
4. ✅ 演員系統正常顯示
5. ✅ UI層級顯示正確
6. ✅ 基礎互動可以觸發
7. ✅ 對話系統正常工作
```

---

## 📁 相關文檔引用

### 📑 **架構設計文檔**
- `docs/Architecture/NurturingMode/養成遊戲流程.md`
- `docs/Architecture/NurturingMode/養成UI系統.md`
- `docs/Architecture/NurturingMode/互動系統完整設計_重製版.md`

### 📋 **工程記錄**
- `docs/ProjectLogs/2025-08-17_GamePlay場景重製工程啟動日誌.md`
- `docs/project_memory.md`

### 🎯 **實機參考**
- `docs/實機畫面/養成模式*.png`

---

**手冊版本**: 1.0  
**創建日期**: 2025-08-17  
**適用範圍**: GamePlay場景全面重製工程  
**維護者**: 開發團隊 + Claude Code

> 🔧 **操作手冊核心**: 本手冊提供了從現有物件結構到新系統架構的完整轉換指南，確保重製工程的順利進行和品質控制！