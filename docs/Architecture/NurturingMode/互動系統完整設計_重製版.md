# ğŸ® äº’å‹•ç³»çµ±å®Œæ•´è¨­è¨ˆ (é‡è£½ç‰ˆ)

> GamePlayå ´æ™¯é‡è£½å·¥ç¨‹ï¼šå®Œæ•´çš„äº’å‹•ç³»çµ±æ¶æ§‹è¨­è¨ˆ

---

## ğŸ¯ æ¦‚è¿°

é‡è£½ç‰ˆäº’å‹•ç³»çµ±é‡å°ç§»å‹•è§’è‰²äº’å‹•å•é¡Œé€²è¡Œäº†å…¨é¢é‡æ–°è¨­è¨ˆï¼Œæ¡ç”¨7å±¤Canvasæ¶æ§‹å’Œé€æ˜Buttonè·Ÿéš¨æŠ€è¡“ï¼Œå¯¦ç¾äº†å®Œæ•´çš„å ´æ™¯äº’å‹•é«”é©—ã€‚

---

## ğŸ—ï¸ å®Œæ•´äº’å‹•æ¶æ§‹

### ğŸ¨ **Canvasåˆ†å±¤è¨­è¨ˆ**
```
ğŸ–¼ï¸ æ–°ç‰ˆäº’å‹•ç³»çµ± Canvas æ¶æ§‹
â”œâ”€â”€ Background Canvas (Order: 0) - å ´æ™¯èƒŒæ™¯
â”œâ”€â”€ Static Interaction Canvas (Order: 40) - éœæ…‹ç‰©ä»¶äº’å‹• ğŸ†•
â”‚   â”œâ”€â”€ å·¥ä½œäº’å‹•æŒ‰éˆ• (å¹«å¿™å·¥ä½œ)
â”‚   â”œâ”€â”€ è²“å’ªäº’å‹•æŒ‰éˆ• (å’Œè²“äº’å‹•) 
â”‚   â”œâ”€â”€ é–€å£æŒ‰éˆ• (å¤–å‡ºç³»çµ±)
â”‚   â””â”€â”€ é…’é¡äº’å‹•æŒ‰éˆ• (é‚€è«‹å–é…’)
â”œâ”€â”€ Dynamic Character Canvas (Order: 50) - å‹•æ…‹è§’è‰²äº’å‹• ğŸ†•
â”‚   â””â”€â”€ ç”±é¦™äº’å‹•Button (é€æ˜è·Ÿéš¨Spine)
â”œâ”€â”€ Game UI Canvas (Order: 60) - éŠæˆ²UI
â”œâ”€â”€ Dialog Canvas (Order: 70) - å°è©±ç³»çµ±
â”œâ”€â”€ Menu Canvas (Order: 80) - é¸å–®ç³»çµ±
â””â”€â”€ Popup Canvas (Order: 90) - å½ˆçª—ç³»çµ±
```

---

## ğŸ® å ´æ™¯äº’å‹•ç³»çµ±

### ğŸ¢ **å·¥ä½œæ™‚å ´æ™¯äº’å‹•**

#### ğŸ“‹ **ä¸»è¦äº’å‹•é¸é …** (Static Interaction Canvas)
```csharp
public enum WorkSceneInteraction
{
    HelpYukaWork,      // å¹«å¿™ç”±é¦™å·¥ä½œ
    CatInteraction,    // å’Œè²“äº’å‹•
    GoOutAlone,        // è‡ªå·±ç¨è‡ªå‡ºé–€
    TalkToYuka         // æ‰¾ç”±é¦™å°è©± (Dynamic Character Canvas)
}
```

#### ğŸ’¬ **ç”±é¦™å°è©±å­é¸å–®** (Dialog Canvas)
```csharp
public enum YukaDialogOption
{
    NormalTalk,        // å°è©± (åŸºç¤äº’å‹•)
    FlirtTalk,         // èª¿æƒ… (éœ€å¥½æ„Ÿåº¦)
    GoOutTogether,     // å’Œç”±é¦™ä¸€èµ·å¤–å‡º
    SexualInteraction  // æ‰i (ç‰¹æ®Šè§£é–æ¢ä»¶)
}
```

### ğŸ  **å®¿èˆæ™‚å ´æ™¯äº’å‹•**

#### ğŸ“‹ **ä¸»è¦äº’å‹•é¸é …** (Static Interaction Canvas)
```csharp
public enum DormSceneInteraction
{
    InviteDrinking,    // é‚€è«‹ç”±é¦™ä¸€èµ·å–é…’
    TalkToYuka         // æ‰¾ç”±é¦™å°è©± (Dynamic Character Canvas)
}
```

#### ğŸ’¬ **ç”±é¦™å°è©±å­é¸å–®** (èˆ‡å·¥ä½œæ™‚ç›¸åŒ)
- å°è©±ã€èª¿æƒ…ã€ä¸€èµ·å¤–å‡ºã€æ‰i
- å®¿èˆæ™‚ã€Œæ‰iã€è§£é–æ¢ä»¶è¼ƒå·¥ä½œæ™‚å¯¬é¬†

---

## ğŸ”¥ é‡å¤§å ´æ™¯è®Šæ›´

### âš ï¸ **å¤œæ™šå ´æ™¯çµ±ä¸€åŒ–**

#### ğŸ”„ **åŸè¨­è¨ˆ vs æ–°è¨­è¨ˆ**
```
âŒ åŸè¨­è¨ˆ:
å¤œæ™šæ™‚æ®µ 1-3:
â”œâ”€â”€ æ™‚æ®µ1: ç”±é¦™åœ¨å®¿èˆå¤§å»³
â”œâ”€â”€ æ™‚æ®µ2: ç”±é¦™é€²å…¥è‡ªå·±æˆ¿é–“ â† éœ€é¡å¤–å ´æ™¯
â””â”€â”€ æ™‚æ®µ3: ç”±é¦™åœ¨å®¿èˆå¤§å»³

âœ… æ–°è¨­è¨ˆ:
å¤œæ™šæ™‚æ®µ 1-3:
â”œâ”€â”€ æ™‚æ®µ1: ç”±é¦™åœ¨å®¿èˆå¤§å»³
â”œâ”€â”€ æ™‚æ®µ2: ç”±é¦™åœ¨å®¿èˆå¤§å»³ â† ç°¡åŒ–çµ±ä¸€
â””â”€â”€ æ™‚æ®µ3: ç”±é¦™åœ¨å®¿èˆå¤§å»³
```

#### ğŸ¯ **è®Šæ›´å„ªå‹¢**
- **ç°¡åŒ–å ´æ™¯ç®¡ç†** - ä¸éœ€è¦é¡å¤–çš„ç”±é¦™æˆ¿é–“å ´æ™¯
- **çµ±ä¸€äº’å‹•é‚è¼¯** - æ‰€æœ‰å®¿èˆæ™‚æ®µä½¿ç”¨ç›¸åŒç³»çµ±
- **é™ä½é–‹ç™¼è¤‡é›œåº¦** - æ¸›å°‘å ´æ™¯åˆ‡æ›å’Œç‹€æ…‹ç®¡ç†
- **æå‡ç”¨æˆ¶é«”é©—** - ç©å®¶ä¸æœƒå› æ‰¾ä¸åˆ°è§’è‰²è€Œå›°æƒ‘

---

## ğŸ¯ æŠ€è¡“å¯¦ä½œæ¶æ§‹

### ğŸ® **InteractionManager æ ¸å¿ƒæ§åˆ¶å™¨**
```csharp
public class InteractionManager : MonoBehaviour
{
    [Header("å ´æ™¯ç‹€æ…‹")]
    public bool isWorkTime;
    public int currentTimeSlot;
    
    [Header("äº’å‹•ç³»çµ±")]
    public DynamicCharacterInteraction yukaInteraction;
    public StaticObjectInteraction sceneInteraction;
    
    [Header("Canvaså¼•ç”¨")]
    public Canvas dynamicCharacterCanvas;
    public Canvas staticInteractionCanvas;
    
    // ğŸ¯ æ ¹æ“šæ™‚é–“å’Œå ´æ™¯æ›´æ–°å¯ç”¨äº’å‹•
    public void UpdateAvailableInteractions()
    {
        if (isWorkTime)
        {
            EnableWorkSceneInteractions();
        }
        else
        {
            EnableDormSceneInteractions();
        }
        
        // å¤œæ™šå ´æ™¯çµ±ä¸€è™•ç†
        if (currentTimeSlot >= 7)
        {
            SetYukaLocationToDormHall();
        }
    }
    
    void EnableWorkSceneInteractions()
    {
        // å•Ÿç”¨å·¥ä½œå ´æ™¯çš„4å€‹ä¸»è¦äº’å‹•
        sceneInteraction.EnableInteraction("HelpWork", true);
        sceneInteraction.EnableInteraction("CatPlay", true);
        sceneInteraction.EnableInteraction("GoOutAlone", true);
        
        // ç”±é¦™å°è©±å§‹çµ‚å¯ç”¨ (Dynamic Character Canvas)
        yukaInteraction.EnableInteraction(true);
    }
    
    void EnableDormSceneInteractions()
    {
        // å•Ÿç”¨å®¿èˆå ´æ™¯çš„2å€‹ä¸»è¦äº’å‹•
        sceneInteraction.EnableInteraction("InviteDrinking", true);
        
        // ç”±é¦™å°è©±å§‹çµ‚å¯ç”¨ (Dynamic Character Canvas)
        yukaInteraction.EnableInteraction(true);
    }
}
```

### ğŸ¨ **DynamicCharacterInteraction å‹•æ…‹è§’è‰²ç³»çµ±**
```csharp
public class DynamicCharacterInteraction : MonoBehaviour
{
    [Header("ç”±é¦™è§’è‰²å¼•ç”¨")]
    public Transform yukaSpineTransform;
    public Button yukaInteractionButton;
    
    [Header("Buttonè¨­å®š")]
    public Vector2 buttonSize = new Vector2(100, 150);
    public Vector2 buttonOffset = Vector2.zero;
    
    void Update()
    {
        // é€æ˜Buttonè·Ÿéš¨ç”±é¦™Spineè§’è‰²ç§»å‹•
        UpdateButtonPosition();
        
        // æ ¹æ“šå ´æ™¯ç‹€æ…‹èª¿æ•´å¯è¦‹æ€§
        UpdateButtonVisibility();
    }
    
    void UpdateButtonPosition()
    {
        if (yukaSpineTransform != null)
        {
            // World Space â†’ Screen Space åº§æ¨™è½‰æ›
            Vector3 worldPos = yukaSpineTransform.position + (Vector3)buttonOffset;
            Vector2 screenPos = Camera.main.WorldToScreenPoint(worldPos);
            yukaInteractionButton.transform.position = screenPos;
        }
    }
    
    // ğŸ¯ é»æ“Šç”±é¦™æ™‚é¡¯ç¤ºå°è©±é¸å–®
    public void OnYukaClicked()
    {
        ShowYukaDialogMenu();
    }
    
    void ShowYukaDialogMenu()
    {
        var availableOptions = GetAvailableDialogOptions();
        dialogSystem.ShowDialogMenu(availableOptions);
    }
    
    List<YukaDialogOption> GetAvailableDialogOptions()
    {
        var options = new List<YukaDialogOption>();
        
        // åŸºç¤å°è©±å§‹çµ‚å¯ç”¨
        options.Add(YukaDialogOption.NormalTalk);
        
        // èª¿æƒ…éœ€è¦å¥½æ„Ÿåº¦
        if (CheckAffectionLevel(RequiredAffectionForFlirt))
        {
            options.Add(YukaDialogOption.FlirtTalk);
        }
        
        // ä¸€èµ·å¤–å‡ºéœ€è¦æ™‚é–“æ¢ä»¶
        if (CheckTimeAvailableForGoingOut())
        {
            options.Add(YukaDialogOption.GoOutTogether);
        }
        
        // æ‰iéœ€è¦ç‰¹æ®Šæ¢ä»¶
        if (CheckSexualInteractionUnlocked())
        {
            options.Add(YukaDialogOption.SexualInteraction);
        }
        
        return options;
    }
}
```

### ğŸ  **StaticObjectInteraction éœæ…‹ç‰©ä»¶ç³»çµ±**
```csharp
public class StaticObjectInteraction : MonoBehaviour
{
    [Header("å·¥ä½œå ´æ™¯äº’å‹•")]
    public Button helpWorkButton;
    public Button catInteractionButton;
    public Button goOutAloneButton;
    
    [Header("å®¿èˆå ´æ™¯äº’å‹•")]
    public Button inviteDrinkingButton;
    
    [Header("äº’å‹•é…ç½®")]
    public Dictionary<string, InteractionData> interactionConfigs;
    
    public void EnableInteraction(string interactionName, bool enable)
    {
        switch (interactionName)
        {
            case "HelpWork":
                helpWorkButton.gameObject.SetActive(enable);
                break;
            case "CatPlay":
                catInteractionButton.gameObject.SetActive(enable);
                break;
            case "GoOutAlone":
                goOutAloneButton.gameObject.SetActive(enable);
                break;
            case "InviteDrinking":
                inviteDrinkingButton.gameObject.SetActive(enable);
                break;
        }
    }
    
    // ğŸ¯ è™•ç†éœæ…‹ç‰©ä»¶äº’å‹•
    public void HandleInteraction(string interactionType)
    {
        var interactionData = interactionConfigs[interactionType];
        
        // åŸ·è¡Œäº’å‹•é‚è¼¯
        ExecuteInteraction(interactionData);
        
        // æ›´æ–°æ•¸å€¼
        UpdatePlayerStats(interactionData);
        
        // æ¨é€²æ™‚é–“
        AdvanceTime(interactionData.timeCost);
    }
}
```

---

## ğŸ”„ è§£é–æ¢ä»¶ç³»çµ±

### ğŸ¯ **ã€Œæ‰iã€è§£é–æ¢ä»¶è¨­è¨ˆ**
```csharp
public class SexualInteractionUnlockChecker : MonoBehaviour
{
    [Header("è§£é–æ¢ä»¶é…ç½®")]
    public int requiredProgressForDorm = 50;      // å®¿èˆæ™‚éœ€è¦çš„é€²åº¦
    public int requiredProgressForWork = 80;      // å·¥ä½œæ™‚éœ€è¦çš„é€²åº¦
    public int requiredAffectionForWork = 70;     // å·¥ä½œæ™‚éœ€è¦çš„é¡å¤–å¥½æ„Ÿåº¦
    
    public bool CheckSexualInteractionUnlocked(bool isWorkTime)
    {
        int currentProgress = GetCurrentStoryProgress();
        int currentAffection = GetCurrentAffection();
        
        if (isWorkTime)
        {
            // å·¥ä½œæ™‚ï¼šéœ€è¦æ›´é«˜é€²åº¦ + æ›´é«˜å¥½æ„Ÿåº¦
            return currentProgress >= requiredProgressForWork && 
                   currentAffection >= requiredAffectionForWork;
        }
        else
        {
            // å®¿èˆæ™‚ï¼šåªéœ€è¦åŸºç¤é€²åº¦
            return currentProgress >= requiredProgressForDorm;
        }
    }
}
```

### ğŸ’• **å…¶ä»–äº’å‹•è§£é–æ¢ä»¶**
```csharp
public class InteractionUnlockManager : MonoBehaviour
{
    // èª¿æƒ…è§£é–æ¢ä»¶
    public bool CheckFlirtTalkUnlocked()
    {
        return GetCurrentAffection() >= 20;
    }
    
    // ä¸€èµ·å¤–å‡ºè§£é–æ¢ä»¶
    public bool CheckGoOutTogetherUnlocked()
    {
        return GetCurrentAffection() >= 30 && 
               GetCurrentTimeSlot() <= 6; // ä¸èƒ½å¤ªæ™š
    }
    
    // é‚€è«‹å–é…’è§£é–æ¢ä»¶ (å®¿èˆå°ˆç”¨)
    public bool CheckInviteDrinkingUnlocked()
    {
        return GetCurrentAffection() >= 40 && 
               !isWorkTime; // åªåœ¨å®¿èˆæ™‚å¯ç”¨
    }
}
```

---

## ğŸ¨ è¦–è¦ºåé¥‹ç³»çµ±

### âœ¨ **äº’å‹•åé¥‹è¨­è¨ˆ**
```csharp
public class InteractionFeedbackSystem : MonoBehaviour
{
    [Header("ç”±é¦™äº’å‹•åé¥‹")]
    public GameObject yukaHoverIndicator;
    public ParticleSystem yukaClickEffect;
    
    [Header("éœæ…‹ç‰©ä»¶åé¥‹")]
    public Dictionary<string, GameObject> objectHoverEffects;
    
    // ğŸ¯ ç”±é¦™Hoveræ•ˆæœ
    public void OnYukaHoverEnter()
    {
        yukaHoverIndicator.SetActive(true);
        PlayHoverAnimation(yukaInteractionButton);
    }
    
    public void OnYukaHoverExit()
    {
        yukaHoverIndicator.SetActive(false);
        StopHoverAnimation(yukaInteractionButton);
    }
    
    public void OnYukaClicked()
    {
        yukaClickEffect.Play();
        PlayClickAnimation(yukaInteractionButton);
    }
    
    // ğŸ¯ éœæ…‹ç‰©ä»¶åé¥‹
    public void OnStaticObjectHover(string objectName, bool isEnter)
    {
        if (objectHoverEffects.ContainsKey(objectName))
        {
            objectHoverEffects[objectName].SetActive(isEnter);
        }
    }
}
```

---

## ğŸ“Š å ´æ™¯ç‹€æ…‹ç®¡ç†

### ğŸ”„ **å ´æ™¯åˆ‡æ›é‚è¼¯**
```csharp
public class SceneStateManager : MonoBehaviour
{
    [Header("å ´æ™¯ç‹€æ…‹")]
    public bool isWorkTime;
    public int currentTimeSlot;
    public SceneLocation yukaCurrentLocation;
    
    public enum SceneLocation
    {
        WorkPlace,
        DormHall,
        YukaRoom  // å·²æ£„ç”¨ï¼Œæ”¹ç‚ºçµ±ä¸€åœ¨DormHall
    }
    
    // ğŸ• æ™‚é–“æ¨é€²æ™‚æ›´æ–°å ´æ™¯ç‹€æ…‹
    public void OnTimeAdvanced(int newTimeSlot)
    {
        currentTimeSlot = newTimeSlot;
        
        // åˆ¤æ–·å·¥ä½œæ™‚é–“ vs å®¿èˆæ™‚é–“
        isWorkTime = (newTimeSlot >= 1 && newTimeSlot <= 6);
        
        // ğŸ”¥ é‡è¦è®Šæ›´ï¼šå¤œæ™šçµ±ä¸€åœ¨å®¿èˆå¤§å»³
        if (newTimeSlot >= 7)
        {
            yukaCurrentLocation = SceneLocation.DormHall;
        }
        else if (isWorkTime)
        {
            yukaCurrentLocation = SceneLocation.WorkPlace;
        }
        else
        {
            yukaCurrentLocation = SceneLocation.DormHall;
        }
        
        // æ›´æ–°äº’å‹•ç³»çµ±
        interactionManager.UpdateAvailableInteractions();
    }
}
```

---

## ğŸ’¬ Claude é–‹ç™¼æç¤º

### ğŸ¯ **é‡è£½ç‰ˆé‡é»**
1. **Canvasåˆ†å±¤æ¶æ§‹** - åš´æ ¼æŒ‰ç…§7å±¤Canvasè¨­è¨ˆ
2. **é€æ˜Buttonè·Ÿéš¨** - æ ¸å¿ƒæŠ€è¡“ï¼šWorld/Screenåº§æ¨™è½‰æ›
3. **å ´æ™¯çµ±ä¸€åŒ–** - å¤œæ™šå ´æ™¯ä¸å†æœ‰ç”±é¦™æˆ¿é–“åˆ‡æ›
4. **æ¨¡çµ„åŒ–è¨­è¨ˆ** - å‹•æ…‹è§’è‰²èˆ‡éœæ…‹ç‰©ä»¶å®Œå…¨åˆ†é›¢

### ğŸ”§ **é–‹ç™¼æ³¨æ„äº‹é …**
- **æ€§èƒ½å„ªåŒ–** - Update()ä¸­çš„åº§æ¨™è½‰æ›è¦é«˜æ•ˆ
- **é‚Šç•Œæª¢æŸ¥** - ç¢ºä¿ç”±é¦™åœ¨è¢å¹•ç¯„åœå…§æ‰é¡¯ç¤ºButton
- **ç‹€æ…‹åŒæ­¥** - ç¢ºä¿æ‰€æœ‰ç®¡ç†å™¨ç‹€æ…‹ä¸€è‡´
- **å›æ»¾å®‰å…¨** - æ–°èˆŠç³»çµ±å®Œå…¨åˆ†é›¢

### ğŸš€ **æ“´å±•æ€§è€ƒé‡**
- æœªä¾†å¯è¼•é¬†æ·»åŠ æ–°çš„éœæ…‹ç‰©ä»¶äº’å‹•
- å‹•æ…‹è§’è‰²ç³»çµ±å¯æ“´å±•æ”¯æ´å¤šè§’è‰²
- Canvasæ¶æ§‹æ”¯æ´æ›´è¤‡é›œçš„UIå±¤ç´š
- è§£é–ç³»çµ±å¯é…ç½®åŒ–ç®¡ç†

---

**è¨­è¨ˆç‰ˆæœ¬**: 2.0 (é‡è£½ç‰ˆ)  
**æœ€å¾Œæ›´æ–°**: 2025-08-17  
**ç‹€æ…‹**: ğŸ”¥ **æº–å‚™å¯¦ä½œ**

> ğŸ® **é‡è£½ç‰ˆæ ¸å¿ƒ**: é€éå…¨æ–°çš„Canvasåˆ†å±¤æ¶æ§‹å’Œé€æ˜Buttonè·Ÿéš¨æŠ€è¡“ï¼Œå¯¦ç¾äº†å®Œç¾çš„ç§»å‹•è§’è‰²äº’å‹•é«”é©—ï¼ŒåŒæ™‚ç°¡åŒ–äº†å ´æ™¯ç®¡ç†é‚è¼¯ï¼Œç‚ºæœªä¾†æ“´å±•å¥ å®šäº†å …å¯¦åŸºç¤ï¼