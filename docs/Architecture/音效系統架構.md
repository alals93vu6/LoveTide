# ğŸµ éŸ³æ•ˆç³»çµ±æ¶æ§‹

> LoveTide çš„éŸ³æ•ˆç®¡ç†ã€æ’­æ”¾å’Œæ§åˆ¶ç³»çµ±æ¶æ§‹è¨­è¨ˆ

---

## ğŸ¯ æ¦‚è¿°

éŸ³æ•ˆç³»çµ±æ¶æ§‹è² è²¬ç®¡ç†éŠæˆ²ä¸­æ‰€æœ‰éŸ³æ•ˆçš„æ’­æ”¾ã€æ§åˆ¶å’Œå„ªåŒ–ï¼ŒåŒ…æ‹¬èƒŒæ™¯éŸ³æ¨‚ã€éŸ³æ•ˆã€èªéŸ³ç­‰å¤šç¨®éŸ³é »å…§å®¹ã€‚

---

## ğŸ§± éŸ³æ•ˆç³»çµ±çµæ§‹

### ğŸ“Š éŸ³æ•ˆåˆ†é¡æ¶æ§‹
```
ğŸµ Audio System
â”œâ”€â”€ ğŸ¶ BGM System (èƒŒæ™¯éŸ³æ¨‚)
â”‚   â”œâ”€â”€ ä¸»é¸å–®éŸ³æ¨‚
â”‚   â”œâ”€â”€ éŠæˆ²å ´æ™¯éŸ³æ¨‚
â”‚   â”œâ”€â”€ åŠ‡æƒ…éŸ³æ¨‚
â”‚   â””â”€â”€ ç‰¹æ®Šäº‹ä»¶éŸ³æ¨‚
â”œâ”€â”€ ğŸ”Š SFX System (éŸ³æ•ˆ)
â”‚   â”œâ”€â”€ UI æ“ä½œéŸ³æ•ˆ
â”‚   â”œâ”€â”€ éŠæˆ²å‹•ä½œéŸ³æ•ˆ
â”‚   â”œâ”€â”€ ç’°å¢ƒéŸ³æ•ˆ
â”‚   â””â”€â”€ å°éŠæˆ²éŸ³æ•ˆ
â”œâ”€â”€ ğŸ­ Voice System (èªéŸ³)
â”‚   â”œâ”€â”€ è§’è‰²å°è©±èªéŸ³
â”‚   â”œâ”€â”€ æ—ç™½èªéŸ³
â”‚   â””â”€â”€ ç‰¹æ®Šäº‹ä»¶èªéŸ³
â””â”€â”€ ğŸŒŠ Ambient System (ç’°å¢ƒéŸ³)
    â”œâ”€â”€ å ´æ™¯æ°›åœéŸ³
    â”œâ”€â”€ å¤©æ°£éŸ³æ•ˆ
    â””â”€â”€ æ™‚é–“è®ŠåŒ–éŸ³æ•ˆ
```

---

## ğŸ—ï¸ éŸ³æ•ˆç®¡ç†å™¨æ¶æ§‹

### ğŸ“‹ ä¸»è¦éŸ³æ•ˆç®¡ç†å™¨
```csharp
public class AudioManager : MonoBehaviour
{
    [Header("Audio Sources")]
    public AudioSource bgmSource;
    public AudioSource sfxSource;
    public AudioSource voiceSource;
    public AudioSource ambientSource;
    
    [Header("Audio Settings")]
    public float masterVolume = 1.0f;
    public float bgmVolume = 0.8f;
    public float sfxVolume = 1.0f;
    public float voiceVolume = 1.0f;
    public float ambientVolume = 0.6f;
    
    [Header("Audio Clips")]
    public AudioClipDatabase clipDatabase;
    
    public void PlayBGM(string clipName);
    public void PlaySFX(string clipName);
    public void PlayVoice(string clipName);
    public void PlayAmbient(string clipName);
}
```

### ğŸ¶ BGMæ§åˆ¶å™¨
```csharp
public class BGMController : MonoBehaviour
{
    [Header("BGM Settings")]
    public float fadeInDuration = 2.0f;
    public float fadeOutDuration = 1.0f;
    public bool loopBGM = true;
    
    private AudioSource audioSource;
    private Coroutine fadeCoroutine;
    
    public void PlayBGM(AudioClip clip, bool fadeIn = true);
    public void StopBGM(bool fadeOut = true);
    public void SetBGMVolume(float volume);
    public void PauseBGM();
    public void ResumeBGM();
}
```

---

## ğŸ® éŸ³æ•ˆè§¸ç™¼ç³»çµ±

### ğŸ“¡ äº‹ä»¶é©…å‹•éŸ³æ•ˆ
```csharp
public class AudioEventTrigger : MonoBehaviour
{
    [Header("Event Bindings")]
    public AudioEventBinding[] eventBindings;
    
    private void Start()
    {
        RegisterAudioEvents();
    }
    
    private void RegisterAudioEvents()
    {
        foreach (var binding in eventBindings)
        {
            EventBus.Instance.Subscribe(binding.eventName, OnAudioEvent);
        }
    }
    
    private void OnAudioEvent(object eventData)
    {
        var binding = GetBinding(eventData);
        if (binding != null)
        {
            PlayAudio(binding);
        }
    }
}
```

### ğŸ¯ éŸ³æ•ˆäº‹ä»¶é¡å‹
```csharp
public enum AudioEventType
{
    // UI Events
    ButtonClick,
    ButtonHover,
    PanelOpen,
    PanelClose,
    
    // Game Events
    DialogStart,
    DialogEnd,
    ChoiceSelect,
    SceneChange,
    
    // Story Events
    StoryComplete,
    AffectionIncrease,
    SpecialEvent,
    
    // Mini-Game Events
    GameStart,
    GameSuccess,
    GameFailure,
    ScoreUpdate
}
```

---

## ğŸ¨ éŸ³æ•ˆè³‡æºç®¡ç†

### ğŸ“¦ éŸ³æ•ˆè³‡æºåº«
```csharp
public class AudioClipDatabase : ScriptableObject
{
    [Header("BGM Clips")]
    public AudioClipEntry[] bgmClips;
    
    [Header("SFX Clips")]
    public AudioClipEntry[] sfxClips;
    
    [Header("Voice Clips")]
    public AudioClipEntry[] voiceClips;
    
    [Header("Ambient Clips")]
    public AudioClipEntry[] ambientClips;
    
    public AudioClip GetClip(string clipName, AudioCategory category);
    public AudioClip GetRandomClip(AudioCategory category);
}

[System.Serializable]
public class AudioClipEntry
{
    public string clipName;
    public AudioClip clip;
    public float volume = 1.0f;
    public float pitch = 1.0f;
    public bool randomizeVolume = false;
    public bool randomizePitch = false;
}
```

### ğŸ”„ éŸ³æ•ˆè¼‰å…¥ç­–ç•¥
```csharp
public class AudioLoader : MonoBehaviour
{
    [Header("Loading Strategy")]
    public AudioLoadingMode loadingMode = AudioLoadingMode.PreloadCritical;
    
    private Dictionary<string, AudioClip> loadedClips = new Dictionary<string, AudioClip>();
    
    public void PreloadAudio(string[] clipNames);
    public void LoadAudioAsync(string clipName, System.Action<AudioClip> callback);
    public void UnloadAudio(string clipName);
    public void UnloadAllAudio();
}
```

---

## ğŸ›ï¸ éŸ³æ•ˆæ§åˆ¶ç³»çµ±

### ğŸ”Š éŸ³é‡æ§åˆ¶
```csharp
public class VolumeController : MonoBehaviour
{
    [Header("Volume Settings")]
    public VolumeSettings defaultSettings;
    
    [Header("Fade Settings")]
    public float defaultFadeDuration = 1.0f;
    public AnimationCurve fadeInCurve = AnimationCurve.EaseInOut(0, 0, 1, 1);
    public AnimationCurve fadeOutCurve = AnimationCurve.EaseInOut(0, 1, 1, 0);
    
    public void SetMasterVolume(float volume);
    public void SetCategoryVolume(AudioCategory category, float volume);
    public void FadeIn(AudioSource source, float duration = -1);
    public void FadeOut(AudioSource source, float duration = -1);
    public void CrossFade(AudioSource from, AudioSource to, float duration = -1);
}
```

### ğŸšï¸ éŸ³æ•ˆæ··éŸ³
```csharp
public class AudioMixer : MonoBehaviour
{
    [Header("Mixer Settings")]
    public UnityEngine.Audio.AudioMixerGroup masterMixerGroup;
    public UnityEngine.Audio.AudioMixerGroup bgmMixerGroup;
    public UnityEngine.Audio.AudioMixerGroup sfxMixerGroup;
    public UnityEngine.Audio.AudioMixerGroup voiceMixerGroup;
    
    public void SetMixerVolume(string parameterName, float volume);
    public void SetLowPassFilter(string parameterName, float cutoff);
    public void SetHighPassFilter(string parameterName, float cutoff);
    public void SetReverb(string parameterName, float amount);
}
```

---

## ğŸ­ å ´æ™¯éŸ³æ•ˆæ•´åˆ

### ğŸ¬ å ´æ™¯éŸ³æ•ˆé…ç½®
```csharp
public class SceneAudioConfig : MonoBehaviour
{
    [Header("Scene Audio")]
    public string sceneBGM;
    public string sceneAmbient;
    public AudioClip[] sceneSFX;
    
    [Header("Transition Settings")]
    public bool fadeInOnStart = true;
    public bool fadeOutOnExit = true;
    public float transitionDuration = 2.0f;
    
    private void Start()
    {
        ApplySceneAudio();
    }
    
    private void ApplySceneAudio()
    {
        if (!string.IsNullOrEmpty(sceneBGM))
        {
            AudioManager.Instance.PlayBGM(sceneBGM);
        }
        
        if (!string.IsNullOrEmpty(sceneAmbient))
        {
            AudioManager.Instance.PlayAmbient(sceneAmbient);
        }
    }
}
```

### ğŸŒ… æ™‚é–“éŸ³æ•ˆè®ŠåŒ–
```csharp
public class TimeBasedAudio : MonoBehaviour
{
    [Header("Time Audio Settings")]
    public TimeAudioEntry[] timeAudios;
    
    private void Start()
    {
        TimeManager.Instance.OnTimeOfDayChanged.AddListener(OnTimeChanged);
    }
    
    private void OnTimeChanged(TimeOfDay newTime)
    {
        var audioEntry = GetAudioForTime(newTime);
        if (audioEntry != null)
        {
            AudioManager.Instance.PlayAmbient(audioEntry.ambientClip);
        }
    }
}
```

---

## ğŸ¤ èªéŸ³ç³»çµ±

### ğŸ—£ï¸ èªéŸ³æ’­æ”¾æ§åˆ¶
```csharp
public class VoiceController : MonoBehaviour
{
    [Header("Voice Settings")]
    public bool autoPlayVoice = true;
    public float voiceDelay = 0.1f;
    
    private AudioSource voiceSource;
    private Queue<AudioClip> voiceQueue = new Queue<AudioClip>();
    
    public void PlayVoice(string voiceName);
    public void QueueVoice(string voiceName);
    public void StopVoice();
    public void PauseVoice();
    public void ResumeVoice();
    public void SetVoiceSpeed(float speed);
}
```

### ğŸ­ è§’è‰²èªéŸ³ç®¡ç†
```csharp
public class CharacterVoiceManager : MonoBehaviour
{
    [Header("Character Voices")]
    public CharacterVoiceProfile[] voiceProfiles;
    
    [Header("Voice Settings")]
    public bool enableLipSync = false;
    public float lipSyncSensitivity = 0.1f;
    
    public void PlayCharacterVoice(string characterId, string voiceName);
    public void SetCharacterVoiceVolume(string characterId, float volume);
    public void SetCharacterVoicePitch(string characterId, float pitch);
}
```

---

## ğŸ® å°éŠæˆ²éŸ³æ•ˆ

### ğŸ£ å°éŠæˆ²éŸ³æ•ˆç®¡ç†
```csharp
public class MiniGameAudioManager : MonoBehaviour
{
    [Header("Mini-Game Audio")]
    public MiniGameAudioProfile[] gameAudioProfiles;
    
    [Header("Dynamic Audio")]
    public bool enableDynamicAudio = true;
    public float intensityChangeRate = 0.1f;
    
    public void StartMiniGameAudio(MiniGameType gameType);
    public void UpdateGameIntensity(float intensity);
    public void PlayGameEvent(string eventName);
    public void EndMiniGameAudio();
}
```

### ğŸ¯ å‹•æ…‹éŸ³æ•ˆèª¿æ•´
```csharp
public class DynamicAudioController : MonoBehaviour
{
    [Header("Dynamic Settings")]
    public AnimationCurve intensityCurve;
    public float maxIntensity = 1.0f;
    public float minIntensity = 0.1f;
    
    public void UpdateAudioIntensity(float gameIntensity)
    {
        float mappedIntensity = intensityCurve.Evaluate(gameIntensity);
        
        // èª¿æ•´éŸ³æ¨‚é€Ÿåº¦
        bgmSource.pitch = Mathf.Lerp(0.8f, 1.2f, mappedIntensity);
        
        // èª¿æ•´éŸ³æ•ˆéŸ³é‡
        sfxSource.volume = Mathf.Lerp(minIntensity, maxIntensity, mappedIntensity);
    }
}
```

---

## ğŸ”§ éŸ³æ•ˆå„ªåŒ–

### ğŸš€ æ€§èƒ½å„ªåŒ–
```csharp
public class AudioOptimizer : MonoBehaviour
{
    [Header("Optimization Settings")]
    public int maxSFXSources = 8;
    public float audioClipUnloadDelay = 30.0f;
    public bool enableAudioCompression = true;
    
    private Queue<AudioSource> availableSFXSources = new Queue<AudioSource>();
    private List<AudioSource> activeSFXSources = new List<AudioSource>();
    
    public AudioSource GetAvailableSFXSource();
    public void ReturnSFXSource(AudioSource source);
    public void OptimizeAudioMemory();
}
```

### ğŸ¯ è¨˜æ†¶é«”ç®¡ç†
```csharp
public class AudioMemoryManager : MonoBehaviour
{
    [Header("Memory Settings")]
    public int maxLoadedClips = 50;
    public float clipCacheTime = 60.0f;
    
    private Dictionary<string, AudioClipCacheEntry> clipCache = new Dictionary<string, AudioClipCacheEntry>();
    
    public void CacheAudioClip(string clipName, AudioClip clip);
    public void UnloadUnusedClips();
    public void ClearAudioCache();
}
```

---

## ğŸ”Š éŸ³æ•ˆè¨­å®šç³»çµ±

### âš™ï¸ éŸ³æ•ˆè¨­å®šç®¡ç†
```csharp
public class AudioSettings : MonoBehaviour
{
    [Header("Audio Settings")]
    public AudioSettingsData settingsData;
    
    public void LoadAudioSettings();
    public void SaveAudioSettings();
    public void ResetAudioSettings();
    public void ApplyAudioSettings(AudioSettingsData settings);
}

[System.Serializable]
public class AudioSettingsData
{
    public float masterVolume = 1.0f;
    public float bgmVolume = 0.8f;
    public float sfxVolume = 1.0f;
    public float voiceVolume = 1.0f;
    public float ambientVolume = 0.6f;
    public bool enableVoice = true;
    public bool enableSubtitles = true;
    public AudioQuality audioQuality = AudioQuality.High;
}
```

---

## ğŸ”Œ ç³»çµ±æ•´åˆ

### ğŸ“¡ èˆ‡å…¶ä»–ç³»çµ±çš„æ•´åˆ
```csharp
public class AudioSystemIntegration : MonoBehaviour
{
    private void Start()
    {
        // è¨»å†ŠéŠæˆ²äº‹ä»¶
        EventBus.Instance.Subscribe<SceneChangeEvent>("SceneChanged", OnSceneChanged);
        EventBus.Instance.Subscribe<DialogEvent>("DialogStart", OnDialogStart);
        EventBus.Instance.Subscribe<GameStateEvent>("GameStateChanged", OnGameStateChanged);
    }
    
    private void OnSceneChanged(SceneChangeEvent eventData)
    {
        // å ´æ™¯åˆ‡æ›æ™‚çš„éŸ³æ•ˆè™•ç†
        CrossFadeToSceneAudio(eventData.newSceneName);
    }
    
    private void OnDialogStart(DialogEvent eventData)
    {
        // å°è©±é–‹å§‹æ™‚çš„éŸ³æ•ˆè™•ç†
        PlayDialogAudio(eventData.dialogData);
    }
}
```

### ğŸ¯ éŸ³æ•ˆåŒæ­¥
- **èˆ‡å‹•ç•«åŒæ­¥**: éŸ³æ•ˆèˆ‡è§’è‰²å‹•ç•«åŒæ­¥
- **èˆ‡åŠ‡æƒ…åŒæ­¥**: éŸ³æ•ˆèˆ‡åŠ‡æƒ…ç¯€å¥åŒæ­¥
- **èˆ‡UIåŒæ­¥**: éŸ³æ•ˆèˆ‡UIå‹•ç•«åŒæ­¥
- **èˆ‡å°éŠæˆ²åŒæ­¥**: éŸ³æ•ˆèˆ‡éŠæˆ²ç‹€æ…‹åŒæ­¥

---

## ğŸ’¬ Claude ä½¿ç”¨æç¤º

äº†è§£éŸ³æ•ˆç³»çµ±æ™‚è«‹ï¼š
1. å…ˆç†è§£éŸ³æ•ˆåˆ†é¡å’Œç®¡ç†æ¶æ§‹
2. é—œæ³¨éŸ³æ•ˆè§¸ç™¼å’Œæ§åˆ¶æ©Ÿåˆ¶
3. æ³¨æ„æ€§èƒ½å„ªåŒ–å’Œè¨˜æ†¶é«”ç®¡ç†
4. ç†è§£èˆ‡å…¶ä»–ç³»çµ±çš„æ•´åˆæ–¹å¼
5. æ­é…é–±è®€ `CodeModules/bgmManager.md` äº†è§£å¯¦ä½œç´°ç¯€

ä¿®æ”¹éŸ³æ•ˆç³»çµ±æ™‚éœ€è¦ï¼š
- ç¢ºä¿éŸ³æ•ˆåˆ†é¡çš„æ­£ç¢ºæ€§
- æ¸¬è©¦å„ç¨®éŸ³æ•ˆè§¸ç™¼æƒ…æ³
- è€ƒæ…®æ€§èƒ½å’Œè¨˜æ†¶é«”å½±éŸ¿
- ä¿æŒéŸ³æ•ˆé¢¨æ ¼ä¸€è‡´æ€§
- æ›´æ–°ç›¸é—œçš„é…ç½®æ–‡ä»¶å’Œæ•¸æ“šåº«