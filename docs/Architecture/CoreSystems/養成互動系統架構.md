# ğŸ’– é¤Šæˆäº’å‹•ç³»çµ±æ¶æ§‹

> LoveTide é¤Šæˆäº’å‹•ç³»çµ±çš„å®Œæ•´æŠ€è¡“æ¶æ§‹è¨­è¨ˆï¼ŒåŒ…å«æ•¸å€¼ç®¡ç†ã€äº’å‹•æª¢æ¸¬ã€æ™‚é–“ç³»çµ±å’Œè§’è‰²é—œä¿‚ç™¼å±•

---

## ğŸ¯ æ¦‚è¿°

é¤Šæˆäº’å‹•ç³»çµ±æ¶æ§‹æ˜¯ LoveTide éŠæˆ²çš„æ ¸å¿ƒç©æ³•å¼•æ“ï¼Œè² è²¬ç®¡ç†è§’è‰²æ•¸å€¼ã€è™•ç†ç©å®¶äº’å‹•ã€æ§åˆ¶æ™‚é–“æµé€å’Œè¿½è¹¤é—œä¿‚ç™¼å±•ã€‚ç³»çµ±æ¡ç”¨äº‹ä»¶é©…å‹•æ¶æ§‹ï¼Œé€šéæ¨¡çµ„åŒ–çš„æ•¸å€¼ç®¡ç†å’Œéˆæ´»çš„äº’å‹•ç³»çµ±ï¼Œå¯¦ç¾äº†è±å¯Œå¤šæ¨£çš„é¤Šæˆé«”é©—ã€‚

---

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹åœ–

```
ğŸ’– é¤Šæˆäº’å‹•ç³»çµ±æ¶æ§‹
â”‚
â”œâ”€â”€ ğŸ“Š æ•¸å€¼ç®¡ç†å±¤ (Stats Management Layer)
â”‚   â”œâ”€â”€ NumericalRecords - æ ¸å¿ƒæ•¸å€¼è¨˜éŒ„ç³»çµ±
â”‚   â”œâ”€â”€ StatCalculationEngine - æ•¸å€¼è¨ˆç®—å¼•æ“
â”‚   â”œâ”€â”€ ProgressionManager - é€²åº¦ç®¡ç†å™¨
â”‚   â””â”€â”€ AffectionLevelManager - å¥½æ„Ÿåº¦ç­‰ç´šç®¡ç†å™¨
â”‚
â”œâ”€â”€ â° æ™‚é–“ç³»çµ±å±¤ (Time System Layer)
â”‚   â”œâ”€â”€ TimeManagerTest - æ™‚é–“ç®¡ç†å™¨
â”‚   â”œâ”€â”€ ScheduleManager - æ—¥ç¨‹ç®¡ç†å™¨
â”‚   â”œâ”€â”€ EventTimingController - äº‹ä»¶å®šæ™‚æ§åˆ¶å™¨
â”‚   â””â”€â”€ SeasonalEffectManager - å­£ç¯€æ•ˆæœç®¡ç†å™¨
â”‚
â”œâ”€â”€ ğŸ® äº’å‹•æ§åˆ¶å±¤ (Interaction Control Layer)
â”‚   â”œâ”€â”€ PlayerActorTest - ç©å®¶äº’å‹•æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ InteractionTypeManager - äº’å‹•é¡å‹ç®¡ç†å™¨
â”‚   â”œâ”€â”€ InteractionConditionChecker - äº’å‹•æ¢ä»¶æª¢æŸ¥å™¨
â”‚   â””â”€â”€ InteractionResultProcessor - äº’å‹•çµæœè™•ç†å™¨
â”‚
â”œâ”€â”€ ğŸ­ è§’è‰²ç³»çµ±å±¤ (Character System Layer)
â”‚   â”œâ”€â”€ ActorManagerTest - è§’è‰²ç®¡ç†å™¨
â”‚   â”œâ”€â”€ CharacterStateManager - è§’è‰²ç‹€æ…‹ç®¡ç†å™¨
â”‚   â”œâ”€â”€ EmotionSystemManager - æƒ…æ„Ÿç³»çµ±ç®¡ç†å™¨
â”‚   â””â”€â”€ RelationshipTracker - é—œä¿‚è¿½è¹¤å™¨
â”‚
â”œâ”€â”€ ğŸ¨ UIå±•ç¤ºå±¤ (UI Presentation Layer)
â”‚   â”œâ”€â”€ NurturingUIManager - é¤ŠæˆUIç®¡ç†å™¨
â”‚   â”œâ”€â”€ StatsDisplayController - æ•¸å€¼é¡¯ç¤ºæ§åˆ¶å™¨
â”‚   â”œâ”€â”€ InteractionFeedbackUI - äº’å‹•åé¥‹UI
â”‚   â””â”€â”€ ProgressVisualization - é€²åº¦è¦–è¦ºåŒ–
â”‚
â””â”€â”€ ğŸ”— æ•´åˆæœå‹™å±¤ (Integration Service Layer)
    â”œâ”€â”€ StoryModeIntegration - åŠ‡æƒ…æ¨¡å¼æ•´åˆ
    â”œâ”€â”€ MiniGameIntegration - å°éŠæˆ²æ•´åˆ
    â”œâ”€â”€ SaveSystemIntegration - å­˜æª”ç³»çµ±æ•´åˆ
    â””â”€â”€ EventBusIntegration - äº‹ä»¶ç³»çµ±æ•´åˆ
```

---

## ğŸ“Š æ•¸å€¼ç®¡ç†å±¤æ¶æ§‹

### ğŸ§® NumericalRecords æ ¸å¿ƒæ•¸å€¼è¨˜éŒ„ç³»çµ±
```csharp
public class NumericalRecords : MonoBehaviour
{
    [Header("åŸºç¤æ•¸å€¼")]
    public int friendship = 0;          // å¥½æ„Ÿåº¦
    public int slutty = 0;             // æ·«äº‚åº¦
    public int lust = 0;               // æ…¾æœ›å€¼
    public int money = 1000;           // é‡‘éŒ¢
    public int energy = 100;           // ç²¾åŠ›
    
    [Header("æ™‚é–“æ•¸å€¼")]
    public int aDay = 1;               // ç•¶å‰æ—¥æœŸ
    public int aWeek = 1;              // ç•¶å‰æ˜ŸæœŸ
    public int aTimer = 1;             // ç•¶å‰æ™‚é–“æ®µ
    public int totalDays = 0;          // ç¸½éŠç©å¤©æ•¸
    
    [Header("ç©å®¶è³‡è¨Š")]
    public string playerName = "ç©å®¶";
    public int playerLevel = 1;
    public int experience = 0;
    
    [Header("çµ±è¨ˆæ•¸æ“š")]
    public int totalInteractions = 0;   // ç¸½äº’å‹•æ¬¡æ•¸
    public int successfulInteractions = 0; // æˆåŠŸäº’å‹•æ¬¡æ•¸
    public Dictionary<string, int> interactionCounts; // å„é¡äº’å‹•è¨ˆæ•¸
    
    [Header("æ•¸å€¼é…ç½®")]
    public NumericalConfig numericalConfig;
    
    #region å–®ä¾‹æ¨¡å¼
    public static NumericalRecords Instance { get; private set; }
    
    void Awake()
    {
        if (Instance == null)
        {
            Instance = this;
            DontDestroyOnLoad(gameObject);
            InitializeNumericalSystem();
        }
        else
        {
            Destroy(gameObject);
        }
    }
    #endregion
    
    // ğŸš€ åˆå§‹åŒ–æ•¸å€¼ç³»çµ±
    void InitializeNumericalSystem()
    {
        // åˆå§‹åŒ–äº’å‹•è¨ˆæ•¸å™¨
        interactionCounts = new Dictionary<string, int>();
        
        // è¼‰å…¥é…ç½®
        LoadNumericalConfig();
        
        // è¨‚é–±äº‹ä»¶
        SubscribeToEvents();
        
        // è¼‰å…¥å­˜æª”æ•¸æ“š
        LoadFromSave();
    }
    
    // ğŸ“ˆ ä¿®æ”¹æ•¸å€¼
    public void ModifyStat(string statName, int changeValue)
    {
        int oldValue = GetStatValue(statName);
        int newValue = oldValue + changeValue;
        
        // æ‡‰ç”¨æ•¸å€¼é™åˆ¶
        newValue = ApplyStatLimits(statName, newValue);
        
        // è¨­å®šæ–°æ•¸å€¼
        SetStatValue(statName, newValue);
        
        // è§¸ç™¼æ•¸å€¼è®Šæ›´äº‹ä»¶
        OnStatChanged(statName, oldValue, newValue);
    }
    
    // ğŸ¯ ç²å–æ•¸å€¼
    public int GetStatValue(string statName)
    {
        switch (statName.ToLower())
        {
            case "friendship": return friendship;
            case "slutty": return slutty;
            case "lust": return lust;
            case "money": return money;
            case "energy": return energy;
            case "experience": return experience;
            default:
                Debug.LogWarning($"æœªçŸ¥çš„æ•¸å€¼åç¨±: {statName}");
                return 0;
        }
    }
    
    // ğŸ“ è¨­å®šæ•¸å€¼
    void SetStatValue(string statName, int value)
    {
        switch (statName.ToLower())
        {
            case "friendship":
                friendship = value;
                CheckFriendshipLevelUp();
                break;
            case "slutty":
                slutty = value;
                CheckSluttyLevelChange();
                break;
            case "lust":
                lust = value;
                CheckLustEffects();
                break;
            case "money":
                money = value;
                break;
            case "energy":
                energy = value;
                CheckEnergyEffects();
                break;
            case "experience":
                experience = value;
                CheckPlayerLevelUp();
                break;
        }
    }
    
    // ğŸ”’ æ‡‰ç”¨æ•¸å€¼é™åˆ¶
    int ApplyStatLimits(string statName, int value)
    {
        var limits = numericalConfig.GetStatLimits(statName);
        return Mathf.Clamp(value, limits.min, limits.max);
    }
    
    // ğŸ’ æª¢æŸ¥å¥½æ„Ÿåº¦ç­‰ç´šæå‡
    void CheckFriendshipLevelUp()
    {
        int currentLevel = PlayerPrefs.GetInt("FDS_LV", 0);
        int newLevel = CalculateFriendshipLevel(friendship);
        
        if (newLevel > currentLevel)
        {
            PlayerPrefs.SetInt("FDS_LV", newLevel);
            OnFriendshipLevelUp(currentLevel, newLevel);
        }
    }
    
    // ğŸ“Š è¨ˆç®—å¥½æ„Ÿåº¦ç­‰ç´š
    int CalculateFriendshipLevel(int friendshipValue)
    {
        if (friendshipValue >= numericalConfig.friendshipLevels[4]) return 4;
        if (friendshipValue >= numericalConfig.friendshipLevels[3]) return 3;
        if (friendshipValue >= numericalConfig.friendshipLevels[2]) return 2;
        if (friendshipValue >= numericalConfig.friendshipLevels[1]) return 1;
        return 0;
    }
    
    // ğŸŠ å¥½æ„Ÿåº¦ç­‰ç´šæå‡è™•ç†
    void OnFriendshipLevelUp(int oldLevel, int newLevel)
    {
        // è§¸ç™¼ç­‰ç´šæå‡äº‹ä»¶
        EventBus.Instance.Publish("FriendshipLevelUp", new FriendshipLevelUpEvent
        {
            oldLevel = oldLevel,
            newLevel = newLevel,
            currentFriendship = friendship
        });
        
        // è§£é–æ–°å…§å®¹
        UnlockContentForLevel(newLevel);
        
        // æ’­æ”¾ç­‰ç´šæå‡æ•ˆæœ
        PlayLevelUpEffects(newLevel);
    }
    
    // ğŸ”“ ç‚ºç­‰ç´šè§£é–å…§å®¹
    void UnlockContentForLevel(int level)
    {
        var unlockedContent = numericalConfig.GetUnlockedContentForLevel(level);
        
        foreach (string contentID in unlockedContent)
        {
            PlayerPrefs.SetInt($"Unlocked_{contentID}", 1);
            
            // è§¸ç™¼å…§å®¹è§£é–äº‹ä»¶
            EventBus.Instance.Publish("ContentUnlocked", new ContentUnlockedEvent
            {
                contentID = contentID,
                unlockedAt = level
            });
        }
        
        PlayerPrefs.Save();
    }
    
    // ğŸ“ˆ è¨˜éŒ„äº’å‹•
    public void RecordInteraction(string interactionType, bool successful = true)
    {
        totalInteractions++;
        
        if (successful)
        {
            successfulInteractions++;
        }
        
        // æ›´æ–°äº’å‹•é¡å‹è¨ˆæ•¸
        if (interactionCounts.ContainsKey(interactionType))
        {
            interactionCounts[interactionType]++;
        }
        else
        {
            interactionCounts[interactionType] = 1;
        }
        
        // è§¸ç™¼äº’å‹•è¨˜éŒ„äº‹ä»¶
        EventBus.Instance.Publish("InteractionRecorded", new InteractionRecordedEvent
        {
            interactionType = interactionType,
            successful = successful,
            totalCount = totalInteractions
        });
    }
    
    // ğŸ“Š ç²å–äº’å‹•çµ±è¨ˆ
    public InteractionStats GetInteractionStats()
    {
        return new InteractionStats
        {
            totalInteractions = totalInteractions,
            successfulInteractions = successfulInteractions,
            successRate = totalInteractions > 0 ? (float)successfulInteractions / totalInteractions : 0f,
            interactionBreakdown = new Dictionary<string, int>(interactionCounts)
        };
    }
    
    // ğŸ“¡ æ•¸å€¼è®Šæ›´äº‹ä»¶è™•ç†
    void OnStatChanged(string statName, int oldValue, int newValue)
    {
        EventBus.Instance.Publish("StatChanged", new StatChangedEvent
        {
            statName = statName,
            oldValue = oldValue,
            newValue = newValue,
            changeAmount = newValue - oldValue
        });
        
        // è¨˜éŒ„æ•¸å€¼è®Šæ›´æ­·å²
        RecordStatChangeHistory(statName, oldValue, newValue);
    }
    
    // ğŸ“ è¨˜éŒ„æ•¸å€¼è®Šæ›´æ­·å²
    void RecordStatChangeHistory(string statName, int oldValue, int newValue)
    {
        var historyEntry = new StatChangeHistoryEntry
        {
            statName = statName,
            oldValue = oldValue,
            newValue = newValue,
            timestamp = System.DateTime.Now,
            gameDay = aDay
        };
        
        // ä¿å­˜åˆ°æ­·å²è¨˜éŒ„ä¸­ï¼ˆå¯ä»¥å¯¦ä½œæŒä¹…åŒ–å­˜å„²ï¼‰
        SaveStatChangeHistory(historyEntry);
    }
}
```

### ğŸ§® StatCalculationEngine æ•¸å€¼è¨ˆç®—å¼•æ“
```csharp
public class StatCalculationEngine : MonoBehaviour  
{
    [Header("è¨ˆç®—é…ç½®")]
    public StatCalculationConfig calculationConfig;
    
    [Header("æ•ˆæœç³»çµ±")]
    public List<StatEffect> activeEffects;
    public Dictionary<string, float> statModifiers;
    
    void Start()
    {
        InitializeCalculationEngine();
    }
    
    // ğŸš€ åˆå§‹åŒ–è¨ˆç®—å¼•æ“
    void InitializeCalculationEngine()
    {
        activeEffects = new List<StatEffect>();
        statModifiers = new Dictionary<string, float>();
        
        // è¼‰å…¥åŸºç¤æ•¸å€¼ä¿®æ­£å™¨
        LoadBaseModifiers();
        
        // è¨‚é–±ç›¸é—œäº‹ä»¶
        EventBus.Instance.Subscribe<TimeAdvancedEvent>("TimeAdvanced", OnTimeAdvanced);
        EventBus.Instance.Subscribe<InteractionCompleteEvent>("InteractionComplete", OnInteractionComplete);
    }
    
    // ğŸ¯ è¨ˆç®—äº’å‹•çµæœ
    public InteractionResult CalculateInteractionResult(InteractionData interactionData)
    {
        var result = new InteractionResult
        {
            interactionType = interactionData.type,
            baseSuccess = CalculateBaseSuccess(interactionData),
            statChanges = CalculateStatChanges(interactionData),
            specialEffects = CalculateSpecialEffects(interactionData)
        };
        
        // æ‡‰ç”¨éš¨æ©Ÿå› ç´ 
        ApplyRandomFactors(result);
        
        // æ‡‰ç”¨ç•¶å‰æ•ˆæœä¿®æ­£
        ApplyActiveEffects(result);
        
        return result;
    }
    
    // ğŸ² è¨ˆç®—åŸºç¤æˆåŠŸç‡
    float CalculateBaseSuccess(InteractionData interactionData)
    {
        float baseRate = interactionData.baseSuccessRate;
        
        // æ ¹æ“šå¥½æ„Ÿåº¦ç­‰ç´šèª¿æ•´
        int friendshipLevel = PlayerPrefs.GetInt("FDS_LV", 0);
        float friendshipModifier = calculationConfig.friendshipSuccessModifiers[friendshipLevel];
        
        // æ ¹æ“šæ™‚é–“èª¿æ•´
        float timeModifier = GetTimeModifier();
        
        // æ ¹æ“šç²¾åŠ›èª¿æ•´
        float energyModifier = GetEnergyModifier();
        
        // è¨ˆç®—æœ€çµ‚æˆåŠŸç‡
        float finalRate = baseRate * friendshipModifier * timeModifier * energyModifier;
        
        return Mathf.Clamp01(finalRate);
    }
    
    // ğŸ“Š è¨ˆç®—æ•¸å€¼è®ŠåŒ–
    Dictionary<string, int> CalculateStatChanges(InteractionData interactionData)
    {
        var changes = new Dictionary<string, int>();
        
        foreach (var statChange in interactionData.statChanges)
        {
            int baseChange = statChange.baseValue;
            
            // æ‡‰ç”¨æ•¸å€¼ä¿®æ­£å™¨
            float modifier = GetStatModifier(statChange.statName);
            int finalChange = Mathf.RoundToInt(baseChange * modifier);
            
            // æ‡‰ç”¨éš¨æ©Ÿè®ŠåŒ–
            if (statChange.hasRandomVariation)
            {
                float randomFactor = Random.Range(0.8f, 1.2f);
                finalChange = Mathf.RoundToInt(finalChange * randomFactor);
            }
            
            changes[statChange.statName] = finalChange;
        }
        
        return changes;
    }
    
    // âœ¨ è¨ˆç®—ç‰¹æ®Šæ•ˆæœ
    List<SpecialEffect> CalculateSpecialEffects(InteractionData interactionData)
    {
        var effects = new List<SpecialEffect>();
        
        // æª¢æŸ¥è§¸ç™¼æ¢ä»¶
        foreach (var potentialEffect in interactionData.potentialEffects)
        {
            if (CheckEffectTriggerCondition(potentialEffect))
            {
                effects.Add(potentialEffect);
            }
        }
        
        // æª¢æŸ¥çµ„åˆæ•ˆæœ
        CheckComboEffects(interactionData, effects);
        
        return effects;
    }
    
    // ğŸ• ç²å–æ™‚é–“ä¿®æ­£å™¨
    float GetTimeModifier()
    {
        var timeManager = FindObjectOfType<TimeManagerTest>();
        if (timeManager != null)
        {
            int currentTime = timeManager.aTimer;
            return calculationConfig.timeModifiers.ContainsKey(currentTime) ? 
                   calculationConfig.timeModifiers[currentTime] : 1.0f;
        }
        return 1.0f;
    }
    
    // âš¡ ç²å–ç²¾åŠ›ä¿®æ­£å™¨
    float GetEnergyModifier()
    {
        var numericalRecords = FindObjectOfType<NumericalRecords>();
        if (numericalRecords != null)
        {
            int energy = numericalRecords.energy;
            
            if (energy >= 80) return 1.2f;      // ç²¾åŠ›å……æ²›
            if (energy >= 60) return 1.0f;      // æ­£å¸¸
            if (energy >= 40) return 0.9f;      // æœ‰äº›ç–²æ†Š
            if (energy >= 20) return 0.7f;      // ç–²æ†Š
            return 0.5f;                        // éå¸¸ç–²æ†Š
        }
        return 1.0f;
    }
    
    // ğŸ² æ‡‰ç”¨éš¨æ©Ÿå› ç´ 
    void ApplyRandomFactors(InteractionResult result)
    {
        // çˆ†æ“Šç³»çµ±
        float criticalChance = calculationConfig.baseCriticalChance;
        if (Random.value < criticalChance)
        {
            result.isCritical = true;
            
            // çˆ†æ“Šæ•ˆæœï¼šæ•¸å€¼è®ŠåŒ–ç¿»å€
            var newStatChanges = new Dictionary<string, int>();
            foreach (var kvp in result.statChanges)
            {
                newStatChanges[kvp.Key] = kvp.Value * 2;
            }
            result.statChanges = newStatChanges;
        }
        
        // å¤±æ•—æ‡²ç½°ç³»çµ±
        if (result.baseSuccess < 0.3f && Random.value < 0.1f)
        {
            result.hasPenalty = true;
            
            // æ·»åŠ ç²¾åŠ›æ‡²ç½°
            if (!result.statChanges.ContainsKey("energy"))
            {
                result.statChanges["energy"] = -5;
            }
            else
            {
                result.statChanges["energy"] -= 5;
            }
        }
    }
    
    // ğŸ“¡ æ™‚é–“æ¨é€²äº‹ä»¶è™•ç†
    void OnTimeAdvanced(TimeAdvancedEvent eventData)
    {
        // æ›´æ–°æ™‚é–“ç›¸é—œçš„æ•¸å€¼ä¿®æ­£å™¨
        UpdateTimeBasedModifiers(eventData.newTime);
        
        // è™•ç†å®šæ™‚æ•ˆæœ
        ProcessTimedEffects();
        
        // è‡ªç„¶æ•¸å€¼è¡°æ¸›
        ApplyNaturalDecay();
    }
    
    // ğŸ“ˆ è‡ªç„¶æ•¸å€¼è¡°æ¸›
    void ApplyNaturalDecay()
    {
        var numericalRecords = FindObjectOfType<NumericalRecords>();
        if (numericalRecords != null)
        {
            // æ…¾æœ›å€¼è‡ªç„¶è¡°æ¸›
            if (numericalRecords.lust > 0)
            {
                int lustDecay = calculationConfig.dailyLustDecay;
                numericalRecords.ModifyStat("lust", -lustDecay);
            }
            
            // ç²¾åŠ›è‡ªç„¶æ¢å¾©
            if (numericalRecords.energy < 100)
            {
                int energyRestore = calculationConfig.dailyEnergyRestore;
                numericalRecords.ModifyStat("energy", energyRestore);
            }
        }
    }
}
```

---

## â° æ™‚é–“ç³»çµ±å±¤æ¶æ§‹

### ğŸ• TimeManagerTest æ™‚é–“ç®¡ç†å™¨
```csharp
public class TimeManagerTest : MonoBehaviour
{
    [Header("æ™‚é–“ç‹€æ…‹")]
    public int aDay = 1;               // ç•¶å‰æ—¥æœŸ
    public int aWeek = 1;              // ç•¶å‰æ˜ŸæœŸ (1-7)
    public int aTimer = 1;             // ç•¶å‰æ™‚é–“æ®µ (1-9)
    public int totalDays = 0;          // ç¸½éŠç©å¤©æ•¸
    
    [Header("æ™‚é–“é…ç½®")]
    public TimeConfig timeConfig;
    public float realTimeToGameTimeRatio = 1.0f; // ç¾å¯¦æ™‚é–“åˆ°éŠæˆ²æ™‚é–“çš„æ¯”ä¾‹
    
    [Header("äº‹ä»¶ç³»çµ±")]
    public List<TimedEvent> scheduledEvents;
    public Dictionary<int, List<string>> dailyEvents; // æ¯æ—¥äº‹ä»¶
    
    [Header("æ™‚é–“æ•ˆæœ")]
    public Dictionary<int, TimeEffect> timeEffects; // ä¸åŒæ™‚é–“æ®µçš„æ•ˆæœ
    
    void Start()
    {
        InitializeTimeSystem();
    }
    
    // ğŸš€ åˆå§‹åŒ–æ™‚é–“ç³»çµ±
    void InitializeTimeSystem()
    {
        // è¼‰å…¥æ™‚é–“é…ç½®
        LoadTimeConfiguration();
        
        // åˆå§‹åŒ–äº‹ä»¶ç³»çµ±
        InitializeEventSystem();
        
        // è¼‰å…¥å­˜æª”æ™‚é–“
        LoadTimeFromSave();
        
        // é–‹å§‹æ™‚é–“å¾ªç’°
        StartTimeLoop();
    }
    
    // â° æ¨é€²æ™‚é–“
    public void AdvanceTime(int timeUnits = 1)
    {
        for (int i = 0; i < timeUnits; i++)
        {
            AdvanceSingleTimeUnit();
        }
    }
    
    // â±ï¸ æ¨é€²å–®å€‹æ™‚é–“å–®ä½
    void AdvanceSingleTimeUnit()
    {
        int oldTimer = aTimer;
        int oldDay = aDay;
        int oldWeek = aWeek;
        
        aTimer++;
        
        // æª¢æŸ¥æ˜¯å¦éœ€è¦æ¨é€²åˆ°ä¸‹ä¸€å¤©
        if (aTimer > timeConfig.timeUnitsPerDay)
        {
            AdvanceToNextDay();
        }
        
        // è§¸ç™¼æ™‚é–“æ¨é€²äº‹ä»¶
        OnTimeAdvanced(oldTimer, oldDay, oldWeek);
    }
    
    // ğŸŒ… æ¨é€²åˆ°ä¸‹ä¸€å¤©
    void AdvanceToNextDay()
    {
        aDay++;
        totalDays++;
        aTimer = 1;
        
        // æ¨é€²æ˜ŸæœŸ
        aWeek++;
        if (aWeek > 7)
        {
            aWeek = 1;
        }
        
        // è§¸ç™¼æ–°ä¸€å¤©äº‹ä»¶
        OnNewDayStarted();
        
        // è™•ç†æ¯æ—¥äº‹ä»¶
        ProcessDailyEvents();
        
        // æ‡‰ç”¨æ¯æ—¥æ•ˆæœ
        ApplyDailyEffects();
    }
    
    // ğŸŒŸ æ–°ä¸€å¤©é–‹å§‹è™•ç†
    void OnNewDayStarted()
    {
        EventBus.Instance.Publish("NewDayStarted", new NewDayStartedEvent
        {
            newDay = aDay,
            newWeek = aWeek,
            totalDays = totalDays
        });
        
        // é‡ç½®æ¯æ—¥æ•¸å€¼
        ResetDailyValues();
        
        // ç”Ÿæˆä»Šæ—¥äº‹ä»¶
        GenerateDailyEvents();
    }
    
    // ğŸ”„ é‡ç½®æ¯æ—¥æ•¸å€¼
    void ResetDailyValues()
    {
        var numericalRecords = FindObjectOfType<NumericalRecords>();
        if (numericalRecords != null)
        {
            // ç²¾åŠ›æ¢å¾©
            numericalRecords.ModifyStat("energy", timeConfig.dailyEnergyRestore);
            
            // å…¶ä»–æ¯æ—¥é‡ç½®æ•¸å€¼
            foreach (var resetValue in timeConfig.dailyResets)
            {
                numericalRecords.ModifyStat(resetValue.statName, resetValue.resetAmount);
            }
        }
    }
    
    // ğŸ“… ç”Ÿæˆæ¯æ—¥äº‹ä»¶
    void GenerateDailyEvents()
    {
        // æ¸…é™¤æ˜¨æ—¥äº‹ä»¶
        if (dailyEvents.ContainsKey(aDay - 1))
        {
            dailyEvents.Remove(aDay - 1);
        }
        
        // ç”Ÿæˆä»Šæ—¥äº‹ä»¶
        var todayEvents = new List<string>();
        
        // æ ¹æ“šæ˜ŸæœŸç”Ÿæˆç‰¹å®šäº‹ä»¶
        var weeklyEvents = timeConfig.GetEventsForWeekday(aWeek);
        todayEvents.AddRange(weeklyEvents);
        
        // éš¨æ©Ÿäº‹ä»¶
        if (Random.value < timeConfig.randomEventChance)
        {
            string randomEvent = timeConfig.GetRandomEvent();
            if (!string.IsNullOrEmpty(randomEvent))
            {
                todayEvents.Add(randomEvent);
            }
        }
        
        // ç‰¹æ®Šæ—¥æœŸäº‹ä»¶
        var specialEvents = timeConfig.GetSpecialEventsForDay(aDay);
        todayEvents.AddRange(specialEvents);
        
        dailyEvents[aDay] = todayEvents;
        
        // é€šçŸ¥äº‹ä»¶ç”Ÿæˆ
        if (todayEvents.Count > 0)
        {
            EventBus.Instance.Publish("DailyEventsGenerated", new DailyEventsGeneratedEvent
            {
                day = aDay,
                events = todayEvents
            });
        }
    }
    
    // ğŸ¯ ç²å–ç•¶å‰æ™‚é–“æè¿°
    public string GetTimeDescription()
    {
        return timeConfig.GetTimeDescription(aTimer);
    }
    
    // ğŸ“Š ç²å–æ™‚é–“çµ±è¨ˆ
    public TimeStatistics GetTimeStatistics()
    {
        return new TimeStatistics
        {
            currentDay = aDay,
            currentWeek = aWeek,
            currentTimeUnit = aTimer,
            totalDaysPlayed = totalDays,
            currentTimeDescription = GetTimeDescription(),
            todayEvents = dailyEvents.ContainsKey(aDay) ? dailyEvents[aDay] : new List<string>()
        };
    }
    
    // ğŸ“¡ æ™‚é–“æ¨é€²äº‹ä»¶è™•ç†
    void OnTimeAdvanced(int oldTimer, int oldDay, int oldWeek)
    {
        EventBus.Instance.Publish("TimeAdvanced", new TimeAdvancedEvent
        {
            oldTime = oldTimer,
            newTime = aTimer,
            oldDay = oldDay,
            newDay = aDay,
            dayChanged = (oldDay != aDay)
        });
        
        // æª¢æŸ¥å®šæ™‚äº‹ä»¶
        CheckScheduledEvents();
        
        // æ‡‰ç”¨æ™‚é–“æ•ˆæœ
        ApplyTimeEffects();
    }
    
    // â° æª¢æŸ¥å®šæ™‚äº‹ä»¶
    void CheckScheduledEvents()
    {
        var eventsToTrigger = scheduledEvents.Where(e => 
            e.targetDay == aDay && e.targetTime == aTimer).ToList();
        
        foreach (var timedEvent in eventsToTrigger)
        {
            TriggerTimedEvent(timedEvent);
            
            // ç§»é™¤ä¸€æ¬¡æ€§äº‹ä»¶
            if (!timedEvent.isRepeating)
            {
                scheduledEvents.Remove(timedEvent);
            }
        }
    }
    
    // ğŸ­ è§¸ç™¼å®šæ™‚äº‹ä»¶
    void TriggerTimedEvent(TimedEvent timedEvent)
    {
        EventBus.Instance.Publish("TimedEventTriggered", new TimedEventTriggeredEvent
        {
            eventID = timedEvent.eventID,
            eventType = timedEvent.eventType,
            eventData = timedEvent.eventData
        });
        
        // åŸ·è¡Œäº‹ä»¶æ•ˆæœ
        ExecuteEventEffects(timedEvent);
    }
    
    // ğŸ’¾ ä¿å­˜æ™‚é–“åˆ°å­˜æª”
    public void SaveTimeToSave()
    {
        PlayerPrefs.SetInt("CurrentDay", aDay);
        PlayerPrefs.SetInt("CurrentWeek", aWeek);
        PlayerPrefs.SetInt("CurrentTimer", aTimer);
        PlayerPrefs.SetInt("TotalDays", totalDays);
        PlayerPrefs.Save();
    }
    
    // ğŸ“– å¾å­˜æª”è¼‰å…¥æ™‚é–“
    void LoadTimeFromSave()
    {
        aDay = PlayerPrefs.GetInt("CurrentDay", 1);
        aWeek = PlayerPrefs.GetInt("CurrentWeek", 1);
        aTimer = PlayerPrefs.GetInt("CurrentTimer", 1);
        totalDays = PlayerPrefs.GetInt("TotalDays", 0);
    }
}
```

---

## ğŸ® äº’å‹•æ§åˆ¶å±¤æ¶æ§‹

### ğŸ‘† PlayerActorTest ç©å®¶äº’å‹•æ§åˆ¶å™¨
```csharp
public class PlayerActorTest : MonoBehaviour
{
    [Header("äº’å‹•çµ„ä»¶")]
    public InteractionTypeManager interactionManager;
    public InteractionConditionChecker conditionChecker;
    public InteractionResultProcessor resultProcessor;
    
    [Header("æ•¸å€¼ç³»çµ±")]
    public NumericalRecords numericalRecords;
    public StatCalculationEngine calculationEngine;
    
    [Header("UIçµ„ä»¶")]
    public InteractionMenuUI interactionMenu;
    public InteractionFeedbackUI feedbackUI;
    
    [Header("äº’å‹•é…ç½®")]
    public InteractionConfig interactionConfig;
    
    void Start()
    {
        InitializeInteractionSystem();
    }
    
    // ğŸš€ åˆå§‹åŒ–äº’å‹•ç³»çµ±
    void InitializeInteractionSystem()
    {
        // è¼‰å…¥äº’å‹•é…ç½®
        LoadInteractionConfiguration();
        
        // è¨‚é–±äº‹ä»¶
        SubscribeToEvents();
        
        // åˆå§‹åŒ–UI
        InitializeInteractionUI();
    }
    
    // ğŸ’¬ æ™®é€šå°è©±äº’å‹•
    public void Interactive_Speak()
    {
        var interactionData = new InteractionData
        {
            type = InteractionType.Speak,
            energyCost = 5,
            baseSuccessRate = 0.8f,
            statChanges = new List<StatChange>
            {
                new StatChange { statName = "friendship", baseValue = 2 },
                new StatChange { statName = "energy", baseValue = -5 }
            }
        };
        
        ProcessInteraction(interactionData);
    }
    
    // ğŸ’• æƒ…è©±äº’å‹•
    public void Interactive_FlirtTalk()
    {
        // æª¢æŸ¥è§£é–æ¢ä»¶
        if (!conditionChecker.CheckInteractionUnlocked(InteractionType.FlirtTalk))
        {
            ShowInteractionLockedMessage(InteractionType.FlirtTalk);
            return;
        }
        
        var interactionData = new InteractionData
        {
            type = InteractionType.FlirtTalk,
            energyCost = 10,
            baseSuccessRate = 0.6f,
            statChanges = new List<StatChange>
            {
                new StatChange { statName = "friendship", baseValue = 3 },
                new StatChange { statName = "lust", baseValue = 1 },
                new StatChange { statName = "energy", baseValue = -10 }
            },
            requiredFriendshipLevel = 1
        };
        
        ProcessInteraction(interactionData);
    }
    
    // ğŸ’¼ å·¥ä½œäº’å‹•
    public void Interactive_Operate()
    {
        var interactionData = new InteractionData
        {
            type = InteractionType.Work,
            energyCost = 15,
            baseSuccessRate = 0.9f,
            statChanges = new List<StatChange>
            {
                new StatChange { statName = "money", baseValue = 50 },
                new StatChange { statName = "energy", baseValue = -15 },
                new StatChange { statName = "friendship", baseValue = 1 }
            }
        };
        
        ProcessInteraction(interactionData);
    }
    
    // ğŸ® è™•ç†äº’å‹•
    void ProcessInteraction(InteractionData interactionData)
    {
        // 1. æª¢æŸ¥äº’å‹•æ¢ä»¶
        if (!conditionChecker.CheckInteractionConditions(interactionData))
        {
            ShowInteractionFailedMessage("ä¸æ»¿è¶³äº’å‹•æ¢ä»¶");
            return;
        }
        
        // 2. æª¢æŸ¥è³‡æºæ¶ˆè€—
        if (!CheckResourceAvailability(interactionData))
        {
            ShowInteractionFailedMessage("ç²¾åŠ›ä¸è¶³");
            return;
        }
        
        // 3. è¨ˆç®—äº’å‹•çµæœ
        var result = calculationEngine.CalculateInteractionResult(interactionData);
        
        // 4. è™•ç†äº’å‹•çµæœ
        resultProcessor.ProcessInteractionResult(result);
        
        // 5. æ›´æ–°æ•¸å€¼
        ApplyInteractionResult(result);
        
        // 6. é¡¯ç¤ºåé¥‹
        ShowInteractionFeedback(result);
        
        // 7. è¨˜éŒ„äº’å‹•
        RecordInteractionData(interactionData, result);
        
        // 8. æ¨é€²æ™‚é–“
        AdvanceTime(interactionData.timeCost);
    }
    
    // ğŸ’° æª¢æŸ¥è³‡æºå¯ç”¨æ€§
    bool CheckResourceAvailability(InteractionData interactionData)
    {
        // æª¢æŸ¥ç²¾åŠ›
        if (numericalRecords.energy < interactionData.energyCost)
        {
            return false;
        }
        
        // æª¢æŸ¥é‡‘éŒ¢ï¼ˆå¦‚æœéœ€è¦ï¼‰
        if (interactionData.moneyCost > 0 && numericalRecords.money < interactionData.moneyCost)
        {
            return false;
        }
        
        return true;
    }
    
    // ğŸ“Š æ‡‰ç”¨äº’å‹•çµæœ
    void ApplyInteractionResult(InteractionResult result)
    {
        foreach (var statChange in result.statChanges)
        {
            numericalRecords.ModifyStat(statChange.Key, statChange.Value);
        }
        
        // æ‡‰ç”¨ç‰¹æ®Šæ•ˆæœ
        foreach (var effect in result.specialEffects)
        {
            ApplySpecialEffect(effect);
        }
    }
    
    // âœ¨ æ‡‰ç”¨ç‰¹æ®Šæ•ˆæœ
    void ApplySpecialEffect(SpecialEffect effect)
    {
        switch (effect.effectType)
        {
            case EffectType.TemporaryStatBoost:
                ApplyTemporaryStatBoost(effect);
                break;
                
            case EffectType.UnlockContent:
                UnlockContent(effect.contentID);
                break;
                
            case EffectType.TriggerEvent:
                TriggerSpecialEvent(effect.eventID);
                break;
                
            case EffectType.ChangeRelationship:
                ChangeRelationshipStatus(effect.relationshipChange);
                break;
        }
    }
    
    // ğŸ“ˆ é¡¯ç¤ºäº’å‹•åé¥‹
    void ShowInteractionFeedback(InteractionResult result)
    {
        var feedbackData = new InteractionFeedbackData
        {
            interactionType = result.interactionType,
            success = result.baseSuccess > 0.5f,
            isCritical = result.isCritical,
            statChanges = result.statChanges,
            specialEffects = result.specialEffects
        };
        
        feedbackUI.ShowFeedback(feedbackData);
    }
    
    // ğŸ“ è¨˜éŒ„äº’å‹•æ•¸æ“š
    void RecordInteractionData(InteractionData interactionData, InteractionResult result)
    {
        // æ›´æ–°äº’å‹•çµ±è¨ˆ
        numericalRecords.RecordInteraction(
            interactionData.type.ToString(), 
            result.baseSuccess > 0.5f
        );
        
        // è§¸ç™¼äº’å‹•å®Œæˆäº‹ä»¶
        EventBus.Instance.Publish("InteractionComplete", new InteractionCompleteEvent
        {
            interactionType = interactionData.type,
            result = result,
            timestamp = System.DateTime.Now
        });
    }
    
    // â° æ¨é€²æ™‚é–“
    void AdvanceTime(int timeCost)
    {
        var timeManager = FindObjectOfType<TimeManagerTest>();
        if (timeManager != null)
        {
            timeManager.AdvanceTime(timeCost);
        }
    }
    
    // ğŸ“‹ ç²å–å¯ç”¨äº’å‹•åˆ—è¡¨
    public List<InteractionType> GetAvailableInteractions()
    {
        var availableInteractions = new List<InteractionType>();
        
        foreach (InteractionType interactionType in System.Enum.GetValues(typeof(InteractionType)))
        {
            if (conditionChecker.CheckInteractionUnlocked(interactionType))
            {
                availableInteractions.Add(interactionType);
            }
        }
        
        return availableInteractions;
    }
    
    // ğŸ¯ é¡¯ç¤ºäº’å‹•é¸å–®
    public void ShowInteractionMenu()
    {
        var availableInteractions = GetAvailableInteractions();
        interactionMenu.ShowMenu(availableInteractions);
    }
}
```

---

## ğŸ”— æ•´åˆæœå‹™å±¤æ¶æ§‹

### ğŸ­ StoryModeIntegration åŠ‡æƒ…æ¨¡å¼æ•´åˆ
```csharp
public class StoryModeIntegration : MonoBehaviour
{
    [Header("ç³»çµ±å¼•ç”¨")]
    public NumericalRecords numericalRecords;
    public TimeManagerTest timeManager;
    public StoryProgressTracker storyTracker;
    
    void Start()
    {
        InitializeIntegration();
    }
    
    // ğŸš€ åˆå§‹åŒ–æ•´åˆ
    void InitializeIntegration()
    {
        // è¨‚é–±é¤Šæˆç³»çµ±äº‹ä»¶
        EventBus.Instance.Subscribe<FriendshipLevelUpEvent>("FriendshipLevelUp", OnFriendshipLevelUp);
        EventBus.Instance.Subscribe<StatChangedEvent>("StatChanged", OnStatChanged);
        EventBus.Instance.Subscribe<NewDayStartedEvent>("NewDayStarted", OnNewDayStarted);
        
        // è¨‚é–±åŠ‡æƒ…ç³»çµ±äº‹ä»¶
        EventBus.Instance.Subscribe<StoryCompleteEvent>("StoryComplete", OnStoryComplete);
    }
    
    // ğŸ’ å¥½æ„Ÿåº¦ç­‰ç´šæå‡è™•ç†
    void OnFriendshipLevelUp(FriendshipLevelUpEvent eventData)
    {
        // æª¢æŸ¥æ˜¯å¦è§¸ç™¼æ–°åŠ‡æƒ…
        CheckForNewStoryUnlocks(eventData.newLevel);
        
        // æ›´æ–°å¯ç”¨äº’å‹•
        UpdateAvailableInteractions(eventData.newLevel);
    }
    
    // ğŸ“Š æ•¸å€¼è®Šæ›´è™•ç†
    void OnStatChanged(StatChangedEvent eventData)
    {
        // æª¢æŸ¥ç‰¹æ®Šæ•¸å€¼è§¸ç™¼åŠ‡æƒ…
        CheckStatTriggeredStories(eventData);
    }
    
    // ğŸŒ… æ–°ä¸€å¤©é–‹å§‹è™•ç†
    void OnNewDayStarted(NewDayStartedEvent eventData)
    {
        // æª¢æŸ¥æ—¥æœŸè§¸ç™¼çš„åŠ‡æƒ…
        CheckDateTriggeredStories(eventData.newDay);
    }
    
    // ğŸ“š åŠ‡æƒ…å®Œæˆè™•ç†
    void OnStoryComplete(StoryCompleteEvent eventData)
    {
        // åŠ‡æƒ…å®Œæˆå¾Œçš„æ•¸å€¼çå‹µ
        ApplyStoryCompletionRewards(eventData.dialogID);
        
        // æ›´æ–°é¤Šæˆç³»çµ±ç‹€æ…‹
        UpdateNurturingSystemState(eventData);
    }
    
    // ğŸ”“ æª¢æŸ¥æ–°åŠ‡æƒ…è§£é–
    void CheckForNewStoryUnlocks(int friendshipLevel)
    {
        var newStories = storyTracker.GetUnlockedStoriesForLevel(friendshipLevel);
        
        foreach (string storyID in newStories)
        {
            // è§¸ç™¼åŠ‡æƒ…è§£é–é€šçŸ¥
            EventBus.Instance.Publish("StoryUnlocked", new StoryUnlockedEvent
            {
                storyID = storyID,
                unlockedBy = "friendship_level",
                friendshipLevel = friendshipLevel
            });
        }
    }
}
```

---

## ğŸ“Š æ•¸æ“šæµåœ–

```
ğŸ’– é¤Šæˆäº’å‹•ç³»çµ±æ•¸æ“šæµ
â”‚
ğŸ‘† ç©å®¶äº’å‹•è§¸ç™¼
    â†“
ğŸ” InteractionConditionChecker.CheckConditions()
    â†“
ğŸ§® StatCalculationEngine.CalculateResult()
    â†“
ğŸ“Š NumericalRecords.ModifyStats()
    â†“
â° TimeManagerTest.AdvanceTime()
    â†“
ğŸ“ˆ ProgressionManager.CheckLevelUp()
    â†“
ğŸ­ StoryModeIntegration.CheckStoryTriggers()
    â†“
ğŸ® MiniGameIntegration.CheckUnlocks()
    â†“
ğŸ’¾ SaveSystemIntegration.AutoSave()
    â†“
ğŸ¨ UIæ›´æ–°å’Œåé¥‹é¡¯ç¤º
    â†“
ğŸ”„ ç­‰å¾…ä¸‹ä¸€æ¬¡äº’å‹•
```

---

## ğŸ’¬ Claude ä½¿ç”¨æç¤º

### ğŸ¯ æ¶æ§‹é‡é»
1. **æ•¸å€¼é©…å‹•**: å®Œæ•´çš„æ•¸å€¼è¨ˆç®—å’Œç®¡ç†ç³»çµ±
2. **æ™‚é–“ç³»çµ±**: è±å¯Œçš„æ™‚é–“æµé€å’Œäº‹ä»¶ç³»çµ±
3. **äº’å‹•è±å¯Œ**: å¤šæ¨£åŒ–çš„äº’å‹•é¡å‹å’Œçµæœ
4. **æ•´åˆå®Œå–„**: èˆ‡å…¶ä»–ç³»çµ±çš„æ·±åº¦æ•´åˆ

### ğŸ”§ é–‹ç™¼å»ºè­°
- å„ªå…ˆå¯¦ä½œNumericalRecordså’ŒTimeManagerTest
- ç¢ºä¿æ•¸å€¼è¨ˆç®—çš„å¹³è¡¡æ€§å’Œå…¬å¹³æ€§
- æ³¨é‡äº’å‹•åé¥‹çš„å³æ™‚æ€§å’Œç›´è§€æ€§
- è€ƒæ…®é•·æœŸéŠç©çš„æ•¸å€¼å¹³è¡¡

### âš ï¸ æ³¨æ„äº‹é …
- æ•¸å€¼æº¢å‡ºå’Œé‚Šç•Œæƒ…æ³è™•ç†
- æ™‚é–“ç³»çµ±çš„æ€§èƒ½å½±éŸ¿
- äº’å‹•æ¢ä»¶çš„è¤‡é›œåº¦æ§åˆ¶
- å­˜æª”æ•¸æ“šçš„å®Œæ•´æ€§ä¿è­‰

---

**æœ€å¾Œæ›´æ–°**: 2025-07-30  
**ç‰ˆæœ¬**: 1.0  
**ç¶­è­·è€…**: é–‹ç™¼åœ˜éšŠ + Claude AI

> ğŸ’– **æ¶æ§‹äº®é»**: é¤Šæˆäº’å‹•ç³»çµ±æ¶æ§‹æ¡ç”¨äº‹ä»¶é©…å‹•å’Œæ•¸å€¼é©…å‹•çš„è¨­è¨ˆæ¨¡å¼ï¼Œé€šéç²¾å¯†çš„æ•¸å€¼è¨ˆç®—å¼•æ“å’Œè±å¯Œçš„æ™‚é–“ç³»çµ±ï¼Œå¯¦ç¾äº†æ·±åº¦çš„è§’è‰²é¤Šæˆé«”é©—ã€‚ç³»çµ±ä¸åƒ…æ”¯æ´è¤‡é›œçš„äº’å‹•é‚è¼¯ï¼Œé‚„æä¾›äº†å®Œæ•´çš„é€²åº¦è¿½è¹¤å’Œçå‹µæ©Ÿåˆ¶ï¼ âœ¨