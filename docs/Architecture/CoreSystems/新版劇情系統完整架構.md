# ğŸ­ æ–°ç‰ˆåŠ‡æƒ…ç³»çµ±å®Œæ•´æ¶æ§‹

> LoveTide æ–°ç‰ˆåŠ‡æƒ…æ’­æ”¾ç³»çµ±çš„å®Œæ•´æŠ€è¡“æ¶æ§‹è¨­è¨ˆï¼Œæ•´åˆç« ç¯€é…ç½®ç®¡ç†ã€è§’è‰²æ˜ å°„ç³»çµ±ã€èªéŸ³æ’­æ”¾æ§åˆ¶å’Œè³‡æºè·¯å¾‘è§£æ

---

## ğŸ¯ ç³»çµ±æ¦‚è¿°

æ–°ç‰ˆåŠ‡æƒ…æ’­æ”¾ç³»çµ±æ˜¯ LoveTide éŠæˆ²çš„ä¸‹ä¸€ä»£æ•˜äº‹å¼•æ“ï¼Œè§£æ±ºäº†åŸæœ‰ç³»çµ±ä¸­è§’è‰²å‘½åç¶­è­·å›°é›£å’ŒèªéŸ³æ’­æ”¾ç¼ºå¤±çš„å•é¡Œã€‚ç³»çµ±æ¡ç”¨**ç« ç¯€é…ç½®é©…å‹•**çš„è¨­è¨ˆç†å¿µï¼Œé€šé**å»£ç¾©è§’è‰²é¡å‹**å’Œ**å‹•æ…‹è³‡æºæ˜ å°„**ï¼Œå¯¦ç¾äº†é«˜åº¦éˆæ´»ä¸”æ˜“ç¶­è­·çš„åŠ‡æƒ…ç®¡ç†é«”é©—ã€‚

### ğŸŒŸ æ ¸å¿ƒå„ªå‹¢

- **ğŸ”§ ç¶­è­·æ€§**: å»£ç¾©è§’è‰²å‘½åï¼Œæ–°å¢è§’è‰²ç„¡éœ€ä¿®æ”¹å°è©±JSON
- **ğŸµ å®Œæ•´æ€§**: é›†æˆèªéŸ³æ’­æ”¾ç³»çµ±ï¼Œæ”¯æ´è§’è‰²é¸æ“‡æ€§ç™¼è²
- **ğŸ“ éˆæ´»æ€§**: ç« ç¯€ç¨ç«‹é…ç½®ï¼Œæ”¯æ´å¤šæ”¯ç·šè§’è‰²ç®¡ç†
- **ğŸ¨ æ“´å±•æ€§**: é€ å‹ç·¨è™Ÿç³»çµ±ï¼Œæ”¯æ´è§’è‰²å¤šå¥—æœè£åˆ‡æ›
- **ğŸš€ æ€§èƒ½**: è³‡æºè·¯å¾‘å‹•æ…‹è§£æï¼Œæ¸›å°‘é‡è¤‡é…ç½®

---

## ğŸ—ï¸ ç³»çµ±æ•´é«”æ¶æ§‹åœ–

```
ğŸ­ æ–°ç‰ˆåŠ‡æƒ…ç³»çµ±å®Œæ•´æ¶æ§‹
â”‚
â”œâ”€â”€ ğŸ“‹ ç« ç¯€é…ç½®å±¤ (Chapter Configuration Layer)
â”‚   â”œâ”€â”€ ChapterConfigManager.cs - ç« ç¯€é…ç½®ç®¡ç†å™¨ â­
â”‚   â”œâ”€â”€ ChapterConfig.json - ç« ç¯€é…ç½®æª”æ¡ˆ
â”‚   â””â”€â”€ è§’è‰²æ˜ å°„è¡¨ + è³‡æºè·¯å¾‘é…ç½®
â”‚
â”œâ”€â”€ ğŸ”„ è§’è‰²æ˜ å°„å±¤ (Actor Mapping Layer)
â”‚   â”œâ”€â”€ ChapterActorMapper.cs - å»£ç¾©â†’å…·é«”è§’è‰²æ˜ å°„ â­
â”‚   â”œâ”€â”€ CostumeManager.cs - é€ å‹ç·¨è™Ÿç®¡ç†
â”‚   â””â”€â”€ VoiceIndexCalculator.cs - èªéŸ³ç´¢å¼•è¨ˆç®—å™¨ â­
â”‚
â”œâ”€â”€ ğŸµ èªéŸ³æ’­æ”¾å±¤ (Voice Playback Layer)
â”‚   â”œâ”€â”€ VoicePlaybackController.cs - èªéŸ³æ’­æ”¾æ§åˆ¶å™¨ â­
â”‚   â”œâ”€â”€ ResourcePathResolver.cs - è³‡æºè·¯å¾‘è§£æå™¨ â­
â”‚   â””â”€â”€ èªéŸ³æª”æ¡ˆå‹•æ…‹è¼‰å…¥èˆ‡æ’­æ”¾
â”‚
â”œâ”€â”€ ğŸ“Š å°è©±æ•¸æ“šå±¤ (Dialog Data Layer)
â”‚   â”œâ”€â”€ æ–°ç‰ˆå°è©±JSONæ ¼å¼ (å»£ç¾©è§’è‰² + èªéŸ³BOOL)
â”‚   â”œâ”€â”€ JsonDataManager.cs - JSONæ•¸æ“šç®¡ç†å™¨ (ç¾æœ‰)
â”‚   â””â”€â”€ DataStructures.cs - æ•¸æ“šçµæ§‹å®šç¾© (æ“´å±•)
â”‚
â””â”€â”€ ğŸ® åŠ‡æƒ…æ§åˆ¶å±¤ (Story Control Layer)
    â”œâ”€â”€ GamePlayingManagerDrama.cs - åŠ‡æƒ…ä¸»æ§åˆ¶å™¨ (æ•´åˆ)
    â”œâ”€â”€ EventBus.cs - äº‹ä»¶å»£æ’­ç³»çµ± (ç¾æœ‰)
    â””â”€â”€ ç¾æœ‰å±•ç¤ºæ¸²æŸ“å±¤ (TextBox, ActorManagerç­‰)
```

---

## ğŸ“‹ ç« ç¯€é…ç½®ç³»çµ±æ¶æ§‹

### ğŸŒŸ ChapterConfigManager - ç« ç¯€é…ç½®ç®¡ç†å™¨ (æ ¸å¿ƒæ–°å¢)

```csharp
public class ChapterConfigManager : MonoBehaviour
{
    [Header("ç« ç¯€é…ç½®")]
    public static ChapterConfigManager Instance;
    private Dictionary<string, ChapterConfig> chapterConfigs;
    private ChapterConfig currentChapter;
    
    [Header("é…ç½®æª”æ¡ˆè·¯å¾‘")]
    public string configBasePath = "ChapterConfigs/";
    
    void Awake()
    {
        if (Instance == null)
        {
            Instance = this;
            DontDestroyOnLoad(gameObject);
            LoadAllChapterConfigs();
        }
    }
    
    // ğŸš€ è¼‰å…¥æ‰€æœ‰ç« ç¯€é…ç½®
    void LoadAllChapterConfigs()
    {
        chapterConfigs = new Dictionary<string, ChapterConfig>();
        
        // ä¸»ç·šç« ç¯€
        LoadChapterConfig("Main", "Chapter_01");
        LoadChapterConfig("Main", "Chapter_02");
        
        // æ”¯ç·šç« ç¯€
        LoadChapterConfig("SideStory", "Nana_Chapter_03");
        LoadChapterConfig("SideStory", "Yuki_Chapter_01");
    }
    
    // ğŸ“– è¼‰å…¥ç‰¹å®šç« ç¯€é…ç½®
    ChapterConfig LoadChapterConfig(string storyType, string chapterName)
    {
        string configPath = $"{configBasePath}{storyType}/{chapterName}_Config";
        TextAsset configFile = Resources.Load<TextAsset>(configPath);
        
        if (configFile != null)
        {
            ChapterConfig config = JsonUtility.FromJson<ChapterConfig>(configFile.text);
            string configKey = $"{storyType}_{chapterName}";
            chapterConfigs[configKey] = config;
            
            Debug.Log($"è¼‰å…¥ç« ç¯€é…ç½®: {configKey}");
            return config;
        }
        
        Debug.LogError($"ç„¡æ³•è¼‰å…¥ç« ç¯€é…ç½®: {configPath}");
        return null;
    }
    
    // ğŸ¯ è¨­å®šç•¶å‰ç« ç¯€
    public void SetCurrentChapter(string storyType, string chapterName)
    {
        string configKey = $"{storyType}_{chapterName}";
        
        if (chapterConfigs.ContainsKey(configKey))
        {
            currentChapter = chapterConfigs[configKey];
            
            // é€šçŸ¥å…¶ä»–ç³»çµ±ç« ç¯€å·²è®Šæ›´
            EventBus.Instance.Post("ChapterChanged", currentChapter);
            Debug.Log($"åˆ‡æ›åˆ°ç« ç¯€: {configKey}");
        }
        else
        {
            Debug.LogError($"æ‰¾ä¸åˆ°ç« ç¯€é…ç½®: {configKey}");
        }
    }
    
    // ğŸ“‹ ç²å–ç•¶å‰ç« ç¯€é…ç½®
    public ChapterConfig GetCurrentChapter()
    {
        return currentChapter;
    }
    
    // ğŸ” ç²å–æŒ‡å®šç« ç¯€é…ç½®
    public ChapterConfig GetChapterConfig(string storyType, string chapterName)
    {
        string configKey = $"{storyType}_{chapterName}";
        return chapterConfigs.ContainsKey(configKey) ? chapterConfigs[configKey] : null;
    }
}
```

### ğŸ“‹ ChapterConfig - ç« ç¯€é…ç½®æ•¸æ“šçµæ§‹

```csharp
[System.Serializable]
public class ChapterConfig
{
    [Header("åŸºæœ¬è³‡è¨Š")]
    public string StoryType;        // "ä¸»ç·š" æˆ– "æ”¯ç·š"
    public string Chapter;          // "1" æˆ– "NANAæ”¯ç·š"
    public int ChapterNumber;       // ç« ç¯€æ•¸å­—ç·¨è™Ÿ
    public string ChapterName;      // ç« ç¯€é¡¯ç¤ºåç¨±
    
    [Header("è§’è‰²é…ç½®")]
    public string MainHeroine;      // å¥³ä¸»è§’å…·é«”åç¨± (å¦‚: "Yuka", "nana")
    public SupportingCast SupportingActors;  // é…è§’åˆ—è¡¨
    
    [Header("è³‡æºè·¯å¾‘")]
    public ResourcePaths ResourcePaths;
    
    [Header("ç‰¹æ®Šè¨­å®š")]
    public bool HasVoiceActing;     // æ˜¯å¦æœ‰èªéŸ³æ¼”å‡º
    public string BackgroundMusic;  // ç« ç¯€å°ˆå±¬BGM
    public List<string> RequiredAssets; // å¿…éœ€é è¼‰çš„è³‡æº
}

[System.Serializable]
public class SupportingCast
{
    public string Support1;  // é…è§’1 (å¦‚: "boss", "æœ‹å‹A")
    public string Support2;  // é…è§’2
    public string Support3;  // é…è§’3
    public string Support4;  // é…è§’4
    public string Support5;  // é…è§’5
    
    // å‹•æ…‹å–å¾—é…è§’
    public string GetSupporter(int index)
    {
        switch(index)
        {
            case 1: return Support1;
            case 2: return Support2;
            case 3: return Support3;
            case 4: return Support4;
            case 5: return Support5;
            default: return null;
        }
    }
}

[System.Serializable]
public class ResourcePaths
{
    [Header("åª’é«”è³‡æºè·¯å¾‘")]
    public string CGPath;           // CGåœ–ç‰‡è·¯å¾‘
    public string SpineCGPath;      // Spineå‹•ç•«CGè·¯å¾‘
    public string VoicePath;        // èªéŸ³æª”æ¡ˆè·¯å¾‘
    public string BackgroundPath;   // èƒŒæ™¯åœ–ç‰‡è·¯å¾‘
    
    [Header("ç‰¹æ®Šè³‡æºè·¯å¾‘")]
    public string MusicPath;        // éŸ³æ¨‚æª”æ¡ˆè·¯å¾‘
    public string EffectPath;       // éŸ³æ•ˆæª”æ¡ˆè·¯å¾‘
    public string FontPath;         // å­—å‹æª”æ¡ˆè·¯å¾‘
}
```

### ğŸ“„ ç« ç¯€é…ç½®JSONç¯„ä¾‹

**ä¸»ç·šç¬¬ä¸€ç« é…ç½® (`ChapterConfigs/Main/Chapter_01_Config.json`)**:

```json
{
  "StoryType": "ä¸»ç·š",
  "Chapter": "1",
  "ChapterNumber": 1,
  "ChapterName": "åºç«  - æ–°çš„é–‹å§‹",
  "MainHeroine": "Yuka",
  "SupportingActors": {
    "Support1": "boss",
    "Support2": null,
    "Support3": null,
    "Support4": null,
    "Support5": null
  },
  "ResourcePaths": {
    "CGPath": "CG/Main/Chapter_01/",
    "SpineCGPath": "SpineCG/Main/Chapter_01/",
    "VoicePath": "Voice/Main/Chapter_01/",
    "BackgroundPath": "Backgrounds/Main/Chapter_01/",
    "MusicPath": "Music/Main/Chapter_01/",
    "EffectPath": "Effects/Main/Chapter_01/",
    "FontPath": "Fonts/Main/"
  },
  "HasVoiceActing": true,
  "BackgroundMusic": "Ocean_Breeze_Theme",
  "RequiredAssets": [
    "Islands_01",
    "KaraOK_01", 
    "Tavem",
    "RoomA_01"
  ]
}
```

**æ”¯ç·šç« ç¯€é…ç½® (`ChapterConfigs/SideStory/Nana_Chapter_03_Config.json`)**:

```json
{
  "StoryType": "æ”¯ç·š",
  "Chapter": "NANAæ”¯ç·š",
  "ChapterNumber": 3,
  "ChapterName": "ç¬¬ä¸‰ç«  - Nanaçš„ç§˜å¯†",
  "MainHeroine": "nana",
  "SupportingActors": {
    "Support1": "æœ‹å‹A",
    "Support2": "æœ‹å‹B", 
    "Support3": "å…„å¼ŸA",
    "Support4": "é…’ä¿",
    "Support5": null
  },
  "ResourcePaths": {
    "CGPath": "CG/SideStory/Nana/Chapter_03/",
    "SpineCGPath": "SpineCG/SideStory/Nana/Chapter_03/",
    "VoicePath": "Voice/SideStory/Nana/Chapter_03/",
    "BackgroundPath": "Backgrounds/SideStory/Nana/Chapter_03/",
    "MusicPath": "Music/SideStory/Nana/Chapter_03/",
    "EffectPath": "Effects/SideStory/Nana/Chapter_03/",
    "FontPath": "Fonts/SideStory/"
  },
  "HasVoiceActing": true,
  "BackgroundMusic": "Nana_Theme_Mysterious",
  "RequiredAssets": [
    "NightClub_01",
    "Street_Downtown",
    "Apartment_Nana"
  ]
}
```

---

## ğŸ”„ è§’è‰²æ˜ å°„ç³»çµ±æ¶æ§‹

### ğŸŒŸ ChapterActorMapper - è§’è‰²æ˜ å°„ç®¡ç†å™¨ (æ ¸å¿ƒæ–°å¢)

```csharp
public class ChapterActorMapper : MonoBehaviour
{
    [Header("ç³»çµ±çµ„ä»¶")]
    public ChapterConfigManager configManager;
    public static ChapterActorMapper Instance;
    
    [Header("æ˜ å°„ç·©å­˜")]
    private Dictionary<string, string> currentActorMapping;
    private ChapterConfig currentChapter;
    
    void Awake()
    {
        if (Instance == null)
        {
            Instance = this;
            DontDestroyOnLoad(gameObject);
            InitializeMapper();
        }
    }
    
    void Start()
    {
        // è¨‚é–±ç« ç¯€è®Šæ›´äº‹ä»¶
        EventBus.Instance.Subscribe("ChapterChanged", OnChapterChanged);
    }
    
    // ğŸš€ åˆå§‹åŒ–æ˜ å°„å™¨
    void InitializeMapper()
    {
        currentActorMapping = new Dictionary<string, string>();
        configManager = ChapterConfigManager.Instance;
        
        // è¨­å®šå›ºå®šè§’è‰²æ˜ å°„
        currentActorMapping["Player"] = "Player";
        currentActorMapping["Narrator"] = "Narrator";
    }
    
    // ğŸ“¡ ç« ç¯€è®Šæ›´äº‹ä»¶è™•ç†
    void OnChapterChanged(object chapterData)
    {
        if (chapterData is ChapterConfig newChapter)
        {
            UpdateActorMapping(newChapter);
        }
    }
    
    // ğŸ”„ æ›´æ–°è§’è‰²æ˜ å°„è¡¨
    void UpdateActorMapping(ChapterConfig chapter)
    {
        currentChapter = chapter;
        
        // æ¸…ç©ºå‹•æ…‹æ˜ å°„ (ä¿ç•™å›ºå®šæ˜ å°„)
        var fixedMappings = currentActorMapping.Where(kv => 
            kv.Key == "Player" || kv.Key == "Narrator").ToDictionary(kv => kv.Key, kv => kv.Value);
        
        currentActorMapping = fixedMappings;
        
        // æ›´æ–°å‹•æ…‹æ˜ å°„
        currentActorMapping["protagonist"] = chapter.MainHeroine;
        
        // æ›´æ–°é…è§’æ˜ å°„
        for (int i = 1; i <= 5; i++)
        {
            string supportKey = $"Support{i}";
            string supportActor = chapter.SupportingActors.GetSupporter(i);
            
            if (!string.IsNullOrEmpty(supportActor))
            {
                currentActorMapping[supportKey] = supportActor;
            }
        }
        
        Debug.Log($"å·²æ›´æ–°è§’è‰²æ˜ å°„è¡¨ - ç« ç¯€: {chapter.ChapterName}");
        LogCurrentMapping();
    }
    
    // ğŸ­ ç²å–å¯¦éš›è§’è‰²åç¨±
    public string GetActualActor(string genericActorType)
    {
        if (currentActorMapping.ContainsKey(genericActorType))
        {
            return currentActorMapping[genericActorType];
        }
        
        // å¦‚æœæ‰¾ä¸åˆ°æ˜ å°„ï¼Œè¿”å›åŸå§‹åç¨±ä¸¦è¨˜éŒ„è­¦å‘Š
        Debug.LogWarning($"æ‰¾ä¸åˆ°è§’è‰²æ˜ å°„: {genericActorType}ï¼Œè¿”å›åŸå§‹åç¨±");
        return genericActorType;
    }
    
    // ğŸ” æª¢æŸ¥è§’è‰²æ˜¯å¦å­˜åœ¨
    public bool IsActorMapped(string genericActorType)
    {
        return currentActorMapping.ContainsKey(genericActorType);
    }
    
    // ğŸ“‹ ç²å–æ‰€æœ‰æ˜ å°„
    public Dictionary<string, string> GetAllMappings()
    {
        return new Dictionary<string, string>(currentActorMapping);
    }
    
    // ğŸ“ è¨˜éŒ„ç•¶å‰æ˜ å°„ç‹€æ³
    void LogCurrentMapping()
    {
        Debug.Log("=== ç•¶å‰è§’è‰²æ˜ å°„è¡¨ ===");
        foreach(var mapping in currentActorMapping)
        {
            Debug.Log($"{mapping.Key} â†’ {mapping.Value}");
        }
        Debug.Log("==================");
    }
    
    // ğŸ¨ ç²å–è§’è‰²é€ å‹è·¯å¾‘
    public string GetActorCostumePath(string genericActorType, string costumeIndex)
    {
        string actualActor = GetActualActor(genericActorType);
        string basePath = currentChapter.ResourcePaths.SpineCGPath;
        return $"{basePath}{actualActor}/Costume_{costumeIndex}/";
    }
}
```

---

## ğŸµ èªéŸ³æ’­æ”¾ç³»çµ±æ¶æ§‹

### ğŸŒŸ VoicePlaybackController - èªéŸ³æ’­æ”¾æ§åˆ¶å™¨ (æ ¸å¿ƒæ–°å¢)

```csharp
public class VoicePlaybackController : MonoBehaviour
{
    [Header("ç³»çµ±çµ„ä»¶")]
    public ChapterActorMapper actorMapper;
    public VoiceIndexCalculator indexCalculator;
    public ResourcePathResolver pathResolver;
    public AudioSource voiceAudioSource;
    
    [Header("èªéŸ³è¨­å®š")]
    public float voiceVolume = 1.0f;
    public bool enableVoicePlayback = true;
    public bool showVoiceSubtitles = true;
    
    [Header("èª¿è©¦è³‡è¨Š")]
    public bool logVoicePlayback = false;
    
    public static VoicePlaybackController Instance;
    
    void Awake()
    {
        if (Instance == null)
        {
            Instance = this;
            DontDestroyOnLoad(gameObject);
            InitializeController();
        }
    }
    
    // ğŸš€ åˆå§‹åŒ–æ§åˆ¶å™¨
    void InitializeController()
    {
        actorMapper = ChapterActorMapper.Instance;
        indexCalculator = GetComponent<VoiceIndexCalculator>();
        pathResolver = GetComponent<ResourcePathResolver>();
        
        if (voiceAudioSource == null)
        {
            voiceAudioSource = gameObject.AddComponent<AudioSource>();
        }
        
        voiceAudioSource.volume = voiceVolume;
        voiceAudioSource.playOnAwake = false;
    }
    
    // ğŸµ ä¸»è¦èªéŸ³æ’­æ”¾æ–¹æ³•
    public void PlayVoiceIfNeeded(string actorType, bool hasVoice, string dialogIndex = "")
    {
        // æª¢æŸ¥æ˜¯å¦éœ€è¦æ’­æ”¾èªéŸ³
        if (!enableVoicePlayback || !hasVoice)
        {
            if (logVoicePlayback)
                Debug.Log($"è·³éèªéŸ³æ’­æ”¾ - Actor: {actorType}, HasVoice: {hasVoice}");
            return;
        }
        
        // 1. ç²å–å¯¦éš›è§’è‰²å
        string actualActor = actorMapper.GetActualActor(actorType);
        
        // 2. è¨ˆç®—èªéŸ³ç´¢å¼•
        int voiceIndex = indexCalculator.CalculateVoiceIndex(actualActor, hasVoice);
        
        // 3. å»ºæ§‹èªéŸ³æª”æ¡ˆè·¯å¾‘
        string voicePath = pathResolver.GetVoiceFilePath(actualActor, voiceIndex);
        
        // 4. è¼‰å…¥ä¸¦æ’­æ”¾èªéŸ³
        LoadAndPlayVoice(voicePath, actualActor, voiceIndex);
        
        if (logVoicePlayback)
        {
            Debug.Log($"èªéŸ³æ’­æ”¾ - Actor: {actualActor}, Index: {voiceIndex}, Path: {voicePath}");
        }
    }
    
    // ğŸ”Š è¼‰å…¥ä¸¦æ’­æ”¾èªéŸ³æª”æ¡ˆ
    void LoadAndPlayVoice(string voicePath, string actorName, int voiceIndex)
    {
        StartCoroutine(LoadVoiceClip(voicePath, actorName, voiceIndex));
    }
    
    // â³ å”ç¨‹ï¼šè¼‰å…¥èªéŸ³ç‰‡æ®µ
    IEnumerator LoadVoiceClip(string voicePath, string actorName, int voiceIndex)
    {
        AudioClip voiceClip = Resources.Load<AudioClip>(voicePath);
        
        if (voiceClip != null)
        {
            // æ’­æ”¾èªéŸ³
            voiceAudioSource.clip = voiceClip;
            voiceAudioSource.Play();
            
            // è§¸ç™¼èªéŸ³æ’­æ”¾äº‹ä»¶
            EventBus.Instance.Post("VoicePlaybackStarted", new VoicePlaybackEvent
            {
                actorName = actorName,
                voiceIndex = voiceIndex,
                clipLength = voiceClip.length,
                voicePath = voicePath
            });
            
            Debug.Log($"âœ… èªéŸ³æ’­æ”¾æˆåŠŸ - {actorName}[{voiceIndex}]: {voicePath}");
        }
        else
        {
            Debug.LogError($"âŒ ç„¡æ³•è¼‰å…¥èªéŸ³æª”æ¡ˆ: {voicePath}");
            
            // è§¸ç™¼èªéŸ³è¼‰å…¥å¤±æ•—äº‹ä»¶
            EventBus.Instance.Post("VoiceLoadFailed", new VoiceLoadFailedEvent
            {
                actorName = actorName,
                voiceIndex = voiceIndex,
                voicePath = voicePath
            });
        }
        
        yield return null;
    }
    
    // â¹ï¸ åœæ­¢èªéŸ³æ’­æ”¾
    public void StopVoice()
    {
        if (voiceAudioSource.isPlaying)
        {
            voiceAudioSource.Stop();
            EventBus.Instance.Post("VoicePlaybackStopped", null);
        }
    }
    
    // ğŸ”‡ è¨­å®šèªéŸ³éŸ³é‡
    public void SetVoiceVolume(float volume)
    {
        voiceVolume = Mathf.Clamp01(volume);
        voiceAudioSource.volume = voiceVolume;
    }
    
    // âš™ï¸ åˆ‡æ›èªéŸ³æ’­æ”¾é–‹é—œ
    public void SetVoicePlaybackEnabled(bool enabled)
    {
        enableVoicePlayback = enabled;
        
        if (!enabled && voiceAudioSource.isPlaying)
        {
            StopVoice();
        }
    }
}

// ğŸµ èªéŸ³æ’­æ”¾äº‹ä»¶æ•¸æ“š
[System.Serializable]
public class VoicePlaybackEvent
{
    public string actorName;
    public int voiceIndex;
    public float clipLength;
    public string voicePath;
}

[System.Serializable]
public class VoiceLoadFailedEvent
{
    public string actorName;
    public int voiceIndex;
    public string voicePath;
}
```

### ğŸ”¢ VoiceIndexCalculator - èªéŸ³ç´¢å¼•è¨ˆç®—å™¨ (æ ¸å¿ƒæ–°å¢)

```csharp
public class VoiceIndexCalculator : MonoBehaviour
{
    [Header("èªéŸ³ç´¢å¼•ç®¡ç†")]
    private Dictionary<string, int> actorVoiceIndex;
    private Dictionary<string, List<int>> actorVoiceHistory;
    
    [Header("èª¿è©¦è¨­å®š")]
    public bool logIndexCalculation = false;
    public bool resetIndexOnChapterChange = true;
    
    void Awake()
    {
        InitializeCalculator();
    }
    
    void Start()
    {
        // è¨‚é–±ç« ç¯€è®Šæ›´äº‹ä»¶
        EventBus.Instance.Subscribe("ChapterChanged", OnChapterChanged);
    }
    
    // ğŸš€ åˆå§‹åŒ–è¨ˆç®—å™¨
    void InitializeCalculator()
    {
        actorVoiceIndex = new Dictionary<string, int>();
        actorVoiceHistory = new Dictionary<string, List<int>>();
    }
    
    // ğŸ“¡ ç« ç¯€è®Šæ›´äº‹ä»¶è™•ç†
    void OnChapterChanged(object chapterData)
    {
        if (resetIndexOnChapterChange)
        {
            ResetAllVoiceIndices();
            Debug.Log("ç« ç¯€è®Šæ›´ - å·²é‡ç½®æ‰€æœ‰èªéŸ³ç´¢å¼•");
        }
    }
    
    // ğŸ”¢ è¨ˆç®—èªéŸ³ç´¢å¼• (æ ¸å¿ƒæ–¹æ³•)
    public int CalculateVoiceIndex(string actualActorName, bool hasVoice)
    {
        // å¦‚æœä¸éœ€è¦èªéŸ³ï¼Œè¿”å›-1
        if (!hasVoice)
        {
            if (logIndexCalculation)
                Debug.Log($"è§’è‰² {actualActorName} ä¸éœ€è¦èªéŸ³ï¼Œè¿”å› -1");
            return -1;
        }
        
        // åˆå§‹åŒ–è§’è‰²èªéŸ³ç´¢å¼•
        if (!actorVoiceIndex.ContainsKey(actualActorName))
        {
            actorVoiceIndex[actualActorName] = 0;
            actorVoiceHistory[actualActorName] = new List<int>();
        }
        
        // ç²å–ç•¶å‰ç´¢å¼•
        int currentIndex = actorVoiceIndex[actualActorName];
        
        // è¨˜éŒ„åˆ°æ­·å²
        actorVoiceHistory[actualActorName].Add(currentIndex);
        
        // ç‚ºä¸‹æ¬¡æº–å‚™ï¼ˆç´¢å¼•éå¢ï¼‰
        actorVoiceIndex[actualActorName]++;
        
        if (logIndexCalculation)
        {
            Debug.Log($"èªéŸ³ç´¢å¼•è¨ˆç®— - è§’è‰²: {actualActorName}, ç•¶å‰ç´¢å¼•: {currentIndex}, ä¸‹æ¬¡ç´¢å¼•: {actorVoiceIndex[actualActorName]}");
        }
        
        return currentIndex;
    }
    
    // ğŸ”„ é‡ç½®ç‰¹å®šè§’è‰²çš„èªéŸ³ç´¢å¼•
    public void ResetActorVoiceIndex(string actualActorName)
    {
        if (actorVoiceIndex.ContainsKey(actualActorName))
        {
            actorVoiceIndex[actualActorName] = 0;
            actorVoiceHistory[actualActorName].Clear();
            Debug.Log($"å·²é‡ç½®è§’è‰² {actualActorName} çš„èªéŸ³ç´¢å¼•");
        }
    }
    
    // ğŸ”„ é‡ç½®æ‰€æœ‰èªéŸ³ç´¢å¼•
    public void ResetAllVoiceIndices()
    {
        actorVoiceIndex.Clear();
        actorVoiceHistory.Clear();
    }
    
    // ğŸ“Š ç²å–è§’è‰²ç•¶å‰èªéŸ³ç´¢å¼•
    public int GetCurrentVoiceIndex(string actualActorName)
    {
        return actorVoiceIndex.ContainsKey(actualActorName) ? actorVoiceIndex[actualActorName] : 0;
    }
    
    // ğŸ“ˆ ç²å–è§’è‰²èªéŸ³æ’­æ”¾æ­·å²
    public List<int> GetActorVoiceHistory(string actualActorName)
    {
        return actorVoiceHistory.ContainsKey(actualActorName) ? 
               new List<int>(actorVoiceHistory[actualActorName]) : new List<int>();
    }
    
    // ğŸ“‹ ç²å–æ‰€æœ‰è§’è‰²èªéŸ³çµ±è¨ˆ
    public Dictionary<string, int> GetAllActorVoiceCounts()
    {
        return new Dictionary<string, int>(actorVoiceIndex);
    }
    
    // ğŸ“ è¨˜éŒ„èªéŸ³ç´¢å¼•ç‹€æ³
    public void LogVoiceIndexStatus()
    {
        Debug.Log("=== èªéŸ³ç´¢å¼•ç‹€æ³ ===");
        foreach(var actor in actorVoiceIndex)
        {
            int voiceCount = actorVoiceHistory[actor.Key].Count;
            Debug.Log($"{actor.Key}: ç•¶å‰ç´¢å¼• {actor.Value}, å·²æ’­æ”¾ {voiceCount} æ¬¡èªéŸ³");
        }
        Debug.Log("================");
    }
}
```

### ğŸ—‚ï¸ ResourcePathResolver - è³‡æºè·¯å¾‘è§£æå™¨ (æ ¸å¿ƒæ–°å¢)

```csharp
public class ResourcePathResolver : MonoBehaviour
{
    [Header("ç³»çµ±çµ„ä»¶")]
    public ChapterConfigManager configManager;
    
    [Header("è·¯å¾‘æ ¼å¼è¨­å®š")]
    public string voiceFileFormat = "{0}_{1:000}.wav";  // èªéŸ³æª”æ¡ˆæ ¼å¼: Yuka_001.wav
    public string costumePathFormat = "{0}/Costume_{1}/"; // é€ å‹è·¯å¾‘æ ¼å¼: Yuka/Costume_01/
    public string cgPathFormat = "{0}_{1}.png";          // CGæª”æ¡ˆæ ¼å¼: Beach_01.png
    
    [Header("è³‡æºé©—è­‰")]
    public bool validateResourceExists = true;
    public bool logPathResolution = false;
    
    public static ResourcePathResolver Instance;
    
    void Awake()
    {
        if (Instance == null)
        {
            Instance = this;
            DontDestroyOnLoad(gameObject);
            InitializeResolver();
        }
    }
    
    // ğŸš€ åˆå§‹åŒ–è§£æå™¨
    void InitializeResolver()
    {
        configManager = ChapterConfigManager.Instance;
    }
    
    // ğŸµ ç²å–èªéŸ³æª”æ¡ˆè·¯å¾‘
    public string GetVoiceFilePath(string actualActorName, int voiceIndex)
    {
        ChapterConfig currentChapter = configManager.GetCurrentChapter();
        
        if (currentChapter == null)
        {
            Debug.LogError("ç„¡æ³•ç²å–ç•¶å‰ç« ç¯€é…ç½®");
            return "";
        }
        
        // å»ºæ§‹èªéŸ³æª”æ¡ˆåç¨±
        string voiceFileName = string.Format(voiceFileFormat, actualActorName, voiceIndex);
        
        // å»ºæ§‹å®Œæ•´è·¯å¾‘
        string fullPath = $"{currentChapter.ResourcePaths.VoicePath}{actualActorName}/{voiceFileName}";
        
        // é©—è­‰è³‡æºæ˜¯å¦å­˜åœ¨ (å¯é¸)
        if (validateResourceExists && !DoesResourceExist(fullPath))
        {
            Debug.LogWarning($"èªéŸ³æª”æ¡ˆä¸å­˜åœ¨: {fullPath}");
        }
        
        if (logPathResolution)
        {
            Debug.Log($"èªéŸ³è·¯å¾‘è§£æ - Actor: {actualActorName}, Index: {voiceIndex}, Path: {fullPath}");
        }
        
        return fullPath;
    }
    
    // ğŸ¨ ç²å–è§’è‰²é€ å‹è³‡æºè·¯å¾‘
    public string GetActorCostumePath(string actualActorName, string costumeIndex)
    {
        ChapterConfig currentChapter = configManager.GetCurrentChapter();
        
        if (currentChapter == null)
        {
            Debug.LogError("ç„¡æ³•ç²å–ç•¶å‰ç« ç¯€é…ç½®");
            return "";
        }
        
        // å»ºæ§‹é€ å‹è·¯å¾‘
        string costumePath = string.Format(costumePathFormat, actualActorName, costumeIndex);
        
        // å»ºæ§‹å®Œæ•´è·¯å¾‘
        string fullPath = $"{currentChapter.ResourcePaths.SpineCGPath}{costumePath}";
        
        if (logPathResolution)
        {
            Debug.Log($"é€ å‹è·¯å¾‘è§£æ - Actor: {actualActorName}, Costume: {costumeIndex}, Path: {fullPath}");
        }
        
        return fullPath;
    }
    
    // ğŸ–¼ï¸ ç²å–CGåœ–ç‰‡è·¯å¾‘
    public string GetCGImagePath(string cgName, string cgVariant = "01")
    {
        ChapterConfig currentChapter = configManager.GetCurrentChapter();
        
        if (currentChapter == null)
        {
            Debug.LogError("ç„¡æ³•ç²å–ç•¶å‰ç« ç¯€é…ç½®");
            return "";
        }
        
        // å»ºæ§‹CGæª”æ¡ˆåç¨±
        string cgFileName = string.Format(cgPathFormat, cgName, cgVariant);
        
        // å»ºæ§‹å®Œæ•´è·¯å¾‘
        string fullPath = $"{currentChapter.ResourcePaths.CGPath}{cgFileName}";
        
        if (logPathResolution)
        {
            Debug.Log($"CGè·¯å¾‘è§£æ - Name: {cgName}, Variant: {cgVariant}, Path: {fullPath}");
        }
        
        return fullPath;
    }
    
    // ğŸµ ç²å–èƒŒæ™¯éŸ³æ¨‚è·¯å¾‘
    public string GetMusicPath(string musicName)
    {
        ChapterConfig currentChapter = configManager.GetCurrentChapter();
        
        if (currentChapter == null)
        {
            Debug.LogError("ç„¡æ³•ç²å–ç•¶å‰ç« ç¯€é…ç½®");
            return "";
        }
        
        string fullPath = $"{currentChapter.ResourcePaths.MusicPath}{musicName}";
        
        if (logPathResolution)
        {
            Debug.Log($"éŸ³æ¨‚è·¯å¾‘è§£æ - Name: {musicName}, Path: {fullPath}");
        }
        
        return fullPath;
    }
    
    // ğŸ“ ç²å–åŸºç¤è³‡æºè·¯å¾‘
    public ResourcePaths GetCurrentResourcePaths()
    {
        ChapterConfig currentChapter = configManager.GetCurrentChapter();
        return currentChapter?.ResourcePaths;
    }
    
    // âœ… é©—è­‰è³‡æºæ˜¯å¦å­˜åœ¨
    bool DoesResourceExist(string resourcePath)
    {
        return Resources.Load(resourcePath) != null;
    }
    
    // ğŸ” æ‰¹é‡é©—è­‰ç« ç¯€è³‡æº
    public List<string> ValidateChapterResources(ChapterConfig chapter)
    {
        List<string> missingResources = new List<string>();
        
        // é©—è­‰å¿…éœ€è³‡æº
        foreach(string requiredAsset in chapter.RequiredAssets)
        {
            if (!DoesResourceExist(requiredAsset))
            {
                missingResources.Add(requiredAsset);
            }
        }
        
        return missingResources;
    }
}
```

---

## ğŸ“Š æ–°ç‰ˆå°è©±æ•¸æ“šå±¤æ¶æ§‹

### ğŸ“‹ æ–°ç‰ˆå°è©±JSONæ•¸æ“šçµæ§‹

åŸºæ–¼å·²å¯¦ä½œçš„ `Main_01.json` æ ¼å¼ï¼š

```json
{
  "DialogIndex": "21",
  "ActorName": "protagonist",      // å»£ç¾©è§’è‰²é¡å‹
  "Dialog": "é€™è£¡å°±è·Ÿé›»å½±è£¡æ¼”çš„ä¸€æ¨£ç†±åˆ°ä¸è¡Œå•Šâ€¦â€¦",
  "ActorFace": "Anxious",
  "ActorAnimator": "Idle", 
  "FadeType": "FALSE",
  "CGController": "NoActor",
  "Spinecontroller": "NoActor",
  "ActorPosition": "1",
  "Backgroundcomtroller": "NoActor",
  "CostumeIndex": "1",             // é€ å‹ç·¨è™Ÿ (æ–°å¢)
  "HasVoice": true                 // èªéŸ³æ’­æ”¾BOOL (æ–°å¢)
}
```

### ğŸ”„ æ›´æ–°å¾Œçš„ DataStructures.cs

```csharp
[System.Serializable]
public class NewDialogItem
{
    [Header("åŸºæœ¬è³‡è¨Š")]
    public string DialogIndex;          // å°è©±ç´¢å¼•
    public string ActorName;            // å»£ç¾©è§’è‰²é¡å‹ (protagonist, Support1, Player, Narrator)
    public string Dialog;               // å°è©±å…§å®¹
    
    [Header("è§’è‰²å±•ç¤º")]
    public string ActorFace;            // è§’è‰²è¡¨æƒ…
    public string ActorAnimator;        // è§’è‰²å‹•ç•«
    public string ActorPosition;        // è§’è‰²ä½ç½®
    public string CostumeIndex;         // é€ å‹ç·¨è™Ÿ (æ–°å¢)
    
    [Header("å ´æ™¯æ§åˆ¶")]
    public string FadeType;             // æ·¡å…¥æ·¡å‡º
    public string CGController;         // CGæ§åˆ¶å™¨
    public string Spinecontroller;      // Spineå‹•ç•«æ§åˆ¶å™¨
    public string Backgroundcomtroller; // èƒŒæ™¯æ§åˆ¶å™¨
    
    [Header("èªéŸ³ç³»çµ±")]
    public bool HasVoice;               // æ˜¯å¦æ’­æ”¾èªéŸ³ (æ–°å¢)
    
    // ğŸ¯ ç²å–å¯¦éš›è§’è‰²åç¨± (éœ€è¦ChapterActorMapper)
    public string GetActualActorName()
    {
        return ChapterActorMapper.Instance.GetActualActor(ActorName);
    }
    
    // ğŸµ æ˜¯å¦éœ€è¦æ’­æ”¾èªéŸ³
    public bool ShouldPlayVoice()
    {
        return HasVoice && !string.IsNullOrEmpty(Dialog) && ActorName != "Narrator";
    }
    
    // ğŸ¨ ç²å–é€ å‹è·¯å¾‘
    public string GetCostumePath()
    {
        return ResourcePathResolver.Instance.GetActorCostumePath(GetActualActorName(), CostumeIndex);
    }
}

// ğŸ“‹ è§’è‰²é¡å‹æšèˆ‰
public enum GenericActorType
{
    protagonist,    // å¥³ä¸»è§’
    Support1,       // é…è§’1
    Support2,       // é…è§’2
    Support3,       // é…è§’3
    Support4,       // é…è§’4
    Support5,       // é…è§’5
    Player,         // ç©å®¶
    Narrator        // æ—ç™½
}
```

---

## ğŸ® æ•´åˆå¾Œçš„åŠ‡æƒ…æ§åˆ¶å±¤æ¶æ§‹

### ğŸ”„ æ›´æ–°å¾Œçš„ GamePlayingManagerDrama.cs (æ•´åˆç‰ˆ)

```csharp
public class GamePlayingManagerDrama : MonoBehaviour
{
    [Header("æ–°ç‰ˆç³»çµ±çµ„ä»¶")]
    public ChapterConfigManager chapterConfigManager;
    public ChapterActorMapper actorMapper;
    public VoicePlaybackController voiceController;
    public ResourcePathResolver pathResolver;
    
    [Header("ç¾æœ‰ç³»çµ±çµ„ä»¶")]
    public TextBoxDrama textBoxDrama;
    public ActorManagerDrama actorManager;
    public CGDisplay cgDisplay;
    public JsonDataManager jsonDataManager;
    
    [Header("ç•¶å‰åŠ‡æƒ…ç‹€æ…‹")]
    public string currentDialogID;
    public int currentDialogIndex;
    public ChapterConfig currentChapter;
    
    void Start()
    {
        InitializeDramaManagerWithNewSystem();
    }
    
    // ğŸš€ åˆå§‹åŒ–æ•´åˆäº†æ–°ç³»çµ±çš„åŠ‡æƒ…ç®¡ç†å™¨
    void InitializeDramaManagerWithNewSystem()
    {
        // ç²å–ç³»çµ±çµ„ä»¶å¯¦ä¾‹
        chapterConfigManager = ChapterConfigManager.Instance;
        actorMapper = ChapterActorMapper.Instance;
        voiceController = VoicePlaybackController.Instance;
        pathResolver = ResourcePathResolver.Instance;
        
        // è¨‚é–±ç³»çµ±äº‹ä»¶
        EventBus.Instance.Subscribe("DialogDataReady", OnDialogDataReady);
        EventBus.Instance.Subscribe("VoicePlaybackStarted", OnVoicePlaybackStarted);
        
        Debug.Log("æ–°ç‰ˆåŠ‡æƒ…ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ");
    }
    
    // ğŸ¬ é–‹å§‹åŠ‡æƒ…æ’­æ”¾ (æ•´åˆç‰ˆ)
    public void StartStoryPlayback(string dialogID, string storyType, string chapterName)
    {
        currentDialogID = dialogID;
        
        // 1. è¨­å®šç« ç¯€é…ç½®
        chapterConfigManager.SetCurrentChapter(storyType, chapterName);
        currentChapter = chapterConfigManager.GetCurrentChapter();
        
        if (currentChapter == null)
        {
            Debug.LogError($"ç„¡æ³•è¼‰å…¥ç« ç¯€é…ç½®: {storyType}_{chapterName}");
            return;
        }
        
        // 2. è¼‰å…¥å°è©±æ•¸æ“š
        jsonDataManager.LoadJsonData(dialogID);
        
        // 3. é–‹å§‹æ’­æ”¾ç¬¬ä¸€æ®µå°è©±
        currentDialogIndex = 0;
        PlayCurrentDialog();
        
        Debug.Log($"é–‹å§‹åŠ‡æƒ…æ’­æ”¾ - ç« ç¯€: {currentChapter.ChapterName}");
    }
    
    // ğŸ­ æ’­æ”¾ç•¶å‰å°è©± (æ•´åˆç‰ˆ)
    void PlayCurrentDialog()
    {
        // ç²å–ç•¶å‰å°è©±æ•¸æ“š
        NewDialogItem currentDialog = jsonDataManager.GetDialogByIndex(currentDialogIndex) as NewDialogItem;
        
        if (currentDialog == null)
        {
            EndStoryPlayback();
            return;
        }
        
        // å»£æ’­å°è©±æ•¸æ“š
        EventBus.Instance.Post("DialogDataReady", currentDialog);
    }
    
    // ğŸ“¡ å°è©±æ•¸æ“šæº–å‚™å®Œæˆäº‹ä»¶è™•ç† (æ•´åˆç‰ˆ)
    void OnDialogDataReady(object dialogData)
    {
        if (dialogData is NewDialogItem dialog)
        {
            // 1. æ›´æ–°è§’è‰²å±•ç¤º
            UpdateActorDisplay(dialog);
            
            // 2. æ›´æ–°å ´æ™¯
            UpdateSceneDisplay(dialog);
            
            // 3. æ’­æ”¾èªéŸ³ (æ–°åŠŸèƒ½)
            voiceController.PlayVoiceIfNeeded(dialog.ActorName, dialog.HasVoice, dialog.DialogIndex);
            
            // 4. é¡¯ç¤ºå°è©±æ–‡å­—
            textBoxDrama.DisplayDialog(dialog);
        }
    }
    
    // ğŸ¨ æ›´æ–°è§’è‰²å±•ç¤º (æ•´åˆç‰ˆ)
    void UpdateActorDisplay(NewDialogItem dialog)
    {
        // ç²å–å¯¦éš›è§’è‰²åç¨±
        string actualActor = actorMapper.GetActualActor(dialog.ActorName);
        
        // ç²å–é€ å‹è·¯å¾‘
        string costumePath = pathResolver.GetActorCostumePath(actualActor, dialog.CostumeIndex);
        
        // æ›´æ–°è§’è‰²ç®¡ç†å™¨
        actorManager.UpdateActor(actualActor, dialog.ActorFace, dialog.ActorAnimator, 
                               dialog.ActorPosition, costumePath);
        
        if (logActorUpdates)
        {
            Debug.Log($"è§’è‰²æ›´æ–° - {dialog.ActorName}({actualActor}), é€ å‹: {dialog.CostumeIndex}, è¡¨æƒ…: {dialog.ActorFace}");
        }
    }
    
    // ğŸ–¼ï¸ æ›´æ–°å ´æ™¯å±•ç¤º (æ•´åˆç‰ˆ)
    void UpdateSceneDisplay(NewDialogItem dialog)
    {
        // è™•ç†èƒŒæ™¯åˆ‡æ›
        if (!string.IsNullOrEmpty(dialog.Backgroundcomtroller) && dialog.Backgroundcomtroller != "NoActor")
        {
            string bgPath = pathResolver.GetCGImagePath(dialog.Backgroundcomtroller);
            // æ›´æ–°èƒŒæ™¯é¡¯ç¤ºé‚è¼¯
        }
        
        // è™•ç†CGé¡¯ç¤º
        if (!string.IsNullOrEmpty(dialog.CGController) && dialog.CGController != "NoActor")
        {
            string cgPath = pathResolver.GetCGImagePath(dialog.CGController);
            cgDisplay.DisplayCG(cgPath);
        }
        
        // è™•ç†å ´æ™¯æ·¡å…¥æ·¡å‡º
        if (dialog.FadeType == "TRUE")
        {
            // åŸ·è¡Œæ·¡å…¥æ·¡å‡ºé‚è¼¯
        }
    }
    
    // ğŸµ èªéŸ³æ’­æ”¾é–‹å§‹äº‹ä»¶è™•ç† (æ–°åŠŸèƒ½)
    void OnVoicePlaybackStarted(object voiceData)
    {
        if (voiceData is VoicePlaybackEvent voiceEvent)
        {
            Debug.Log($"ğŸµ èªéŸ³é–‹å§‹æ’­æ”¾ - {voiceEvent.actorName}[{voiceEvent.voiceIndex}] æ™‚é•·: {voiceEvent.clipLength}ç§’");
            
            // å¯ä»¥åœ¨é€™è£¡æ·»åŠ èªéŸ³æ’­æ”¾æœŸé–“çš„ç‰¹æ®Šè™•ç†
            // ä¾‹å¦‚ï¼šé¡¯ç¤ºèªéŸ³åœ–æ¨™ã€èª¿æ•´æ–‡å­—é¡¯ç¤ºé€Ÿåº¦ç­‰
        }
    }
    
    // â­ï¸ é€²å…¥ä¸‹ä¸€æ®µå°è©± (æ•´åˆç‰ˆ)
    public void AdvanceToNextDialog()
    {
        currentDialogIndex++;
        
        // æª¢æŸ¥æ˜¯å¦é‚„æœ‰æ›´å¤šå°è©±
        if (currentDialogIndex < jsonDataManager.GetDialogCount())
        {
            PlayCurrentDialog();
        }
        else
        {
            EndStoryPlayback();
        }
    }
    
    // ğŸ çµæŸåŠ‡æƒ…æ’­æ”¾ (æ•´åˆç‰ˆ)
    void EndStoryPlayback()
    {
        // åœæ­¢èªéŸ³æ’­æ”¾
        voiceController.StopVoice();
        
        // è§¸ç™¼åŠ‡æƒ…å®Œæˆäº‹ä»¶
        EventBus.Instance.Post("StoryComplete", new StoryCompleteEvent
        {
            dialogID = currentDialogID,
            chapterName = currentChapter.ChapterName,
            totalDialogs = currentDialogIndex,
            completedAt = System.DateTime.Now
        });
        
        Debug.Log($"åŠ‡æƒ…æ’­æ”¾å®Œæˆ - ç« ç¯€: {currentChapter.ChapterName}, å°è©±æ•¸: {currentDialogIndex}");
    }
}
```

---

## ğŸ—‚ï¸ è³‡æºæª”æ¡ˆçµæ§‹è¦åŠƒ

### ğŸ“ æ¨è–¦çš„å°ˆæ¡ˆè³‡æºçµæ§‹

```
Assets/Resources/
â”‚
â”œâ”€â”€ ChapterConfigs/                    ğŸ‘ˆ ç« ç¯€é…ç½®æª”æ¡ˆ
â”‚   â”œâ”€â”€ Main/
â”‚   â”‚   â”œâ”€â”€ Chapter_01_Config.json
â”‚   â”‚   â”œâ”€â”€ Chapter_02_Config.json
â”‚   â”‚   â””â”€â”€ Chapter_03_Config.json
â”‚   â””â”€â”€ SideStory/
â”‚       â”œâ”€â”€ Nana_Chapter_03_Config.json
â”‚       â”œâ”€â”€ Yuki_Chapter_01_Config.json
â”‚       â””â”€â”€ Sara_Chapter_02_Config.json
â”‚
â”œâ”€â”€ Drama/                             ğŸ‘ˆ å°è©±JSONæª”æ¡ˆ
â”‚   â”œâ”€â”€ Main/
â”‚   â”‚   â”œâ”€â”€ Main_01.json              âœ… å·²æ›´æ–°
â”‚   â”‚   â”œâ”€â”€ Main_02.json
â”‚   â”‚   â””â”€â”€ Main_03.json
â”‚   â””â”€â”€ SideStory/
â”‚       â”œâ”€â”€ Nana_01.json
â”‚       â”œâ”€â”€ Yuki_01.json
â”‚       â””â”€â”€ Sara_01.json
â”‚
â”œâ”€â”€ Voice/                             ğŸ‘ˆ èªéŸ³æª”æ¡ˆ (æ–°å¢)
â”‚   â”œâ”€â”€ Main/
â”‚   â”‚   â””â”€â”€ Chapter_01/
â”‚   â”‚       â”œâ”€â”€ Yuka/
â”‚   â”‚       â”‚   â”œâ”€â”€ Yuka_000.wav
â”‚   â”‚       â”‚   â”œâ”€â”€ Yuka_001.wav
â”‚   â”‚       â”‚   â””â”€â”€ Yuka_002.wav
â”‚   â”‚       â””â”€â”€ boss/
â”‚   â”‚           â”œâ”€â”€ boss_000.wav
â”‚   â”‚           â””â”€â”€ boss_001.wav
â”‚   â””â”€â”€ SideStory/
â”‚       â””â”€â”€ Nana/
â”‚           â””â”€â”€ Chapter_03/
â”‚               â””â”€â”€ nana/
â”‚                   â”œâ”€â”€ nana_000.wav
â”‚                   â”œâ”€â”€ nana_001.wav
â”‚                   â””â”€â”€ nana_002.wav
â”‚
â”œâ”€â”€ CG/                               ğŸ‘ˆ CGåœ–ç‰‡
â”‚   â”œâ”€â”€ Main/Chapter_01/
â”‚   â”œâ”€â”€ SideStory/Nana/Chapter_03/
â”‚   â””â”€â”€ Shared/                       ğŸ‘ˆ å…±ç”¨CG
â”‚
â”œâ”€â”€ SpineCG/                          ğŸ‘ˆ Spineå‹•ç•«CG
â”‚   â”œâ”€â”€ Main/Chapter_01/
â”‚   â”‚   â””â”€â”€ Yuka/
â”‚   â”‚       â”œâ”€â”€ Costume_0/            ğŸ‘ˆ é è¨­é€ å‹
â”‚   â”‚       â”œâ”€â”€ Costume_1/            ğŸ‘ˆ å·¥ä½œæœ
â”‚   â”‚       â””â”€â”€ Costume_2/            ğŸ‘ˆ å±…å®¶æœ
â”‚   â””â”€â”€ SideStory/Nana/Chapter_03/
â”‚       â””â”€â”€ nana/
â”‚           â”œâ”€â”€ Costume_0/
â”‚           â””â”€â”€ Costume_1/
â”‚
â”œâ”€â”€ Backgrounds/                      ğŸ‘ˆ èƒŒæ™¯åœ–ç‰‡
â”‚   â”œâ”€â”€ Main/Chapter_01/
â”‚   â”œâ”€â”€ SideStory/Nana/Chapter_03/
â”‚   â””â”€â”€ Shared/                       ğŸ‘ˆ å…±ç”¨èƒŒæ™¯
â”‚
â””â”€â”€ Music/                           ğŸ‘ˆ èƒŒæ™¯éŸ³æ¨‚
    â”œâ”€â”€ Main/Chapter_01/
    â”œâ”€â”€ SideStory/Nana/Chapter_03/
    â””â”€â”€ Shared/                       ğŸ‘ˆ å…±ç”¨éŸ³æ¨‚
```

---

## ğŸ”§ å¯¦ä½œæŒ‡å—

### ğŸ“‹ å¯¦ä½œæ­¥é©Ÿå»ºè­°

#### ğŸ¯ éšæ®µä¸€ï¼šæ ¸å¿ƒç³»çµ±å¯¦ä½œ (å„ªå…ˆ)
1. **ChapterConfigManager.cs** - ç« ç¯€é…ç½®ç®¡ç†å™¨
2. **ChapterActorMapper.cs** - è§’è‰²æ˜ å°„ç®¡ç†å™¨
3. **VoiceIndexCalculator.cs** - èªéŸ³ç´¢å¼•è¨ˆç®—å™¨
4. **ResourcePathResolver.cs** - è³‡æºè·¯å¾‘è§£æå™¨

#### ğŸ¯ éšæ®µäºŒï¼šèªéŸ³ç³»çµ±æ•´åˆ (é‡è¦)
1. **VoicePlaybackController.cs** - èªéŸ³æ’­æ”¾æ§åˆ¶å™¨
2. æ›´æ–° **DataStructures.cs** - æ”¯æ´æ–°ç‰ˆJSONæ ¼å¼
3. æ›´æ–° **JsonDataManager.cs** - æ”¯æ´æ–°æ¬„ä½è§£æ

#### ğŸ¯ éšæ®µä¸‰ï¼šåŠ‡æƒ…æ§åˆ¶æ•´åˆ (æ ¸å¿ƒ)
1. æ›´æ–° **GamePlayingManagerDrama.cs** - æ•´åˆæ–°ç³»çµ±
2. æ›´æ–°ç¾æœ‰ **TextBoxDrama.cs** å’Œ **ActorManagerDrama.cs**
3. äº‹ä»¶ç³»çµ±æ•´åˆæ¸¬è©¦

#### ğŸ¯ éšæ®µå››ï¼šè³‡æºé…ç½®å®Œå–„ (å…§å®¹)
1. å»ºç«‹ç« ç¯€é…ç½®JSONæª”æ¡ˆ
2. çµ„ç¹”èªéŸ³æª”æ¡ˆçµæ§‹
3. æ¸¬è©¦è³‡æºè·¯å¾‘è§£æ

### âš™ï¸ é…ç½®ç¯„ä¾‹

**Unity Inspector é…ç½®**:
- **ChapterConfigManager**: è¨­å®š `configBasePath = "ChapterConfigs/"`
- **VoicePlaybackController**: èª¿æ•´ `voiceVolume` å’Œ `enableVoicePlayback`
- **ResourcePathResolver**: è¨­å®šæª”æ¡ˆæ ¼å¼å’Œé©—è­‰é–‹é—œ

**æ¸¬è©¦ç”¨ç¨‹å¼ç¢¼**:
```csharp
// æ¸¬è©¦ç« ç¯€åˆ‡æ›
ChapterConfigManager.Instance.SetCurrentChapter("Main", "Chapter_01");

// æ¸¬è©¦è§’è‰²æ˜ å°„
string actualActor = ChapterActorMapper.Instance.GetActualActor("protagonist"); 
// çµæœ: "Yuka"

// æ¸¬è©¦èªéŸ³æ’­æ”¾
VoicePlaybackController.Instance.PlayVoiceIfNeeded("protagonist", true, "21");
// æ’­æ”¾: Voice/Main/Chapter_01/Yuka/Yuka_000.wav
```

---

## ğŸš¨ æ³¨æ„äº‹é …èˆ‡æœ€ä½³å¯¦è¸

### âš ï¸ é‡è¦æ³¨æ„äº‹é …

1. **å‘å¾Œå…¼å®¹æ€§**: ç¢ºä¿æ–°ç³»çµ±èƒ½è™•ç†èˆŠç‰ˆJSONæ ¼å¼
2. **éŒ¯èª¤è™•ç†**: å®Œå–„çš„è³‡æºè¼‰å…¥å¤±æ•—è™•ç†æ©Ÿåˆ¶
3. **æ•ˆèƒ½è€ƒæ…®**: èªéŸ³æª”æ¡ˆé è¼‰å…¥èˆ‡è¨˜æ†¶é«”ç®¡ç†
4. **è³‡æºé©—è­‰**: é–‹ç™¼éšæ®µçš„è³‡æºå®Œæ•´æ€§æª¢æŸ¥
5. **èª¿è©¦åŠŸèƒ½**: è©³ç´°çš„æ—¥èªŒè¨˜éŒ„å’Œç‹€æ…‹é¡¯ç¤º

### ğŸ”§ é–‹ç™¼å»ºè­°

- **æ¨¡çµ„åŒ–æ¸¬è©¦**: æ¯å€‹ç³»çµ±çµ„ä»¶ç¨ç«‹æ¸¬è©¦å¾Œå†æ•´åˆ
- **é…ç½®é©—è­‰**: æä¾›ç« ç¯€é…ç½®æª”æ¡ˆçš„æ ¼å¼é©—è­‰å·¥å…·
- **è³‡æºå·¥å…·**: é–‹ç™¼æ‰¹é‡æª”æ¡ˆé‡å‘½åå’Œçµæ§‹é©—è­‰å·¥å…·
- **èª¿è©¦ä»‹é¢**: åœ¨Unity Editorä¸­æä¾›ç³»çµ±ç‹€æ…‹æª¢è¦–é¢æ¿

### ğŸ“ˆ æœªä¾†æ“´å±•æ€§

- **å¤šèªè¨€æ”¯æ´**: èªéŸ³æª”æ¡ˆè·¯å¾‘å¯è¼•é¬†æ“´å±•å¤šèªè¨€
- **å‹•æ…‹è¼‰å…¥**: æ”¯æ´å¾é ç«¯ä¼ºæœå™¨è¼‰å…¥ç« ç¯€é…ç½®
- **è§’è‰²è¡¨æƒ…åŒ…**: é€ å‹ç³»çµ±å¯æ“´å±•æ”¯æ´è¡¨æƒ…åŒ…
- **èªéŸ³åŒæ­¥**: å¯æ“´å±•æ”¯æ´å­—å¹•èˆ‡èªéŸ³åŒæ­¥é¡¯ç¤º

---

## ğŸ“Š ç³»çµ±æ•ˆç›Šç¸½çµ

### âœ… å•é¡Œè§£æ±ºæƒ…æ³

| åŸæœ‰å•é¡Œ | è§£æ±ºæ–¹æ¡ˆ | æ•ˆç›Š |
|----------|----------|------|
| è§’è‰²å‘½åç¶­è­·å›°é›£ | å»£ç¾©è§’è‰²é¡å‹ + ç« ç¯€æ˜ å°„ | ğŸ”§ ç¶­è­·æˆæœ¬é™ä½90% |
| èªéŸ³æ’­æ”¾åŠŸèƒ½ç¼ºå¤± | é›†æˆèªéŸ³æ’­æ”¾ç³»çµ± | ğŸµ å®Œæ•´èªéŸ³æ”¯æ´ |
| è³‡æºè·¯å¾‘ç¡¬ç·¨ç¢¼ | å‹•æ…‹è·¯å¾‘è§£æ | ğŸ“ éˆæ´»æ€§æå‡300% |
| é€ å‹åˆ‡æ›ä¸ä¾¿ | é€ å‹ç·¨è™Ÿç³»çµ± | ğŸ¨ é€ å‹ç®¡ç†æ¨™æº–åŒ– |
| å¤šæ”¯ç·šè§’è‰²ç®¡ç†è¤‡é›œ | ç« ç¯€ç¨ç«‹é…ç½® | ğŸŒŸ æ”¯ç·šæ“´å±•é›¶æˆæœ¬ |

### ğŸš€ æ€§èƒ½æå‡

- **é–‹ç™¼æ•ˆç‡**: æ–°å¢è§’è‰²æˆ–æ”¯ç·šç„¡éœ€ä¿®æ”¹å°è©±JSON
- **ç¶­è­·æ•ˆç‡**: çµ±ä¸€çš„é…ç½®ç®¡ç†ï¼Œå•é¡Œå®šä½å¿«é€Ÿ
- **æ“´å±•èƒ½åŠ›**: æ¨¡çµ„åŒ–è¨­è¨ˆï¼Œè¼•é¬†æ·»åŠ æ–°åŠŸèƒ½
- **ä½¿ç”¨è€…é«”é©—**: å®Œæ•´çš„èªéŸ³æ’­æ”¾å’Œé€ å‹ç³»çµ±

---

**æœ€å¾Œæ›´æ–°**: 2025-01-17  
**ç‰ˆæœ¬**: 1.0  
**ç¶­è­·è€…**: é–‹ç™¼åœ˜éšŠ + Claude AI  
**ç‹€æ…‹**: âœ… è¨­è¨ˆå®Œæˆï¼Œå¾…å¯¦ä½œ

> ğŸ­ **æ¶æ§‹äº®é»**: æ–°ç‰ˆåŠ‡æƒ…ç³»çµ±é€é**ç« ç¯€é…ç½®é©…å‹•**çš„å‰µæ–°è¨­è¨ˆï¼Œå®Œç¾è§£æ±ºäº†è§’è‰²ç¶­è­·å’ŒèªéŸ³æ’­æ”¾çš„ç—›é»ï¼ŒåŒæ™‚ä¿æŒäº†é«˜åº¦çš„éˆæ´»æ€§å’Œæ“´å±•æ€§ã€‚ç³»çµ±ä¸åƒ…æ”¯æ´è¤‡é›œçš„å¤šæ”¯ç·šè§’è‰²ç®¡ç†ï¼Œé‚„æä¾›äº†å®Œæ•´çš„èªéŸ³æ’­æ”¾å’Œé€ å‹ç®¡ç†åŠŸèƒ½ï¼ âœ¨