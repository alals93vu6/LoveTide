# ğŸ  ä¸»é¸å–®ç³»çµ±æ¶æ§‹

> LoveTide ä¸»é¸å–®çš„æŠ€è¡“æ¶æ§‹è¨­è¨ˆï¼ŒåŒ…å«ä¸‰å‘¨ç›®æ”¯æ´ã€å‹•æ…‹èƒŒæ™¯ç®¡ç†å’ŒåŠŸèƒ½å°èˆªæ§åˆ¶

---

## ğŸ¯ æ¦‚è¿°

ä¸»é¸å–®ç³»çµ±æ¶æ§‹æ˜¯ LoveTide éŠæˆ²çš„å…¥å£æ§åˆ¶ä¸­å¿ƒï¼Œè² è²¬éŠæˆ²å•Ÿå‹•æµç¨‹ã€å‘¨ç›®é€²åº¦æª¢æ¸¬ã€å‹•æ…‹èƒŒæ™¯ç®¡ç†å’Œå„é …åŠŸèƒ½çš„å°èˆªæ§åˆ¶ã€‚ç³»çµ±æ¡ç”¨æ¨¡çµ„åŒ–è¨­è¨ˆï¼Œæ”¯æ´ä¸‰å‘¨ç›®æ©Ÿåˆ¶ï¼Œä¸¦åœ¨ä¸åŒé€²åº¦éšæ®µæä¾›å°æ‡‰çš„åŠŸèƒ½é¸é …ã€‚

---

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹åœ–

```
ğŸ  ä¸»é¸å–®ç³»çµ±æ¶æ§‹
â”‚
â”œâ”€â”€ ğŸ“Š é€²åº¦æª¢æ¸¬å±¤ (Progress Detection Layer)
â”‚   â”œâ”€â”€ ProgressDetector - å‘¨ç›®é€²åº¦æª¢æ¸¬
â”‚   â”œâ”€â”€ SaveDataAnalyzer - å­˜æª”æ•¸æ“šåˆ†æ
â”‚   â”œâ”€â”€ CompletionTracker - å®Œæˆåº¦è¿½è¹¤
â”‚   â””â”€â”€ UnlockConditionChecker - è§£é–æ¢ä»¶æª¢æŸ¥
â”‚
â”œâ”€â”€ ğŸ¨ èƒŒæ™¯ç®¡ç†å±¤ (Background Management Layer)
â”‚   â”œâ”€â”€ MainMenuBackground - èƒŒæ™¯æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ SpineBackgroundController - Spineå‹•ç•«èƒŒæ™¯
â”‚   â”œâ”€â”€ BackgroundTransitionManager - èƒŒæ™¯åˆ‡æ›ç®¡ç†
â”‚   â””â”€â”€ AtmosphericEffects - æ°›åœæ•ˆæœç®¡ç†
â”‚
â”œâ”€â”€ ğŸ® åŠŸèƒ½æ§åˆ¶å±¤ (Function Control Layer)
â”‚   â”œâ”€â”€ MenuButtonManager - æŒ‰éˆ•ç‹€æ…‹ç®¡ç†
â”‚   â”œâ”€â”€ FeatureUnlockController - åŠŸèƒ½è§£é–æ§åˆ¶
â”‚   â”œâ”€â”€ NavigationController - å°èˆªæ§åˆ¶å™¨
â”‚   â””â”€â”€ SceneTransitionManager - å ´æ™¯è½‰æ›ç®¡ç†
â”‚
â”œâ”€â”€ ğŸµ éŸ³æ•ˆç®¡ç†å±¤ (Audio Management Layer)
â”‚   â”œâ”€â”€ MainMenuAudio - éŸ³æ•ˆæ§åˆ¶å™¨
â”‚   â”œâ”€â”€ BGMManager - èƒŒæ™¯éŸ³æ¨‚ç®¡ç†
â”‚   â”œâ”€â”€ UISoundController - UIéŸ³æ•ˆæ§åˆ¶
â”‚   â””â”€â”€ AdaptiveAudioSystem - è‡ªé©æ‡‰éŸ³æ•ˆç³»çµ±
â”‚
â””â”€â”€ ğŸ”— æ•´åˆæœå‹™å±¤ (Integration Service Layer)
    â”œâ”€â”€ SaveSystemIntegration - å­˜æª”ç³»çµ±æ•´åˆ
    â”œâ”€â”€ SettingsIntegration - è¨­å®šç³»çµ±æ•´åˆ
    â”œâ”€â”€ CGGalleryIntegration - CGå¤§å»³æ•´åˆ
    â””â”€â”€ GameModeSelector - éŠæˆ²æ¨¡å¼é¸æ“‡å™¨
```

---

## ğŸ“Š é€²åº¦æª¢æ¸¬å±¤æ¶æ§‹

### ğŸ” ProgressDetector é€²åº¦æª¢æ¸¬æ ¸å¿ƒ
```csharp
public class ProgressDetector : MonoBehaviour
{
    [Header("æ•¸æ“šå¼•ç”¨")]
    public SaveDataManager saveDataManager;
    public CompletionTracker completionTracker;
    
    [Header("å‘¨ç›®æ¨™è¨˜é…ç½®")]
    [SerializeField] private PlaythroughConfig playthroughConfig;
    
    [Header("è§£é–æ¢ä»¶é…ç½®")]
    [SerializeField] private UnlockConditionConfig unlockConfig;
    
    // å¿«å–çš„é€²åº¦æ•¸æ“š
    private PlaythroughData cachedProgressData;
    private float lastUpdateTime;
    private float cacheValidDuration = 5.0f; // å¿«å–æœ‰æ•ˆæœŸ5ç§’
    
    #region å–®ä¾‹æ¨¡å¼
    public static ProgressDetector Instance { get; private set; }
    
    void Awake()
    {
        if (Instance == null)
        {
            Instance = this;
            DontDestroyOnLoad(gameObject);
            InitializeDetector();
        }
        else
        {
            Destroy(gameObject);
        }
    }
    #endregion
    
    // ğŸš€ åˆå§‹åŒ–æª¢æ¸¬å™¨
    void InitializeDetector()
    {
        LoadPlaythroughConfig();
        RefreshProgressData();
        
        // è¨‚é–±ç›¸é—œäº‹ä»¶
        EventBus.Instance.Subscribe<SaveDataChangedEvent>("SaveDataChanged", OnSaveDataChanged);
        EventBus.Instance.Subscribe<GameCompletedEvent>("GameCompleted", OnGameCompleted);
    }
    
    // ğŸ”„ åˆ·æ–°é€²åº¦æ•¸æ“š
    public void RefreshProgressData()
    {
        if (Time.time - lastUpdateTime > cacheValidDuration || cachedProgressData == null)
        {
            cachedProgressData = AnalyzeCurrentProgress();
            lastUpdateTime = Time.time;
        }
    }
    
    // ğŸ“Š åˆ†æç•¶å‰é€²åº¦
    PlaythroughData AnalyzeCurrentProgress()
    {
        PlaythroughData data = new PlaythroughData();
        
        // åˆ†æå‘¨ç›®å®Œæˆç‹€æ…‹
        data.currentPlaythrough = DetermineCurrentPlaythrough();
        data.completedPlaythroughs = GetCompletedPlaythroughs();
        data.isGameCompleted = CheckGameCompletion();
        
        // åˆ†æè§£é–åŠŸèƒ½
        data.unlockedFeatures = DetermineUnlockedFeatures();
        data.completionPercentage = CalculateCompletionPercentage();
        
        // åˆ†æå­˜æª”ç‹€æ…‹
        data.hasValidSaves = HasValidSaveData();
        data.latestSaveSlot = GetLatestSaveSlot();
        
        return data;
    }
    
    // ğŸ¯ åˆ¤æ–·ç•¶å‰å‘¨ç›®
    int DetermineCurrentPlaythrough()
    {
        for (int i = playthroughConfig.maxPlaythroughs - 1; i >= 0; i--)
        {
            string marker = playthroughConfig.completionMarkers[i];
            if (PlayerPrefs.GetInt(marker, 0) == 1)
            {
                return i + 2; // è¿”å›ä¸‹ä¸€å€‹å‘¨ç›®
            }
        }
        return 1; // ç¬¬ä¸€å‘¨ç›®
    }
    
    // âœ… ç²å–å·²å®Œæˆå‘¨ç›®åˆ—è¡¨
    List<int> GetCompletedPlaythroughs()
    {
        List<int> completed = new List<int>();
        
        for (int i = 0; i < playthroughConfig.completionMarkers.Length; i++)
        {
            string marker = playthroughConfig.completionMarkers[i];
            if (PlayerPrefs.GetInt(marker, 0) == 1)
            {
                completed.Add(i + 1);
            }
        }
        
        return completed;
    }
    
    // ğŸ æª¢æŸ¥éŠæˆ²å®Œæˆç‹€æ…‹
    bool CheckGameCompletion()
    {
        // æª¢æŸ¥æ˜¯å¦å®Œæˆæ‰€æœ‰å‘¨ç›®
        foreach (string marker in playthroughConfig.completionMarkers)
        {
            if (PlayerPrefs.GetInt(marker, 0) != 1)
            {
                return false;
            }
        }
        return true;
    }
    
    // ğŸ”“ åˆ¤æ–·è§£é–åŠŸèƒ½
    List<FeatureType> DetermineUnlockedFeatures()
    {
        List<FeatureType> unlocked = new List<FeatureType>();
        
        foreach (var condition in unlockConfig.unlockConditions)
        {
            if (CheckUnlockCondition(condition))
            {
                unlocked.Add(condition.feature);
            }
        }
        
        return unlocked;
    }
    
    // ğŸ” æª¢æŸ¥è§£é–æ¢ä»¶
    bool CheckUnlockCondition(UnlockCondition condition)
    {
        switch (condition.type)
        {
            case ConditionType.Always:
                return true;
                
            case ConditionType.HasSaveData:
                return HasValidSaveData();
                
            case ConditionType.PlaythroughReached:
                return cachedProgressData.currentPlaythrough >= condition.requiredPlaythrough;
                
            case ConditionType.GameCompleted:
                return cachedProgressData.isGameCompleted;
                
            case ConditionType.SpecificRoute:
                return CheckSpecificRouteCompletion(condition.requiredRoute);
                
            default:
                return false;
        }
    }
    
    // ğŸ“ˆ è¨ˆç®—å®Œæˆåº¦ç™¾åˆ†æ¯”
    float CalculateCompletionPercentage()
    {
        return completionTracker.GetOverallCompletionPercentage();
    }
    
    // ğŸ’¾ æª¢æŸ¥å­˜æª”æ•¸æ“š
    bool HasValidSaveData()
    {
        return saveDataManager.HasAnyValidSave();
    }
    
    int GetLatestSaveSlot()
    {
        return saveDataManager.GetMostRecentSaveSlot();
    }
    
    // ğŸ“¢ å…¬é–‹æŸ¥è©¢æ¥å£
    public PlaythroughData GetCurrentProgressData()
    {
        RefreshProgressData();
        return cachedProgressData;
    }
    
    public bool IsFeatureUnlocked(FeatureType feature)
    {
        RefreshProgressData();
        return cachedProgressData.unlockedFeatures.Contains(feature);
    }
    
    public int GetCurrentPlaythrough()
    {
        RefreshProgressData();
        return cachedProgressData.currentPlaythrough;
    }
    
    public bool IsGameCompleted()
    {
        RefreshProgressData();
        return cachedProgressData.isGameCompleted;
    }
    
    // ğŸ“¡ äº‹ä»¶è™•ç†
    void OnSaveDataChanged(SaveDataChangedEvent eventData)
    {
        // å­˜æª”è®Šæ›´æ™‚åˆ·æ–°é€²åº¦
        RefreshProgressData();
        EventBus.Instance.Publish("ProgressUpdated", new ProgressUpdatedEvent 
        { 
            progressData = cachedProgressData 
        });
    }
    
    void OnGameCompleted(GameCompletedEvent eventData)
    {
        // éŠæˆ²å®Œæˆæ™‚æ›´æ–°æ¨™è¨˜
        string marker = playthroughConfig.completionMarkers[eventData.playthroughIndex];
        PlayerPrefs.SetInt(marker, 1);
        PlayerPrefs.Save();
        
        RefreshProgressData();
    }
}
```

### ğŸ“‹ é€²åº¦æ•¸æ“šçµæ§‹
```csharp
[System.Serializable]
public class PlaythroughData
{
    public int currentPlaythrough;
    public List<int> completedPlaythroughs;
    public bool isGameCompleted;
    public List<FeatureType> unlockedFeatures;
    public float completionPercentage;
    public bool hasValidSaves;
    public int latestSaveSlot;
    public DateTime lastUpdateTime;
}

[System.Serializable]
public class PlaythroughConfig
{
    public int maxPlaythroughs = 3;
    public string[] completionMarkers = {
        "first_playthrough_completed",
        "second_playthrough_completed", 
        "third_playthrough_completed"
    };
    public RouteCompletionData[] routeCompletions;
}

[System.Serializable]
public class UnlockConditionConfig
{
    public UnlockCondition[] unlockConditions;
}

[System.Serializable]
public class UnlockCondition
{
    public FeatureType feature;
    public ConditionType type;
    public int requiredPlaythrough;
    public string requiredRoute;
    public float requiredCompletion;
}

public enum FeatureType
{
    ContinueGame,    // ç¹¼çºŒéŠæˆ²
    FreeMode,        // è‡ªç”±æ¨¡å¼
    CGGallery,       // CGè§€è³
    Credits,         // è£½ä½œåå–®
    AdvancedSettings // é€²éšè¨­å®š
}

public enum ConditionType
{
    Always,          // ç¸½æ˜¯è§£é–
    HasSaveData,     // æœ‰å­˜æª”æ™‚è§£é–
    PlaythroughReached, // é”åˆ°æŒ‡å®šå‘¨ç›®
    GameCompleted,   // éŠæˆ²å®Œæˆæ™‚è§£é–
    SpecificRoute    // ç‰¹å®šè·¯ç·šå®Œæˆæ™‚è§£é–
}
```

---

## ğŸ¨ èƒŒæ™¯ç®¡ç†å±¤æ¶æ§‹

### ğŸ–¼ï¸ MainMenuBackground èƒŒæ™¯æ§åˆ¶å™¨
```csharp
public class MainMenuBackground : MonoBehaviour
{
    [Header("èƒŒæ™¯è³‡æº")]
    public BackgroundAssetConfig backgroundConfig;
    public Image backgroundImage;
    public SkeletonGraphic spineBackground;
    
    [Header("åˆ‡æ›æ•ˆæœ")]
    public float transitionDuration = 2.0f;
    public AnimationCurve transitionCurve = AnimationCurve.EaseInOut(0,0,1,1);
    public TransitionType defaultTransitionType = TransitionType.Fade;
    
    [Header("æ°›åœæ•ˆæœ")]
    public AtmosphericEffects atmosphericEffects;
    public ParticleSystem backgroundParticles;
    
    private ProgressDetector progressDetector;
    private BackgroundData currentBackground;
    private Coroutine transitionCoroutine;
    
    void Start()
    {
        progressDetector = ProgressDetector.Instance;
        InitializeBackground();
        
        // è¨‚é–±é€²åº¦æ›´æ–°äº‹ä»¶
        EventBus.Instance.Subscribe<ProgressUpdatedEvent>("ProgressUpdated", OnProgressUpdated);
    }
    
    // ğŸš€ åˆå§‹åŒ–èƒŒæ™¯
    void InitializeBackground()
    {
        PlaythroughData progressData = progressDetector.GetCurrentProgressData();
        BackgroundData targetBackground = DetermineBackgroundForProgress(progressData);
        
        SetBackgroundImmediate(targetBackground);
    }
    
    // ğŸ¯ æ ¹æ“šé€²åº¦ç¢ºå®šèƒŒæ™¯
    BackgroundData DetermineBackgroundForProgress(PlaythroughData progressData)
    {
        if (progressData.isGameCompleted)
        {
            // å…¨é€šé—œå¾Œçš„ç‰¹æ®ŠèƒŒæ™¯
            return backgroundConfig.completionBackground;
        }
        else if (progressData.currentPlaythrough > backgroundConfig.playthroughBackgrounds.Length)
        {
            // è¶…å‡ºé…ç½®ç¯„åœï¼Œä½¿ç”¨æœ€å¾Œä¸€å€‹
            return backgroundConfig.playthroughBackgrounds[backgroundConfig.playthroughBackgrounds.Length - 1];
        }
        else
        {
            // æ ¹æ“šå‘¨ç›®é¸æ“‡èƒŒæ™¯
            int index = Mathf.Clamp(progressData.currentPlaythrough - 1, 0, backgroundConfig.playthroughBackgrounds.Length - 1);
            return backgroundConfig.playthroughBackgrounds[index];
        }
    }
    
    // âš¡ ç«‹å³è¨­å®šèƒŒæ™¯ï¼ˆç„¡å‹•ç•«ï¼‰
    void SetBackgroundImmediate(BackgroundData backgroundData)
    {
        currentBackground = backgroundData;
        
        if (backgroundData.isSpineContent)
        {
            SetupSpineBackground(backgroundData);
        }
        else
        {
            SetupStaticBackground(backgroundData);
        }
        
        // è¨­å®šæ°›åœæ•ˆæœ
        if (atmosphericEffects != null)
        {
            atmosphericEffects.ApplyEffectsForBackground(backgroundData);
        }
    }
    
    // ğŸŒŠ å‹•ç•«åˆ‡æ›èƒŒæ™¯
    public void TransitionToBackground(BackgroundData newBackground)
    {
        if (currentBackground == newBackground || transitionCoroutine != null)
        {
            return; // é¿å…é‡è¤‡åˆ‡æ›
        }
        
        transitionCoroutine = StartCoroutine(BackgroundTransitionCoroutine(newBackground));
    }
    
    // ğŸ¬ èƒŒæ™¯åˆ‡æ›å”ç¨‹
    IEnumerator BackgroundTransitionCoroutine(BackgroundData newBackground)
    {
        // 1. æº–å‚™æ–°èƒŒæ™¯
        GameObject tempBackgroundObj = PrepareNewBackground(newBackground);
        CanvasGroup tempCanvasGroup = tempBackgroundObj.GetComponent<CanvasGroup>();
        if (tempCanvasGroup == null)
        {
            tempCanvasGroup = tempBackgroundObj.AddComponent<CanvasGroup>();
        }
        tempCanvasGroup.alpha = 0;
        
        // 2. ç²å–ç•¶å‰èƒŒæ™¯çš„CanvasGroup
        CanvasGroup currentCanvasGroup = GetCurrentBackgroundCanvasGroup();
        
        // 3. åŸ·è¡Œåˆ‡æ›å‹•ç•«
        float elapsedTime = 0;
        while (elapsedTime < transitionDuration)
        {
            elapsedTime += Time.deltaTime;
            float progress = transitionCurve.Evaluate(elapsedTime / transitionDuration);
            
            // æ·¡å‡ºèˆŠèƒŒæ™¯ï¼Œæ·¡å…¥æ–°èƒŒæ™¯
            if (currentCanvasGroup != null)
            {
                currentCanvasGroup.alpha = 1 - progress;
            }
            tempCanvasGroup.alpha = progress;
            
            yield return null;
        }
        
        // 4. å®Œæˆåˆ‡æ›
        CompleteBackgroundTransition(newBackground, tempBackgroundObj);
        transitionCoroutine = null;
    }
    
    // ğŸª è¨­å®šSpineèƒŒæ™¯
    void SetupSpineBackground(BackgroundData backgroundData)
    {
        // éš±è—éœæ…‹èƒŒæ™¯
        backgroundImage.gameObject.SetActive(false);
        
        // é¡¯ç¤ºSpineèƒŒæ™¯
        spineBackground.gameObject.SetActive(true);
        spineBackground.skeletonDataAsset = backgroundData.spineData;
        spineBackground.Initialize(true);
        
        // æ’­æ”¾é è¨­å‹•ç•«
        if (!string.IsNullOrEmpty(backgroundData.defaultAnimation))
        {
            spineBackground.AnimationState.SetAnimation(0, backgroundData.defaultAnimation, true);
        }
        
        // è¨­å®šæ’­æ”¾é€Ÿåº¦
        spineBackground.AnimationState.TimeScale = backgroundData.animationSpeed;
    }
    
    // ğŸ–¼ï¸ è¨­å®šéœæ…‹èƒŒæ™¯
    void SetupStaticBackground(BackgroundData backgroundData)
    {
        // éš±è—SpineèƒŒæ™¯
        spineBackground.gameObject.SetActive(false);
        
        // é¡¯ç¤ºéœæ…‹èƒŒæ™¯
        backgroundImage.gameObject.SetActive(true);
        backgroundImage.sprite = backgroundData.sprite;
        
        // æ‡‰ç”¨é¡è‰²èª¿æ•´
        backgroundImage.color = backgroundData.tintColor;
    }
    
    // ğŸ“¡ é€²åº¦æ›´æ–°äº‹ä»¶è™•ç†
    void OnProgressUpdated(ProgressUpdatedEvent eventData)
    {
        BackgroundData newBackground = DetermineBackgroundForProgress(eventData.progressData);
        
        if (newBackground != currentBackground)
        {
            TransitionToBackground(newBackground);
        }
    }
    
    // ğŸ§¹ æ¸…ç†è³‡æº
    void OnDestroy()
    {
        if (transitionCoroutine != null)
        {
            StopCoroutine(transitionCoroutine);
        }
        
        EventBus.Instance.Unsubscribe<ProgressUpdatedEvent>("ProgressUpdated", OnProgressUpdated);
    }
}
```

### ğŸŒŸ AtmosphericEffects æ°›åœæ•ˆæœç®¡ç†å™¨
```csharp
public class AtmosphericEffects : MonoBehaviour
{
    [Header("å…‰ç…§æ•ˆæœ")]
    public Light mainLight;
    public Light ambientLight;
    public LightEffectConfig lightConfig;
    
    [Header("ç²’å­æ•ˆæœ")]
    public ParticleSystem[] particleSystems;
    public ParticleEffectConfig particleConfig;
    
    [Header("å¾Œè™•ç†æ•ˆæœ")]
    public Volume postProcessVolume;
    public PostProcessEffectConfig postProcessConfig;
    
    [Header("å‹•ç•«æ§åˆ¶")]
    public float effectTransitionDuration = 1.0f;
    
    private Coroutine lightAnimationCoroutine;
    private Dictionary<string, ParticleSystem> particleSystemMap;
    
    void Awake()
    {
        InitializeEffectSystems();
    }
    
    // ğŸš€ åˆå§‹åŒ–æ•ˆæœç³»çµ±
    void InitializeEffectSystems()
    {
        // å»ºç«‹ç²’å­ç³»çµ±æ˜ å°„
        particleSystemMap = new Dictionary<string, ParticleSystem>();
        foreach (var ps in particleSystems)
        {
            if (ps != null)
            {
                particleSystemMap[ps.name] = ps;
            }
        }
    }
    
    // ğŸ¨ ç‚ºèƒŒæ™¯æ‡‰ç”¨æ°›åœæ•ˆæœ
    public void ApplyEffectsForBackground(BackgroundData backgroundData)
    {
        // æ‡‰ç”¨å…‰ç…§æ•ˆæœ
        if (backgroundData.lightingEffect != null)
        {
            ApplyLightingEffect(backgroundData.lightingEffect);
        }
        
        // æ‡‰ç”¨ç²’å­æ•ˆæœ
        if (backgroundData.particleEffects != null && backgroundData.particleEffects.Length > 0)
        {
            ApplyParticleEffects(backgroundData.particleEffects);
        }
        
        // æ‡‰ç”¨å¾Œè™•ç†æ•ˆæœ
        if (backgroundData.postProcessProfile != null)
        {
            ApplyPostProcessEffect(backgroundData.postProcessProfile);
        }
    }
    
    // ğŸ’¡ æ‡‰ç”¨å…‰ç…§æ•ˆæœ
    void ApplyLightingEffect(LightingEffectData lightingData)
    {
        if (lightAnimationCoroutine != null)
        {
            StopCoroutine(lightAnimationCoroutine);
        }
        
        lightAnimationCoroutine = StartCoroutine(AnimateLighting(lightingData));
    }
    
    // ğŸŒŠ å…‰ç…§å‹•ç•«å”ç¨‹
    IEnumerator AnimateLighting(LightingEffectData targetLighting)
    {
        // è¨˜éŒ„åˆå§‹å€¼
        float startMainIntensity = mainLight.intensity;
        Color startMainColor = mainLight.color;
        float startAmbientIntensity = ambientLight.intensity;
        Color startAmbientColor = ambientLight.color;
        
        float elapsedTime = 0;
        while (elapsedTime < effectTransitionDuration)
        {
            elapsedTime += Time.deltaTime;
            float progress = elapsedTime / effectTransitionDuration;
            
            // æ’å€¼å…‰ç…§å±¬æ€§
            mainLight.intensity = Mathf.Lerp(startMainIntensity, targetLighting.mainLightIntensity, progress);
            mainLight.color = Color.Lerp(startMainColor, targetLighting.mainLightColor, progress);
            
            ambientLight.intensity = Mathf.Lerp(startAmbientIntensity, targetLighting.ambientLightIntensity, progress);
            ambientLight.color = Color.Lerp(startAmbientColor, targetLighting.ambientLightColor, progress);
            
            yield return null;
        }
        
        // ç¢ºä¿æœ€çµ‚å€¼æº–ç¢º
        mainLight.intensity = targetLighting.mainLightIntensity;
        mainLight.color = targetLighting.mainLightColor;
        ambientLight.intensity = targetLighting.ambientLightIntensity;
        ambientLight.color = targetLighting.ambientLightColor;
        
        // å¦‚æœæœ‰è„ˆè¡æ•ˆæœï¼Œå•Ÿå‹•è„ˆè¡å‹•ç•«
        if (targetLighting.enablePulse)
        {
            StartCoroutine(PulseLightingEffect(targetLighting));
        }
        
        lightAnimationCoroutine = null;
    }
    
    // âœ¨ è„ˆè¡å…‰ç…§æ•ˆæœ
    IEnumerator PulseLightingEffect(LightingEffectData lightingData)
    {
        float baseIntensity = lightingData.mainLightIntensity;
        
        while (true)
        {
            float pulseValue = Mathf.Sin(Time.time * lightingData.pulseSpeed) * lightingData.pulseAmplitude;
            mainLight.intensity = baseIntensity + pulseValue;
            yield return null;
        }
    }
    
    // ğŸ† æ‡‰ç”¨ç²’å­æ•ˆæœ
    void ApplyParticleEffects(string[] effectNames)
    {
        // é¦–å…ˆåœç”¨æ‰€æœ‰ç²’å­ç³»çµ±
        foreach (var ps in particleSystems)
        {
            if (ps != null && ps.isPlaying)
            {
                ps.Stop();
            }
        }
        
        // å•Ÿç”¨æŒ‡å®šçš„ç²’å­æ•ˆæœ
        foreach (string effectName in effectNames)
        {
            if (particleSystemMap.ContainsKey(effectName))
            {
                ParticleSystem targetPS = particleSystemMap[effectName];
                if (targetPS != null)
                {
                    targetPS.Play();
                }
            }
        }
    }
    
    // ğŸ¨ æ‡‰ç”¨å¾Œè™•ç†æ•ˆæœ
    void ApplyPostProcessEffect(VolumeProfile profile)
    {
        if (postProcessVolume != null && profile != null)
        {
            postProcessVolume.profile = profile;
        }
    }
}
```

---

## ğŸ® åŠŸèƒ½æ§åˆ¶å±¤æ¶æ§‹

### ğŸ”˜ MenuButtonManager æŒ‰éˆ•ç®¡ç†å™¨
```csharp
public class MenuButtonManager : MonoBehaviour
{
    [Header("æŒ‰éˆ•é…ç½®")]
    public MenuButtonConfig buttonConfig;
    public MenuButton[] menuButtons;
    
    [Header("è¦–è¦ºæ•ˆæœ")]
    public UIEffectsManager effectsManager;
    
    [Header("éŸ³æ•ˆ")]
    public MainMenuAudio audioManager;
    
    private ProgressDetector progressDetector;
    private Dictionary<FeatureType, MenuButton> buttonMap;
    
    void Start()
    {
        progressDetector = ProgressDetector.Instance;
        InitializeButtons();
        
        // è¨‚é–±é€²åº¦æ›´æ–°äº‹ä»¶
        EventBus.Instance.Subscribe<ProgressUpdatedEvent>("ProgressUpdated", OnProgressUpdated);
    }
    
    // ğŸš€ åˆå§‹åŒ–æŒ‰éˆ•ç³»çµ±
    void InitializeButtons()
    {
        // å»ºç«‹æŒ‰éˆ•æ˜ å°„
        buttonMap = new Dictionary<FeatureType, MenuButton>();
        foreach (var button in menuButtons)
        {
            if (button != null)
            {
                buttonMap[button.featureType] = button;
                SetupButton(button);
            }
        }
        
        // åˆå§‹ç‹€æ…‹æ›´æ–°
        UpdateAllButtonStates();
    }
    
    // âš™ï¸ è¨­å®šå–®å€‹æŒ‰éˆ•
    void SetupButton(MenuButton button)
    {
        // ç¶å®šé»æ“Šäº‹ä»¶
        button.buttonComponent.onClick.AddListener(() => {
            OnButtonClicked(button.featureType);
        });
        
        // æ·»åŠ Hoveræ•ˆæœ
        ButtonHoverEffect hoverEffect = button.buttonComponent.gameObject.GetComponent<ButtonHoverEffect>();
        if (hoverEffect == null)
        {
            hoverEffect = button.buttonComponent.gameObject.AddComponent<ButtonHoverEffect>();
        }
        
        hoverEffect.Initialize(effectsManager, audioManager);
        
        // è¨­å®šè¦–è¦ºçµ„ä»¶å¼•ç”¨
        button.Initialize();
    }
    
    // ğŸ”„ æ›´æ–°æ‰€æœ‰æŒ‰éˆ•ç‹€æ…‹
    void UpdateAllButtonStates()
    {
        PlaythroughData progressData = progressDetector.GetCurrentProgressData();
        
        foreach (var kvp in buttonMap)
        {
            FeatureType feature = kvp.Key;
            MenuButton button = kvp.Value;
            
            bool shouldEnable = ShouldEnableButton(feature, progressData);
            bool isNewFeature = IsNewFeature(feature, progressData);
            
            SetButtonState(button, shouldEnable, isNewFeature);
        }
    }
    
    // ğŸ” åˆ¤æ–·æŒ‰éˆ•æ˜¯å¦æ‡‰è©²å•Ÿç”¨
    bool ShouldEnableButton(FeatureType feature, PlaythroughData progressData)
    {
        return progressData.unlockedFeatures.Contains(feature);
    }
    
    // ğŸ†• åˆ¤æ–·æ˜¯å¦ç‚ºæ–°åŠŸèƒ½
    bool IsNewFeature(FeatureType feature, PlaythroughData progressData)
    {
        // æª¢æŸ¥åŠŸèƒ½æ˜¯å¦åœ¨æœ€è¿‘è§£é–ï¼ˆä¾‹å¦‚24å°æ™‚å…§ï¼‰
        string lastUnlockKey = $"LastUnlock_{feature}";
        string lastUnlockTimeStr = PlayerPrefs.GetString(lastUnlockKey, "");
        
        if (System.DateTime.TryParse(lastUnlockTimeStr, out System.DateTime lastUnlockTime))
        {
            return (System.DateTime.Now - lastUnlockTime).TotalHours < 24;
        }
        
        return false;
    }
    
    // ğŸ¨ è¨­å®šæŒ‰éˆ•ç‹€æ…‹
    void SetButtonState(MenuButton button, bool enabled, bool isNew)
    {
        // è¨­å®šäº¤äº’ç‹€æ…‹
        button.buttonComponent.interactable = enabled;
        
        // è¨­å®šè¦–è¦ºç‹€æ…‹
        button.SetEnabledState(enabled);
        button.SetNewFeatureIndicator(isNew);
        
        // è¨­å®šé¡è‰²
        Color targetColor = enabled ? Color.white : buttonConfig.disabledColor;
        button.SetButtonColor(targetColor);
    }
    
    // ğŸ¯ æŒ‰éˆ•é»æ“Šè™•ç†
    void OnButtonClicked(FeatureType featureType)
    {
        // æ’­æ”¾é»æ“ŠéŸ³æ•ˆ
        audioManager.PlayButtonClick();
        
        // åŸ·è¡Œå°æ‡‰åŠŸèƒ½
        switch (featureType)
        {
            case FeatureType.ContinueGame:
                HandleContinueGame();
                break;
                
            case FeatureType.FreeMode:
                HandleFreeMode();
                break;
                
            case FeatureType.CGGallery:
                HandleCGGallery();
                break;
                
            case FeatureType.Credits:
                HandleCredits();
                break;
                
            case FeatureType.AdvancedSettings:
                HandleAdvancedSettings();
                break;
                
            default:
                Debug.LogWarning($"æœªè™•ç†çš„åŠŸèƒ½é¡å‹: {featureType}");
                break;
        }
        
        // æ¸…é™¤æ–°åŠŸèƒ½æ¨™è¨˜
        ClearNewFeatureFlag(featureType);
    }
    
    // ğŸ® è™•ç†ç¹¼çºŒéŠæˆ²
    void HandleContinueGame()
    {
        PlaythroughData progressData = progressDetector.GetCurrentProgressData();
        
        if (progressData.hasValidSaves)
        {
            // è¼‰å…¥æœ€æ–°å­˜æª”
            GameModeSelector.Instance.LoadLatestSave();
        }
        else
        {
            // é¡¯ç¤ºç„¡å­˜æª”æç¤º
            ShowNoSaveDataMessage();
        }
    }
    
    // ğŸ†“ è™•ç†è‡ªç”±æ¨¡å¼
    void HandleFreeMode()
    {
        GameModeSelector.Instance.StartFreeMode();
    }
    
    // ğŸ›ï¸ è™•ç†CGè§€è³
    void HandleCGGallery()
    {
        GameModeSelector.Instance.OpenCGGallery();
    }
    
    // ğŸ“œ è™•ç†è£½ä½œåå–®
    void HandleCredits()
    {
        GameModeSelector.Instance.ShowCredits();
    }
    
    // âš™ï¸ è™•ç†é€²éšè¨­å®š
    void HandleAdvancedSettings()
    {
        GameModeSelector.Instance.OpenAdvancedSettings();
    }
    
    // ğŸš¨ é¡¯ç¤ºç„¡å­˜æª”è¨Šæ¯
    void ShowNoSaveDataMessage()
    {
        // å¯ä»¥é¡¯ç¤ºå°è©±æ¡†æˆ–æç¤ºUI
        Debug.LogWarning("æ²’æœ‰å¯ç”¨çš„å­˜æª”æ•¸æ“š");
        
        // è§¸ç™¼UIæç¤ºäº‹ä»¶
        EventBus.Instance.Publish("ShowMessage", new ShowMessageEvent
        {
            title = "æç¤º",
            message = "æ²’æœ‰æ‰¾åˆ°å¯è¼‰å…¥çš„å­˜æª”",
            messageType = MessageType.Warning
        });
    }
    
    // ğŸ†• æ¸…é™¤æ–°åŠŸèƒ½æ¨™è¨˜
    void ClearNewFeatureFlag(FeatureType feature)
    {
        string flagKey = $"NewFeature_{feature}";
        PlayerPrefs.DeleteKey(flagKey);
        PlayerPrefs.Save();
        
        // æ›´æ–°æŒ‰éˆ•è¦–è¦ºç‹€æ…‹
        if (buttonMap.ContainsKey(feature))
        {
            buttonMap[feature].SetNewFeatureIndicator(false);
        }
    }
    
    // ğŸ“¡ é€²åº¦æ›´æ–°äº‹ä»¶è™•ç†
    void OnProgressUpdated(ProgressUpdatedEvent eventData)
    {
        UpdateAllButtonStates();
    }
    
    // ğŸ§¹ æ¸…ç†
    void OnDestroy()
    {
        EventBus.Instance.Unsubscribe<ProgressUpdatedEvent>("ProgressUpdated", OnProgressUpdated);
    }
}
```

### ğŸ”² MenuButton æŒ‰éˆ•çµ„ä»¶
```csharp
[System.Serializable]
public class MenuButton
{
    [Header("åŸºæœ¬é…ç½®")]
    public FeatureType featureType;
    public Button buttonComponent;
    public string buttonName;
    
    [Header("è¦–è¦ºçµ„ä»¶")]
    public Image buttonImage;
    public Text buttonText;
    public GameObject newFeatureIndicator;
    public GameObject lockIcon;
    
    [Header("å‹•ç•«çµ„ä»¶")]
    public Animator buttonAnimator;
    public string enabledAnimationTrigger = "Enable";
    public string disabledAnimationTrigger = "Disable";
    
    private bool isInitialized = false;
    
    // ğŸš€ åˆå§‹åŒ–æŒ‰éˆ•
    public void Initialize()
    {
        if (isInitialized) return;
        
        // ç¢ºä¿æ‰€æœ‰çµ„ä»¶å¼•ç”¨æ­£ç¢º
        ValidateComponents();
        
        // è¨­å®šåˆå§‹ç‹€æ…‹
        SetInitialState();
        
        isInitialized = true;
    }
    
    // âœ… é©—è­‰çµ„ä»¶å¼•ç”¨
    void ValidateComponents()
    {
        if (buttonComponent == null)
        {
            Debug.LogError($"MenuButton {buttonName}: buttonComponent æœªè¨­å®š");
        }
        
        if (buttonImage == null)
        {
            buttonImage = buttonComponent.GetComponent<Image>();
        }
        
        if (buttonText == null)
        {
            buttonText = buttonComponent.GetComponentInChildren<Text>();
        }
    }
    
    // ğŸ¯ è¨­å®šåˆå§‹ç‹€æ…‹
    void SetInitialState()
    {
        SetNewFeatureIndicator(false);
        SetEnabledState(true); // é è¨­å•Ÿç”¨ï¼Œç”±ç®¡ç†å™¨æ§åˆ¶å¯¦éš›ç‹€æ…‹
    }
    
    // ğŸ”„ è¨­å®šå•Ÿç”¨ç‹€æ…‹
    public void SetEnabledState(bool enabled)
    {
        if (lockIcon != null)
        {
            lockIcon.SetActive(!enabled);
        }
        
        // è§¸ç™¼å‹•ç•«
        if (buttonAnimator != null)
        {
            string trigger = enabled ? enabledAnimationTrigger : disabledAnimationTrigger;
            buttonAnimator.SetTrigger(trigger);
        }
    }
    
    // ğŸ†• è¨­å®šæ–°åŠŸèƒ½æŒ‡ç¤ºå™¨
    public void SetNewFeatureIndicator(bool show)
    {
        if (newFeatureIndicator != null)
        {
            newFeatureIndicator.SetActive(show);
        }
    }
    
    // ğŸ¨ è¨­å®šæŒ‰éˆ•é¡è‰²
    public void SetButtonColor(Color color)
    {
        if (buttonImage != null)
        {
            buttonImage.color = color;
        }
    }
    
    // ğŸ“ è¨­å®šæŒ‰éˆ•æ–‡å­—
    public void SetButtonText(string text)
    {
        if (buttonText != null)
        {
            buttonText.text = text;
        }
    }
    
    // ğŸª æ’­æ”¾æŒ‰éˆ•å‹•ç•«
    public void PlayButtonAnimation(string animationName)
    {
        if (buttonAnimator != null)
        {
            buttonAnimator.SetTrigger(animationName);
        }
    }
}
```

---

## ğŸµ éŸ³æ•ˆç®¡ç†å±¤æ¶æ§‹

### ğŸ”Š MainMenuAudio éŸ³æ•ˆæ§åˆ¶å™¨
```csharp
public class MainMenuAudio : MonoBehaviour
{
    [Header("èƒŒæ™¯éŸ³æ¨‚")]
    public BGMManager bgmManager;
    public AudioClip[] playthroughBGM;
    public AudioClip completionBGM;
    
    [Header("UIéŸ³æ•ˆ")]
    public UISoundController uiSoundController;
    
    [Header("è‡ªé©æ‡‰éŸ³æ•ˆ")]
    public AdaptiveAudioSystem adaptiveAudio;
    
    [Header("éŸ³æ•ˆè¨­å®š")]
    public float masterVolume = 1.0f;
    public float bgmVolume = 0.8f;
    public float uiVolume = 0.7f;
    
    private ProgressDetector progressDetector;
    
    void Start()
    {
        progressDetector = ProgressDetector.Instance;
        InitializeAudioSystem();
        
        // è¨‚é–±é€²åº¦æ›´æ–°äº‹ä»¶
        EventBus.Instance.Subscribe<ProgressUpdatedEvent>("ProgressUpdated", OnProgressUpdated);
    }
    
    // ğŸš€ åˆå§‹åŒ–éŸ³æ•ˆç³»çµ±
    void InitializeAudioSystem()
    {
        // æ‡‰ç”¨éŸ³é‡è¨­å®š
        ApplyVolumeSettings();
        
        // æ ¹æ“šé€²åº¦æ’­æ”¾å°æ‡‰BGM
        PlayAppropriateBackgroundMusic();
        
        // åˆå§‹åŒ–è‡ªé©æ‡‰éŸ³æ•ˆ
        if (adaptiveAudio != null)
        {
            adaptiveAudio.Initialize();
        }
    }
    
    // ğŸµ æ’­æ”¾é©ç•¶çš„èƒŒæ™¯éŸ³æ¨‚
    void PlayAppropriateBackgroundMusic()
    {
        PlaythroughData progressData = progressDetector.GetCurrentProgressData();
        AudioClip targetBGM = SelectBGMForProgress(progressData);
        
        if (targetBGM != null)
        {
            bgmManager.PlayBGM(targetBGM, true);
        }
    }
    
    // ğŸ¼ ç‚ºé€²åº¦é¸æ“‡BGM
    AudioClip SelectBGMForProgress(PlaythroughData progressData)
    {
        if (progressData.isGameCompleted && completionBGM != null)
        {
            return completionBGM;
        }
        else if (progressData.currentPlaythrough > 0 && progressData.currentPlaythrough <= playthroughBGM.Length)
        {
            return playthroughBGM[progressData.currentPlaythrough - 1];
        }
        else if (playthroughBGM.Length > 0)
        {
            return playthroughBGM[0]; // é è¨­BGM
        }
        
        return null;
    }
    
    // ğŸ”Š æ‡‰ç”¨éŸ³é‡è¨­å®š
    void ApplyVolumeSettings()
    {
        // å¾è¨­å®šä¸­è¼‰å…¥éŸ³é‡
        masterVolume = PlayerPrefs.GetFloat("MasterVolume", 1.0f);
        bgmVolume = PlayerPrefs.GetFloat("BGMVolume", 0.8f);
        uiVolume = PlayerPrefs.GetFloat("UIVolume", 0.7f);
        
        // æ‡‰ç”¨åˆ°éŸ³æ•ˆç®¡ç†å™¨
        if (bgmManager != null)
        {
            bgmManager.SetVolume(masterVolume * bgmVolume);
        }
        
        if (uiSoundController != null)
        {
            uiSoundController.SetVolume(masterVolume * uiVolume);
        }
    }
    
    // ğŸ“¢ å…¬é–‹éŸ³æ•ˆæ¥å£
    public void PlayButtonHover()
    {
        uiSoundController.PlayButtonHover();
    }
    
    public void PlayButtonClick()
    {
        uiSoundController.PlayButtonClick();
    }
    
    public void PlayButtonDisabled()
    {
        uiSoundController.PlayButtonDisabled();
    }
    
    public void PlayFeatureUnlock()
    {
        uiSoundController.PlayFeatureUnlock();
    }
    
    // ğŸ“¡ é€²åº¦æ›´æ–°äº‹ä»¶è™•ç†
    void OnProgressUpdated(ProgressUpdatedEvent eventData)
    {
        AudioClip newBGM = SelectBGMForProgress(eventData.progressData);
        
        if (newBGM != bgmManager.GetCurrentBGM())
        {
            bgmManager.CrossfadeToBGM(newBGM, 2.0f);
        }
    }
    
    // ğŸ§¹ æ¸…ç†
    void OnDestroy()
    {
        EventBus.Instance.Unsubscribe<ProgressUpdatedEvent>("ProgressUpdated", OnProgressUpdated);
    }
}
```

---

## ğŸ”— æ•´åˆæœå‹™å±¤æ¶æ§‹

### ğŸ¯ GameModeSelector éŠæˆ²æ¨¡å¼é¸æ“‡å™¨
```csharp
public class GameModeSelector : MonoBehaviour
{
    [Header("å ´æ™¯é…ç½®")]
    public string gameSceneName = "GameScene";
    public string freeModeSceneName = "FreeModeScene";
    public string cgGallerySceneName = "CGGallery";
    public string creditsSceneName = "Credits";
    public string advancedSettingsSceneName = "AdvancedSettings";
    
    [Header("è¼‰å…¥ç®¡ç†")]
    public SceneTransitionManager transitionManager;
    
    [Header("æ•¸æ“šç®¡ç†")]
    public SaveDataManager saveDataManager;
    public ProgressDetector progressDetector;
    
    #region å–®ä¾‹æ¨¡å¼
    public static GameModeSelector Instance { get; private set; }
    
    void Awake()
    {
        if (Instance == null)
        {
            Instance = this;
            DontDestroyOnLoad(gameObject);
        }
        else
        {
            Destroy(gameObject);
        }
    }
    #endregion
    
    // ğŸ® é–‹å§‹æ–°éŠæˆ²
    public void StartNewGame()
    {
        // æ¸…é™¤è¼‰å…¥å­˜æª”æ¨™è¨˜
        PlayerPrefs.DeleteKey("LoadSaveSlot");
        PlayerPrefs.Save();
        
        // è¼‰å…¥éŠæˆ²å ´æ™¯
        transitionManager.LoadScene(gameSceneName);
    }
    
    // ğŸ“€ è¼‰å…¥æœ€æ–°å­˜æª”
    public void LoadLatestSave()
    {
        int latestSaveSlot = saveDataManager.GetMostRecentSaveSlot();
        
        if (latestSaveSlot >= 0)
        {
            LoadSpecificSave(latestSaveSlot);
        }
        else
        {
            Debug.LogWarning("æ²’æœ‰æ‰¾åˆ°å¯è¼‰å…¥çš„å­˜æª”");
            EventBus.Instance.Publish("ShowMessage", new ShowMessageEvent
            {
                title = "éŒ¯èª¤",
                message = "æ²’æœ‰æ‰¾åˆ°å¯è¼‰å…¥çš„å­˜æª”",
                messageType = MessageType.Error
            });
        }
    }
    
    // ğŸ“ è¼‰å…¥æŒ‡å®šå­˜æª”
    public void LoadSpecificSave(int saveSlot)
    {
        if (saveDataManager.HasSaveData(saveSlot))
        {
            // è¨­å®šè¦è¼‰å…¥çš„å­˜æª”æ§½ä½
            PlayerPrefs.SetInt("LoadSaveSlot", saveSlot);
            PlayerPrefs.Save();
            
            // è¼‰å…¥éŠæˆ²å ´æ™¯
            transitionManager.LoadScene(gameSceneName);
        }
        else
        {
            Debug.LogWarning($"å­˜æª”æ§½ä½ {saveSlot} æ²’æœ‰æ•¸æ“š");
        }
    }
    
    // ğŸ†“ é–‹å§‹è‡ªç”±æ¨¡å¼
    public void StartFreeMode()
    {
        if (progressDetector.IsFeatureUnlocked(FeatureType.FreeMode))
        {
            // è¨­å®šè‡ªç”±æ¨¡å¼æ¨™è¨˜
            PlayerPrefs.SetInt("IsFreeModeActive", 1);
            PlayerPrefs.Save();
            
            // è¼‰å…¥è‡ªç”±æ¨¡å¼å ´æ™¯
            transitionManager.LoadScene(freeModeSceneName);
        }
        else
        {
            Debug.LogWarning("è‡ªç”±æ¨¡å¼å°šæœªè§£é–");
        }
    }
    
    // ğŸ›ï¸ é–‹å•ŸCGè§€è³å¤§å»³
    public void OpenCGGallery()
    {
        if (progressDetector.IsFeatureUnlocked(FeatureType.CGGallery))
        {
            transitionManager.LoadScene(cgGallerySceneName);
        }
        else
        {
            Debug.LogWarning("CGè§€è³åŠŸèƒ½å°šæœªè§£é–");
        }
    }
    
    // ğŸ“œ é¡¯ç¤ºè£½ä½œåå–®
    public void ShowCredits()
    {
        transitionManager.LoadScene(creditsSceneName);
    }
    
    // âš™ï¸ é–‹å•Ÿé€²éšè¨­å®š
    public void OpenAdvancedSettings()
    {
        if (progressDetector.IsFeatureUnlocked(FeatureType.AdvancedSettings))
        {
            transitionManager.LoadScene(advancedSettingsSceneName);
        }
        else
        {
            // é–‹å•ŸåŸºç¤è¨­å®šé¢æ¿
            OpenBasicSettings();
        }
    }
    
    // âš™ï¸ é–‹å•ŸåŸºç¤è¨­å®š
    void OpenBasicSettings()
    {
        // è§¸ç™¼è¨­å®šé¢æ¿é¡¯ç¤ºäº‹ä»¶
        EventBus.Instance.Publish("ShowSettingsPanel", new ShowSettingsPanelEvent
        {
            settingsType = SettingsType.Basic
        });
    }
    
    // ğŸšª é€€å‡ºéŠæˆ²
    public void ExitGame()
    {
        // é¡¯ç¤ºç¢ºèªå°è©±æ¡†
        EventBus.Instance.Publish("ShowConfirmDialog", new ShowConfirmDialogEvent
        {
            title = "ç¢ºèªé€€å‡º",
            message = "ç¢ºå®šè¦é€€å‡ºéŠæˆ²å—ï¼Ÿ",
            onConfirm = () => {
                DoExitGame();
            }
        });
    }
    
    // âœ… åŸ·è¡Œé€€å‡ºéŠæˆ²
    void DoExitGame()
    {
        // ä¿å­˜è¨­å®šå’Œé€²åº¦
        PlayerPrefs.Save();
        
        // é€€å‡ºæ‡‰ç”¨
        #if UNITY_EDITOR
            UnityEditor.EditorApplication.isPlaying = false;
        #else
            Application.Quit();
        #endif
    }
}
```

---

## ğŸ’¬ Claude ä½¿ç”¨æç¤º

### ğŸ¯ æ¶æ§‹é‡é»
1. **æ¨¡çµ„åŒ–è¨­è¨ˆ**: å„å±¤è·è²¬æ¸…æ™°ï¼Œä¾¿æ–¼ç¶­è­·å’Œæ“´å±•
2. **äº‹ä»¶é©…å‹•**: ä½¿ç”¨EventBuså¯¦ç¾è§£è€¦é€šä¿¡
3. **é€²åº¦æª¢æ¸¬**: æ™ºèƒ½çš„å‘¨ç›®å’ŒåŠŸèƒ½è§£é–æª¢æ¸¬
4. **è³‡æºç®¡ç†**: é©ç•¶çš„èƒŒæ™¯å’ŒéŸ³æ•ˆè³‡æºç®¡ç†

### ğŸ”§ é–‹ç™¼å»ºè­°
- å„ªå…ˆå¯¦ä½œProgressDetectorå’ŒåŸºç¤æ•¸æ“šçµæ§‹
- ç¢ºä¿äº‹ä»¶ç³»çµ±çš„ç©©å®šæ€§å’ŒéŒ¯èª¤è™•ç†
- æ³¨é‡è¦–è¦ºæ•ˆæœå’ŒéŸ³æ•ˆçš„æµæš¢åˆ‡æ›
- è€ƒæ…®ä¸åŒå¹³å°çš„æ€§èƒ½å„ªåŒ–

### âš ï¸ æ³¨æ„äº‹é …
- å‘¨ç›®æª¢æ¸¬é‚è¼¯çš„æº–ç¢ºæ€§
- èƒŒæ™¯è³‡æºçš„è¨˜æ†¶é«”ç®¡ç†
- éŸ³æ•ˆåˆ‡æ›çš„å¹³æ»‘æ€§
- å­˜æª”ç³»çµ±çš„æ•¸æ“šå®‰å…¨æ€§

---

**æœ€å¾Œæ›´æ–°**: 2025-07-30  
**ç‰ˆæœ¬**: 1.0  
**ç¶­è­·è€…**: é–‹ç™¼åœ˜éšŠ + Claude AI

> ğŸ  **æ¶æ§‹åƒ¹å€¼**: ä¸»é¸å–®ç³»çµ±æ¶æ§‹æ¡ç”¨åˆ†å±¤æ¨¡çµ„åŒ–è¨­è¨ˆï¼Œé€šéæ™ºèƒ½çš„é€²åº¦æª¢æ¸¬å’Œå‹•æ…‹çš„è¦–è¦ºéŸ³æ•ˆç®¡ç†ï¼Œç‚ºç©å®¶æä¾›äº†éš¨è‘—éŠæˆ²é€²å±•è€Œä¸æ–·é€²åŒ–çš„å…¥å£é«”é©—ï¼Œå®Œç¾è©®é‡‹äº†éŠæˆ²çš„æˆé•·æ­·ç¨‹ï¼ âœ¨